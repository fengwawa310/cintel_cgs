<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8" />
	<title>模型分析</title>
	<meta name="viewport"
		  content="width=device-width, initial-scale=1.0, user-scalable=no" />
	<!-- basic styles -->
	<link href="../assets/css/bootstrap.min.css" rel="stylesheet" />
	<link rel="stylesheet" href="../assets/css/font-awesome.min.css" />

	<!-- ace styles -->
	<link rel="stylesheet" href="../assets/css/ace.min.css" />
	<link rel="stylesheet" type="text/css" href="../css/jquery.dataTables.min.css" />
	<script src="../assets/js/jquery-2.0.3.min.js"></script>

	<script src="../js/common.js"></script>
	<link rel="stylesheet" href="../css/commonStyle.css" />
	<link rel="stylesheet" href="../css/case.css" />
	<link rel="stylesheet" href="../css/person.css" />
	<script src="../assets/js/datepicker/WdatePicker.js"></script>

	<!-- <![endif]-->
	<script src="../assets/js/bootstrap.min.js"></script>
	<script src="../assets/js/typeahead-bs2.min.js"></script>

	<!-- ace scripts -->
	<script src="../assets/js/ace-elements.min.js"></script>
	<script src="../assets/js/ace.min.js"></script>
	<!-- page specific plugin scripts -->

	<!-- inline scripts related to this page -->
	<script type="text/javascript" src="../assets/js/D3.js"></script>

	<!-- layOpen -->
	<script src="../assets/js/layer/layer.js"></script>
	<script src="../js/common.js"></script>
	<script src="../js/import.js"></script>

	<!--dataTables的样式需求-->
	<script src="../js/jquery.dataTables.min.js"></script>
	<!--<script src="../assets/js/bootstrap.min.js"></script>-->
	<script src="../js/format.js"></script>
	<!-- 打印功能 -->
	<script src="../js/jquery.PrintArea.js"></script>
	<link rel="stylesheet" href="../css/print.css" />
	<!-- pdf保存 -->
	<script type="text/javascript" src="../js/canvg2.js"></script>
	<script type="text/javascript" src="../js/html2canvas-0.4.1.js"></script>
	<script type="text/javascript" src="../js/jspdf.min.js"></script>
	<script type="text/javascript" src="../js/saveSvgAsPng.js"></script>
	<script type="text/javascript" src="../assets/js/jquery.cookie.js"></script>
	<style>
		.radioT{
			width: 10px;
			height: 10px;
		}
		.tian{
			cursor: pointer;
		}
		.wt311{
			width: 300px;
			border: 1px solid #cedfff;
			float: left;
			background: #fff;
			overflow: hidden;
			position: absolute;
			left: 0;
			top: 0;
			display: none;
		}
		.wt311 h5{
			text-align: center;
			height: 38px;
			line-height: 38px;
			border-bottom: 1px solid #cedfff;
			background: #0b6cbc;
			margin: 0;
			color: #fff;
			margin-bottom: 10px;
		}
		.wt311 P{
			padding: 0px 20px;
			color: #666;
		}
		.wt311 p a{
			display: inline-block;
			cursor: pointer;
			padding: 0 5px;
		}
		.wt311 P.bule{
			color: #00559c;
		}
		.wt311 p sapn{
			cursor: pointer;
			padding: 0 5px;
		}
		.zhan {
			position: absolute;
			left: 0px;
			top: 1px;
			/*width: 30px;*/
			height: 37px;
			/* margin-top: -30px; */
			border: none;
			color: #fff;
			font-size: 12px;
			line-height: 37px;
			background: #0b6cbc;
			z-index: 10;
		}
		.wt312{
			float: right;
			margin-right: 20px;
			width: 300px;
			border: 1px solid #cedfff;
			background: #fff;
			overflow: hidden;
			position: absolute;
			right: 0;
			top: 0;
		}
		.wt312 h5{
			text-align: center;
			height: 38px;
			line-height: 38px;
			border-bottom: 1px solid #cedfff;
			background: #0b6cbc;
			margin: 0;
			color: #fff;
			margin-bottom: 10px;
		}
		.wt312 P{
			padding: 0px 20px;

		}
		.wt312 p a{
			display: inline-block;
			width: 60px;

		}
		.wt312 p input{
			cursor: pointer;
			margin: 0 5px;
		}
		.btn_yes{
			height: 26px;
			margin: 0;
			padding: 0 10px;
			background: #cee3f7 !important;
			color: #00559c !important;
			border: none;
			border-radius: 0;
			display: none;
		}
		.pop{
			width: 350px;
			height: 200px;
			border: 1px solid #00f;
			background-color: #ffffee;
			display: none;
			position:absolute;  /* 注：弹出框必须为绝对定位 */
		}
		.hiw_ul{
			width: 120px;
			padding:0;
			margin: 0;
			overflow: hidden;
			position: absolute;
			right: -150px;
			top: -10px;
			background: #fff;
			padding: 10px;
			border: none;
			border: 1px solid #333;
			border-radius: 5px;
			list-style: none;
			z-index: 100;
			display: none;
		}
		.hiw_ul li{
			width: 100px;
			line-height: 20px;
			border: 1px solid #666;
			border-radius: 5px;
			color: #333;
			list-style:none;
			margin: 5px 0px;
			text-align: center;
			cursor: pointer;
		}
		.remove{
			position: absolute;
			right: 0;
			top: -7px;
			font-size: 24px;
			cursor: pointer;
		}
		#textarea_id{
			width: 300px;
			height: 80px;
			resize: none;
			border-radius: 5px;
		}
	</style>
</head>
<body id="body">
<div class="clearfix"  id="contrast_div" style="display: none;">
	<div class="col-md-12 column">
		<table class="table">
			<thead id="thead_div">
			</thead>
			<tbody id="tbody_div">
			</tbody>
		</table>
	</div>
</div>
<iframe id="iframe" style="display: none;width: 100%;height: 100%;"></iframe>
<!--同住人数据-->
<input type="hidden" id="initLiveTable2">
<!--共同关系人数据-->
<input type="hidden" id="commonPeople2">
<!--同住人数据-->
<input type="hidden" id="type">
<input type="hidden" id="relationshipTime2">
<!-- 右侧部分 -->
<div style="width: 100%;height: 100%;margin: 0 auto;background: white">
	<div class="page-content">
		<ul id="myTab" class="nav nav-tabs mytab">
			<li class="active">
				<a href="#contactAnalysis" data-toggle="tab">通联人分析</a>
			</li>
			<li>
				<a href="#relationshipAnalysis" data-toggle="tab">共同关系人分析</a>
			</li>
			<li>
				<a href="#liveAnalysis" data-toggle="tab">同住人分析</a>
			</li>
			<li>
				<a href="#contactAnalysis2" data-toggle="tab">话单分析</a>
			</li>
		</ul>
		<!--tab切换内容-->
		<div id="myTabContent" class="tab-content" style="padding: 6px">
			<div class="tab-pane fade in active " id="contactAnalysis">
				<div class="row-container searchAll search-condition hidden-print" style="margin-bottom: 10px">
					<div class="col-md-3" style="width: 30%">
						<div class="row">
							<div class="col-md-5 searchTitle borderLnone borderBnone">
								<p style="text-align: left;">
									开始日期:
								</p>
							</div>
							<div class="col-md-7 searchCon borderBnone">
								<input type="text" id="startTime" class="form-control"  onfocus="WdatePicker({dateFmt: 'yyyy-MM-dd', maxDate: '%y-%M-%d'}); ">
							</div>
						</div>
					</div>
					<div class="col-md-3" style="width: 30%">
						<div class="row">
							<div class="col-md-5 searchTitle borderBnone">
								<p style="text-align: left;">
									手机号:
								</p>
							</div>
							<div class="col-md-7 searchCon borderBnone">
								<input id="phoneNumber" name="" type="text" class="form-control" placeholder="请输入手机号">
							</div>
						</div>
					</div>
					<div class="col-md-3 searchBtn borderTnone rightBorder borderRnone" style="width: 12%">
						<button class="btn btn-primary" type="button" onclick="conmmun()"> 分析 </button>
						<button class="btn btn-primary" onclick="toImportTicket()">导入话单</button>
					</div>
					<div class="col-md-4" style="width: 24%" >
						<div class="row">
							<div class="col-md-8 searchTitle borderLnone borderRnone borderBnone" id="showStype" style="background: white">
								<input type="radio" autocomplete="off" name="showStype" value=""  checked>
								<img src="../assets/images/gallery/pic.png" style="height: 30px;width: 30px;margin-left: 6px">
								<input autocomplete="off" type="radio" name="showStype" value=""  style="margin-left: 10px" >
								<img src="../assets/images/gallery/list.png" style="height: 28px;width: 28px;margin-left: 6px">
							</div>
							<div class="col-md-4 searchTitle borderLnone borderRnone borderBnone" style="padding-right: 20px;background: white">
								<img src="../assets/images/gallery/save.png" style="height: 24px;width: 24px;" onclick="exportPdf('contactAnalysis','1')">
								<img src="../assets/images/gallery/print.png" style="height: 24px;width: 24px;margin-left: 15px;" onclick="printPage('contactAnalysis');">
							</div>
						</div>
					</div>
				</div>
				<div id="wt100">
					<div class="wt110" style="position: relative;">
						<div style="overflow: hidden;">
							<div class="wt311" style="overflow: hidden; position: absolute;left: 0;top: 0;">
								<h5>历史信息</h5>
								<table id="wt1101"></table>
								<p style="text-align: center;"><button class="btn_yes" id="btn_yes_O">保存</button></p>
							</div>
							<button class="zhan" onclick="commonPeopleO(1)">历史信息<<</button>
							<div class="wt312" style="width: 325px;padding-top: 10px">
								<p>
									<!--<a style="width: 95px;">400开头的号码：</a>-->
									<!--<input type="checkbox" checked>-->
									<input type="checkbox" checked name="contact" value="0">
									<a>本地号</a>
									<input type="checkbox" checked name="contact" value="1">
									<a>外地号</a>
									<input type="checkbox" name="contact" value="2">
									<a>港澳台</a>
								</p>
								<p>
									<input type="checkbox" name="contact" value="3">
									<a>国际号</a>
									<input type="checkbox" name="contact" value="4">
									<a>客服号</a>
									<input type="checkbox" name="contact" value="5">
									<a>虚拟运营商</a>
								</p>
							</div>
						</div>
					</div>
					<div></div>
					<div class="wt100" style="display: none;" >
						<table id="dynamic-table_contact" class="cell-border table table-striped table-bordered table-hover dataTable"  cellspacing="0" width="100%">
						</table>
					</div>
				</div>
			</div>
			<div class="tab-pane fade" id="relationshipAnalysis">
				<div class="row-container searchAll search-condition hidden-print" style="margin-bottom: 10px">
					<div class="col-md-2" style="width: 31%">
						<div class="row">
							<div class="col-md-5 searchTitle borderLnone borderBnone">
								<p style="text-align: left;">
									开始日期:
								</p>
							</div>
							<div class="col-md-7 searchCon borderBnone">
								<input id="relationshipTime" name="relationshipTime" type='text' class="form-control" onfocus="WdatePicker({dateFmt: 'yyyy-MM-dd', maxDate: '%y-%M-%d'});  " />
							</div>
						</div>
					</div>
					<div class="col-md-2" style="width: 32%">
						<div class="row">
							<div class="col-md-5 searchTitle borderBnone">
								<p>
									手机号:
								</p>
							</div>
							<div class="col-md-7 searchCon borderBnone rightBorder">
								<input id="MultiplePhone" onkeyup="this.value=this.value.replace(/[^\r\n0-9\,]/g,'');" name="" type="text" class="form-control" placeholder="可输入多个手机号，请以“，”分开">
							</div>
						</div>
					</div>
					<div class="col-md-2 searchBtn borderTnone rightBorder borderRnone" style="width: 12%">
						<button class="btn btn-primary" type="button" onclick="showStype_O()"> 分析 </button>
						<button class="btn btn-primary" onclick="toImportTicket()">导入话单</button>
					</div>
					<div class="col-md-3 borderBnone">
						<div class="row">
							<div class="col-md-7 searchTitle borderLnone borderRnone borderBnone" id="showStype_O" style="background: white">
								<input type="radio" autocomplete="off" name="showStype2" value="" checked>
								<img src="../assets/images/gallery/pic.png" style="height: 30px;width: 30px;margin-left: 6px">
								<input type="radio" autocomplete="off" name="showStype2" value=""  style="margin-left: 10px">
								<img src="../assets/images/gallery/list.png" style="height: 28px;width: 28px;margin-left: 6px">
							</div>
							<div class="col-md-5 searchTitle borderLnone borderRnone borderBnone" style="padding-right: 20px;background: white">
								<img src="../assets/images/gallery/save.png" style="height: 24px;width: 24px;" onclick="exportPdf('relationshipAnalysis','2')">
								<img src="../assets/images/gallery/print.png" style="height: 24px;width: 24px;margin-left: 15px;" onclick="printPage('relationshipAnalysis');">
							</div>
						</div>
					</div>
					</form>

				</div>
				<div id="wt200">
					<div class="wt210" style=" position: relative;">
						<div style="overflow: hidden;">
							<div class="wt311" style="overflow: hidden; position: absolute;left: 0;top: 0;">
								<h5>历史信息</h5>
								<table id="wt2202"></table>
								<p style="text-align: center;"><button class="btn_yes"  id="btn_yes_T" >保存</button></p>
							</div>
							<!--<div class="wt312" style="width: 325px;padding-top: 10px">-->
							<button class="zhan" onclick="commonPeopleT(2)">历史信息<<</button>
							<div class="wt312" style="width: 325px;padding-top: 10px">
								<p>
									<input type="checkbox" checked name="relationship" value="0">
									<a>本地号</a>
									<input type="checkbox" checked name="relationship" value="1">
									<a>外地号</a>
									<input type="checkbox" name="relationship" value="2">
									<a>港澳台</a>
								</p>
								<p>
									<input type="checkbox" name="relationship" value="3">
									<a>国际号</a>
									<input type="checkbox" name="relationship" value="4">
									<a>客服号</a>
									<input type="checkbox" name="relationship" value="5">
									<a>虚拟运营商</a>
								</p>
							</div>
							<!--</div>-->
						</div>
					</div>
					<div></div>
					<div class="wt100" style="display: none">
						<table id="dynamic-table_relationship" class="cell-border table table-striped table-bordered table-hover dataTable"  cellspacing="0" width="100%">
							<thead></thead>
							<tbody></tbody>
						</table>
					</div>
				</div>
			</div>
			<div class="tab-pane fade" id="liveAnalysis" style="min-height: 250px">
				<div class=" searchAll search-condition" style="margin-bottom: 10px">
					<div class="col-md-2" style="width: 34%" id="cardDiv">
						<div class="row">
							<div class="col-md-5 searchTitle borderBnone borderLnone">
								<p style="text-align: left;">
									身份证号:
								</p>
							</div>
							<div class="col-md-7 searchCon borderBnone">
								<input id="idNumHotel" name="idNumHotel" type="text" class="form-control" placeholder="请输入身份证号">
							</div>
						</div>
					</div>
					<div class="col-md-2" style="width: 34%" id="timeDiv">
						<div class="row">
							<div class="col-md-4 searchTitle borderBnone">
								<p style="text-align: left;">
									选择时段:
								</p>
							</div>
							<div class="col-md-8 searchCon borderBnone rightBorder" >
								<select id="liveTime" name="">
									<option value ="30">请选择时段，默认一个月</option>
									<option value ="30">一个月</option>
									<option value ="90">三个月</option>
									<option value ="180">六个月</option>
									<option value ="365">十二个月</option>
									<option value ="">全部月份</option>
									<option value = "custom">自定义</option>
								</select>
							</div>
						</div>
					</div>
					<div id="inputDiv" class="col-md-2 hide" style="width: 22%" >
						<div class="col-md-12 searchCon">
							<input id="sTime" name="startTime" type='text' class="form-control searchTime" onfocus="WdatePicker({dateFmt: 'yyyy-MM-dd',maxDate:'#F{$dp.$D(\'eTime\')||\'%y-%M-%d\'}'}); ">至
							<input id="eTime" name="endTime" type='text' class="form-control searchTime" onfocus="WdatePicker({maxDate: '%y-%M-%d',minDate:'#F{$dp.$D(\'sTime\')}',dateFmt: 'yyyy-MM-dd'}); ">
						</div>
					</div>
					</form>
					<div class="col-md-2 searchBtn borderTnone rightBorder borderRnone" style="width: 7%">
						<button class="btn btn-primary" type="button" onclick="showStype_W()"> 分析 </button>
					</div>
					<div class="col-md-3">
						<div class="row">
							<div class="col-md-7 searchTitle borderLnone borderRnone borderBnone" id="showStype_W" style="background: white">
								<input type="radio" autocomplete="off" name="showStype3" checked>
								<img src="../assets/images/gallery/pic.png" style="height: 30px;width: 30px;margin-left: 6px">
								<input type="radio"  autocomplete="off" name="showStype3" style="margin-left: 10px">
								<img src="../assets/images/gallery/list.png" style="height: 28px;width: 28px;margin-left: 6px">
								<!--<input type="radio" name="showStype" value="" style="margin-left: 25px">-->
								<!--&lt;!&ndash;<img src="../assets/images/gallery/list.png" onclick="initLiveTable('2018-03-21','2')" style="height: 28px;width: 28px;margin-left: 6px">&ndash;&gt;-->
								<!--<img src="../assets/images/gallery/list.png"  style="height: 28px;width: 28px;margin-left: 6px">-->
							</div>
							<div class="col-md-5 searchTitle borderLnone borderRnone borderBnone" style="padding-right: 20px;background: white">
								<img src="../assets/images/gallery/save.png" style="height: 24px;width: 24px;" onclick="exportPdf('liveAnalysis','3')">
								<img src="../assets/images/gallery/print.png" style="height: 24px;width: 24px;margin-left: 15px;" onclick="printPage('liveAnalysis');">
							</div>
						</div>
					</div>
				</div>
				<div id="wt300">
					<div class="wt310" style="position: relative;">
						<div style="overflow: hidden;">
							<div class="wt311" style="overflow: hidden; position: absolute;left: 0;top: 0;">
								<h5>历史信息</h5>
								<table id="wt3303"></table>
								<p style="text-align: center;"><button class="btn_yes"  id="btn_yes_S">保存</button></p>
							</div>
							<button class="zhan" onclick="commonPeopleS(3)">历史信息<<</button>
							<div class="wt312" id="ale" style="overflow: hidden; position: absolute;right: 0;top: 0;">
								<p style="margin-top: 20px">
									<span>同省籍：</span>
									<input type="checkbox" value="a" checked id="po" name="live">同省
									<input type="checkbox" value="b" checked name="live">非同省
								</p>
								<p>
									<span>同乡籍：</span>
									<input type="checkbox" value="c" checked id="country" name="live">同乡
									<input type="checkbox" value="d" checked name="live">非同乡
								</p>
								<p>
									<span>港澳台/外籍：</span>
									<input type="checkbox" value="4" checked name="live">港澳台
									<input type="checkbox" value="5" checked name="live">外籍
								</p>
								<p>
									<span>指定籍：</span>
									<input type="type" id="reg" value="" onblur="refreshLive();"
										   onkeyup="this.value=this.value.replace(/[^\r\n0-9]/g,'');" maxlength="6">
								</p>
								<p>
									<span>性别：</span>
									<input type="checkbox" value="1" checked name="live">男
									<input type="checkbox" value="2" checked name="live">女
									<input type="checkbox" value="3" checked name="live">其他
								</p>
								<p>
									<span>涉案：</span>
									<input type="checkbox" value="6" name="live">同涉案
									<input type="checkbox" value="7" name="live">同涉警
								</p>
								<!--<p><a>地址：</a><input type="text"></p>-->
								<!--<p style="text-align: center;"><button class="btn_yes">确定</button></p>-->
							</div>
						</div>
					</div>
					<div style="display: none"></div>
					<div class="wt100" style="display: none">
						<table id="dynamic-table_live" class="cell-border table table-striped table-bordered table-hover dataTable"  cellspacing="0" width="100%">
						</table>
					</div>
				</div>
			</div>
			<div class="tab-pane fade  " id="contactAnalysis2">
				<div class="row-container searchAll search-condition hidden-print" style="margin-bottom: 10px">
					<div class="col-md-3" style="width: 15%">
						<div class="row">
							<div class="col-md-5 searchTitle borderLnone borderBnone">
								<p style="text-align: left;">
									开始日期:
								</p>
							</div>
							<div class="col-md-7 searchCon borderBnone">
								<input type="text" id="startTime1" class="form-control"  onfocus="WdatePicker({dateFmt: 'yyyy-MM-dd', maxDate: '%y-%M-%d'}); ">
							</div>
						</div>
					</div>
					<div class="col-md-3" style="width: 15%">
						<div class="row">
							<div class="col-md-5 searchTitle borderBnone">
								<p>
									手机号:
								</p>
							</div>
							<div class="col-md-7 searchCon borderBnone">
								<input id="phoneNumber1" name="" type="text" class="form-control" placeholder="请输入手机号">
							</div>
						</div>
					</div>
					<div class="col-md-3" style="width: 19%">
						<div class="row">
							<div class="col-md-4 searchTitle borderBnone">
								<p>
									通联时段:
								</p>
							</div>
							<div class="col-md-8 searchCon borderBnone rightBorder" >
								<select id="TonlyTime1" name="">
									<option value ="-1">请选择通联时段，默认全选</option>
									<option value ="07-11">7点到11点</option>
									<option value ="11-13">11点到13点</option>
									<option value ="13-19">13点到19点</option>
									<option value ="19-23">19点到23点</option>
									<option value ="23-07">23点到7点</option>
								</select>
							</div>
						</div>
					</div>
					<div class="col-md-3" style="width: 15%">
						<div class="row">
							<div class="col-md-5 searchTitle borderBnone borderLnone">
								<p>
									TOP数量:
								</p>
							</div>
							<div class="col-md-7 searchCon borderBnone rightBorder">
								<select id="TopNumber1" name="">
									<option value ="10">请选择TOP N的数量，默认TOP10</option>
									<option value ="5">TOP 5</option>
									<option value ="10">TOP 10</option>
									<option value ="20">TOP 20</option>
								</select>
							</div>
						</div>
					</div>
					</form>
					<div class="col-md-3 searchBtn borderTnone rightBorder borderRnone" style="width: 12%">
						<button class="btn btn-primary" type="button" onclick="conmmun1()"> 分析 </button>
						<button class="btn btn-primary" onclick="toImportTicket()">导入话单</button>
					</div>
					<div class="col-md-4" style="width: 24%" >
						<div class="row borderBnone">
							<div class="row">
								<div class="col-md-8 searchTitle borderLnone borderRnone borderBnone" id="showStype4" style="background: white">
									<input type="radio" autocomplete="off" name="showStype4" value=""  checked>
									<img src="../assets/images/gallery/pic.png" style="height: 30px;width: 30px;margin-left: 6px">
									<input autocomplete="off" type="radio" name="showStype4" value=""  style="margin-left: 25px" >
									<img src="../assets/images/gallery/list.png" style="height: 28px;width: 28px;margin-left: 6px">
								</div>
								<div class="col-md-4 searchTitle borderLnone borderRnone borderBnone" style="padding-right: 20px;background: white">
									<img src="../assets/images/gallery/save.png" style="height: 24px;width: 24px;" onclick="exportPdf('contactAnalysis2','4')">
									<img src="../assets/images/gallery/print.png" style="height: 24px;width: 24px;margin-left: 15px;" onclick="printPage('contactAnalysis2');">
								</div>
							</div>
						</div>
					</div>
				</div>
				<div id="wt400">
					<div class="wt410" style="position: relative;">
						<div style="overflow: hidden;">
							<div class="wt311" style="overflow: hidden; position: absolute;left: 0;top: 0;">
								<h5>历史信息</h5>
								<table id="wt4404"></table>
								<p style="text-align: center;"><button class="btn_yes"  id="btn_yes_F">保存</button></p>
							</div>
							<button class="zhan" onclick="commonPeopleF(4)">历史信息<<</button>
							<div class="wt312" style="width: 325px;padding-top: 10px">
								<p>
									<!--<a style="width: 95px;">400开头的号码：</a>-->
									<!--<input type="checkbox" checked>-->
									<input type="checkbox" checked name="phone" value="0">
									<a>本地号</a>
									<input type="checkbox" checked name="phone" value="1">
									<a>外地号</a>
									<input type="checkbox" name="phone" value="2">
									<a>港澳台</a>
								</p>
								<p>
									<input type="checkbox" name="phone" value="3">
									<a>国际号</a>
									<input type="checkbox" name="phone" value="4">
									<a>客服号</a>
									<input type="checkbox" name="phone" value="5">
									<a>虚拟运营商</a>
								</p>
							</div>
						</div>
					</div>
					<div></div>
					<div class="wt100" style="display: none;" >
						<table id="dynamictable_Billed" class="cell-border table table-striped table-bordered table-hover dataTable"  cellspacing="0" width="100%">
							<thead></thead>
							<tbody></tbody>
						</table>
					</div>
				</div>
			</div>
		</div>
		<input type="hidden" id="startTime2">
		<input type="hidden" id="finishTime">
		<input type="hidden" id="startTime4">
		<input type="hidden" id="startTime11">
		<input type="hidden" id="finishTime1">
		<input type="hidden" id="occupancy">
		<input type="hidden" id="occupancy2">
		<ul class='hiw_ul' id="details">
			<div class="remove">×</div>
			<li  class="information" style="display: none;" >查看信息</li>
			<li  class="ToView" >添加备注</li>
			<li  class="remove_hiw">删除</li>
		</ul>
	</div>
</div>
<script type="text/javascript" >
    function list(phone,phoneW,startTime,finishTime){
        console.log("开始时间"+startTime);
        console.log("结束时间"+finishTime);
        console.log("当前手机号"+phone);
        console.log("对端手机号"+phoneW);
        showDetail(startTime,finishTime,phoneW,phone)
    }
    $("#body").click(function () {
        $("#details").hide();
    });
    //关闭侧面
    $('.remove').unbind('click').click(function() {
        $(this).parent().hide();
    })
    $(".zhan").click(function () {
        var the_zhan = $(this);
        if( the_zhan.text() == "历史信息<<" ){
            the_zhan.prev().show();
            the_zhan.text(">>");
            the_zhan.css({
                "left":"299px"
            });
        }else{
            the_zhan.prev().hide();
            the_zhan.text("历史信息<<");
            the_zhan.css({
                "left":"0px"
            });
        };
    })
    //    commonPeople("","");
    //    initLiveTable("","");
    //测试
    function exportPdf(id,type){
        var pdfname="";
        $("#type").val(type);
        // $("#showStype_O input[name=showStype2]").eq(0).attr("checked","checked");
        // $("#showStype input[name=showStype]").eq(0).attr("checked","checked");
        // $("#showStype3 input[name=showStype3]").eq(0).attr("checked","checked");
        //$("#iframe").attr("src","newHtml.html");
        switch(id){
            case "contactAnalysis":
                pdfname="通联人分析";
                break;
            case "relationshipAnalysis":
                pdfname="共同关系人分析";
                break;
            case "liveAnalysis":
                pdfname="同住人分析";
                break;
            default:
                break;
        }
        var targetDom = $("#"+id);
        //把需要导出的pdf内容clone一份，这样对它进行转换、微调等操作时才不会影响原来界面
        var copyDom = targetDom.clone();
        //新的div宽高跟原来一样，高度设置成自适应，这样才能完整显示节点中的所有内容（比如说表格滚动条中的内容）
        copyDom.width(targetDom.width() + "px");
        copyDom.height(targetDom.height() + "px");
        $('body').append(copyDom);//ps:这里一定要先把copyDom append到body下，然后再进行后续的glyphicons2canvas处理，不然会导致图标为空
        //copyDom.attr("xmlns","http://www.w3.org/2000/svg");
        //copyDom.attr("version","1.1");
        var svgElem = copyDom.find('svg');
        copyDom.css("background", "#fff")
        if(svgElem.length>0){
            svgElem.each(function (index, node) {
                svgAsPngUri(node, {}, function(uri) {
                    console.log(uri);
                    var image = document.createElement('img');
                    image.src = uri;
                    copyDom.append(image);
                    image.onload=function(){
                        var svgNode = copyDom.find('svg').remove()
                        var width = copyDom.width();
                        var height = copyDom.height();
                        var scaleBy = 3;  //缩放比例
                        var canvas = document.createElement('canvas');
                        canvas.width = width * scaleBy;
                        canvas.height = height * scaleBy+35;  //35是我处理完后发现短了一点，具体为什么不清楚,如果你也少的话，根据自己的项目调吧
                        canvas.style.width = width * scaleBy + 'px';
                        canvas.style.height = height * scaleBy + 'px';
                        var context = canvas.getContext('2d');
                        html2canvas(copyDom, {
                            onrendered: function (canvas) {
                                var imgData = canvas.toDataURL('image/jpeg');
                                console.log(imgData);
                                var img = new Image();
                                img.src = imgData;
                                //console.log( img.src )
                                //根据图片的尺寸设置pdf的规格，要在图片加载成功时执行
                                /**
                                 当分辨率是72像素/英寸时，A4纸像素长宽分别是842×595；
                                 当分辨率是120像素/英寸时，A4纸像素长宽分别是2105×1487；
                                 当分辨率是150像素/英寸时，A4纸像素长宽分别是1754×1240；
                                 当分辨率是300像素/英寸时，A4纸像素长宽分别是3508×2479；
                                 */
                                img.onload = function () {
                                    var scale = 595/this.width;
                                    var doc = new jsPDF('', 'pt', 'a4');
                                    doc.addImage(imgData, 'jpeg',10, 10, this.width*scale-20, this.height*scale);
                                    //doc.addImage(uri, 'png',0,this.height,image.width*scale, image.height*scale);
                                    //根据下载保存成不同的文件名
                                    doc.save(pdfname + getNowFormatDateBySepertor() + '.pdf');
                                };
                                //删除复制出来的div
                                copyDom.remove();
                            },
                            background: "#fff",
                            //这里给生成的图片默认背景，不然的话，如果你的html根节点没设置背景的话，会用黑色填充。
                            allowTaint: true //避免一些不识别的图片干扰，默认为false，遇到不识别的图片干扰则会停止处理html2canvas
                        });
                    }

                });
            });
        }else{
            //svg2canvas(copyDom);
            var width = copyDom.width();
            var height = copyDom.height();
            var scaleBy = 3;  //缩放比例
            var canvas = document.createElement('canvas');
            canvas.width = width * scaleBy;
            canvas.height = height * scaleBy+35;  //35是我处理完后发现短了一点，具体为什么不清楚,如果你也少的话，根据自己的项目调吧
            canvas.style.width = width * scaleBy + 'px';
            canvas.style.height = height * scaleBy + 'px';
            var context = canvas.getContext('2d');
            html2canvas(copyDom, {
                onrendered: function (canvas) {
                    var imgData = canvas.toDataURL('image/jpeg');
                    console.log(imgData);
                    var img = new Image();
                    img.src = imgData;
                    //根据图片的尺寸设置pdf的规格，要在图片加载成功时执行，之所以要*0.225是因为比例问题
                    img.onload = function () {
                        var scale = 595/this.width;
                        var doc = new jsPDF('', 'pt', 'a4');
                        doc.addImage(imgData, 'jpeg', 10, 10, this.width*scale-20, this.height*scale);
                        //根据下载保存成不同的文件名
                        doc.save(pdfname + getNowFormatDateBySepertor() + '.pdf');
                    };
                    //删除复制出来的div
                    copyDom.remove();
                },
                background: "#fff",
                //这里给生成的图片默认背景，不然的话，如果你的html根节点没设置背景的话，会用黑色填充。
                allowTaint: true //避免一些不识别的图片干扰，默认为false，遇到不识别的图片干扰则会停止处理html2canvas
            });
        }
    }
    function svg2canvas(targetElem) {
        var svgElem = targetElem.find('svg');
        svgElem.each(function (index, node) {
            var parentNode = node.parentNode;
            //由于现在的IE不支持直接对svg标签node取内容，所以需要在当前标签外面套一层div，通过外层div的innerHTML属性来获取
            var tempNode = document.createElement('div');
            tempNode.appendChild(node);
            var svg = tempNode.innerHTML;

            //转换
            var canvas = document.createElement('canvas');
            canvg(canvas, svg);
            parentNode.appendChild(canvas);
        });
    }
    function printPage(id){
        var pdfname="";
        switch(id){
            case "contactAnalysis":
                pdfname="通联人分析";
                break;
            case "relationshipAnalysis":
                pdfname="共同关系人分析";
                break;
            case "liveAnalysis":
                pdfname="同住人分析";
                break;
            case "contactAnalysis2":
                pdfname="话单分析";
                break;
            default:
                break;

        }
        var targetDom = $("#"+id);
        //把需要导出的pdf内容clone一份，这样对它进行转换、微调等操作时才不会影响原来界面
        var copyDom = targetDom.clone();
        console.log( document.body.clientWidth );
        //新的div宽高跟原来一样，高度设置成自适应，这样才能完整显示节点中的所有内容（比如说表格滚动条中的内容）
        copyDom.width( targetDom.width() + "px");
        copyDom.height( targetDom.height() + "px");

        $('body').append(copyDom);//ps:这里一定要先把copyDom append到body下，然后再进行后续的glyphicons2canvas处理，不然会导致图标为空
        //copyDom.attr("xmlns","http://www.w3.org/2000/svg");
        //copyDom.attr("version","1.1");
        console.log(copyDom);
        var svgElem = copyDom.find('svg');
        copyDom.css("background", "#fff")
        if(svgElem.length>0){
            svgElem.each(function (index, node) {
                svgAsPngUri(node, {}, function(uri) {
                    console.log(uri);
                    var image = document.createElement('img');
                    image.src = uri;
                    copyDom.append(image);
                    image.onload=function(){
                        var svgNode = copyDom.find('svg').remove()
                        var width = copyDom.width();
                        var height = copyDom.height();
                        var scaleBy = 3;  //缩放比例
                        var canvas = document.createElement('canvas');
                        canvas.width = width * scaleBy;
                        canvas.height = height * scaleBy+35;  //35是我处理完后发现短了一点，具体为什么不清楚,如果你也少的话，根据自己的项目调吧
                        canvas.style.width = width * scaleBy + 'px';
                        canvas.style.height = height * scaleBy + 'px';
                        var context = canvas.getContext('2d');
                        html2canvas(copyDom, {
                            onrendered: function (canvas) {
                                var imgData = canvas.toDataURL('image/jpeg');
                                console.log(imgData);
                                var img = new Image();
                                img.src = imgData;
                                //根据图片的尺寸设置pdf的规格，要在图片加载成功时执行
                                /**
                                 当分辨率是72像素/英寸时，A4纸像素长宽分别是842×595；
                                 当分辨率是120像素/英寸时，A4纸像素长宽分别是2105×1487；
                                 当分辨率是150像素/英寸时，A4纸像素长宽分别是1754×1240；
                                 当分辨率是300像素/英寸时，A4纸像素长宽分别是3508×2479；
                                 */
                                img.onload = function () {
                                    var scale = 595/this.width;
                                    var doc = new jsPDF('', 'pt', 'a4');
                                    doc.addImage(imgData, 'jpeg',10, 10, this.width*scale-20, this.height*scale);
                                    //doc.addImage(uri, 'png',0,this.height,image.width*scale, image.height*scale);
                                    //根据下载保存成不同的文件名
                                    //doc.save(pdfname + getNowFormatDateBySepertor() + '.pdf');
                                    window.print( doc );
                                };
                                //删除复制出来的div
                                copyDom.remove();
                            },
                            background: "#fff",
                            //这里给生成的图片默认背景，不然的话，如果你的html根节点没设置背景的话，会用黑色填充。
                            allowTaint: true //避免一些不识别的图片干扰，默认为false，遇到不识别的图片干扰则会停止处理html2canvas
                        });
                    }

                });
            });
        }else{
            //svg2canvas(copyDom);
            var width = copyDom.width();
            var height = copyDom.height();
            var scaleBy = 3;  //缩放比例
            var canvas = document.createElement('canvas');
            canvas.width = width * scaleBy;
            canvas.height = height * scaleBy+35;  //35是我处理完后发现短了一点，具体为什么不清楚,如果你也少的话，根据自己的项目调吧
            canvas.style.width = width * scaleBy + 'px';
            canvas.style.height = height * scaleBy + 'px';
            var context = canvas.getContext('2d');
            html2canvas(copyDom, {
                onrendered: function (canvas) {
                    var imgData = canvas.toDataURL('image/jpeg');
                    console.log(imgData);
                    var img = new Image();
                    img.src = imgData;
                    //根据图片的尺寸设置pdf的规格，要在图片加载成功时执行，之所以要*0.225是因为比例问题
                    img.onload = function () {
                        var scale = 595/this.width;
                        var doc = new jsPDF('', 'pt', 'a4');
                        doc.addImage(imgData, 'jpeg', 10, 10, this.width*scale-20, this.height*scale);
                        //根据下载保存成不同的文件名
                        doc.save(pdfname + getNowFormatDateBySepertor() + '.pdf');
                    };
                    //删除复制出来的div
                    copyDom.remove();
                },
                background: "#fff",
                //这里给生成的图片默认背景，不然的话，如果你的html根节点没设置背景的话，会用黑色填充。
                allowTaint: true //避免一些不识别的图片干扰，默认为false，遇到不识别的图片干扰则会停止处理html2canvas
            });
        }

        /* var printname="";
        switch(id){
            case "contactAnalysis":
                printname="通联人分析";
                break;
            case "relationshipAnalysis":
                printname="共同关系人分析";
                break;
            case "liveAnalysis":
                printname="同住人分析";
                break;
            default:
                break;

        }
        $("#"+id).printArea({
            mode       : "iframe",
            standard   : "html5",
            popTitle   : printname,
            popClose   : false,
            extraCss   : '../css/print.css',
            extraHead  : '',
            retainAttr : ["id","class","style"],
            printDelay : 100, // tempo de atraso na impressao
            printAlert : true,
            printMsg   : ''
        }); */
    }
    $("#showStype > .showStype").click(function () {
        $("#wt100 > div").eq( $(this).index() ).show().siblings().hide();
    });
    //通联人
    var dynamictable_contact;
    var dynamictable_relationship;
    var dynamictable_live;
    //话单分析
    var dynamictable_Billed;
    var wt1101;
    var wt2202;
    var wt3303;
    var wt4404;
    //当前身份证
    var idCard = "";
    //根据配置文件获取的电话区号
    var areaCode;
    //话单分析 待分析的电话号码
    var toBePhone = "";
    //通联人分析 待分析的电话号码
    var contactPhone = "";
    $(document).ready(function() {
        //刷新页面后清除缓存数据
        $.ajax({url: projectPath+"elastic/clean",type: "post",dataType: "json",data: "",success: function (data) {}});
        //通联人数据集
        var commonData = [];
        //关系人数据集
        var relationData = [];
        //话单分析数据集
        var phoneData = [];
        //同住人分析数据集
        var liveData = [];

        areaCode = getAreacodeByGlobal();
        console.log("==areaCode=="+areaCode);
        // areaCode = "0755";
        var iDdata = [];
        menuThing();
        $("#dynamic-table_filter").css('display', 'block');
        dynamictable_contact = $("#dynamic-table_contact").DataTable(
            {
                "bLengthChange" : false, /* 去掉每页显示多少条数据方法 */
                "processing" : true,/*控制是否在数据加载时出现”Processing”的提示,一般在远程加载并且比较慢的情况下才会出现. 样式需要定义,否则比较丑.*/
                "pageLength" : 20,/*默认*/
                "lengthMenu" : [ [ 5, 10, 20, -1 ],
                    [ 5, 10, 20, "全部" ] ],
                /*"deferRender": true,*/
                "searching" : false,/*控制控件的搜索功能,如果为false,控件的搜索功能被完全禁用,而且默认搜索组件会被隐藏.*/
                "serverSide" : true,/* 启用服务器端分页,当设为true时,列表的过滤,搜索和排序信息会传递到Server端进行处理,实现真翻页方案的必需属性.反之,所有的列表功能都在客户端计算并执行*/
                "autoWidth" : false,/*用来启用或禁用自动列的宽度计算。通常被禁用作为优化（它需要一个有限的时间量来计算的宽度），默认值是true，所以通常将它设为false*/
                /*  "order": [   //表示先对第1列进行升序排序，再按照第二列升序排序，最后按照第三列降序排序
                 [0, "desc"]
                 ], */
                //因为需要多次初始化，所以需要设置允许销毁实例
                "destroy" : true,
                "bFilter" : false,
                "orderMulti" : false, //启用多列排序
                "order" : [], //取消默认排序查询,否则复选框一列会出现小箭头
                /* "pagingType": "full_numbers", *///分页样式：simple,simple_numbers,full,full_numbers
                /*   "table-layout":fix, */
                "row-border" : true,
                "oLanguage" : {
                    "sEmptyTable" : "没有记录",
                    "sProcessing" : "处理中，请稍候...",
                    "sLengthMenu" : "每页显示 _MENU_ 条记录",
                    "sZeroRecords" : "没有记录",
                    "sInfo" : " _START_ 到  _END_ 条记录,总记录数为 _TOTAL_ 条",
                    "sInfoEmpty" : "记录数为0",
                    "sInfoFiltered" : "(从全部记录数 _MAX_ 条中过滤)",
                    "sInfoPostFix" : "",
                    "sLoadingRecords" : "正在加载中,请稍候...",
                    "sSearch" : "搜索",
                    "sUrl" : "",
                    "oPaginate" : {
                        "sFirst" : "首页",
                        "sPrevious" : "上一页",
                        "sNext" : "下一页",
                        "sLast" : "末页"
                    }
                },
                ajax : {
                    url : projectPath +"elastic/contactPersonList",
                    "type" : "post"
                },
                /*序号自增长*/
                "fnDrawCallback" : function(){
                    this.api().column(0).nodes().each(function(cell, i) {
                        cell.innerHTML =  i + 1;
                    });
                },
                "bDeferRender" : true,/*是否启用延迟加载：当你使用AJAX数据源时，可以提升速度。*/
                "columns": [
                    {"sTitle":'<font>序号</font>','sWidth' :'5%',"sClass" :"dt-left", 'bSortable': false,
                        'render': function(data, type, row, meta) {
                            if(data==""||data==null){
                                return "--";
                            }
                            return data;
                        }},
                    {"sTitle":'<font>手机号</font>',"sWidth":"7%","sClass":"dt-left", 'data': 'phone','bSortable': true,
                        'render': function(data, type, row, meta) {
                            if(data==""||data==null){
                                return "--";
                            }
                            return data;
                        }},
                    {"sTitle":'<font>归属地</font>',"sWidth":"7%","sClass":"dt-left", 'data': 'city','bSortable': true,
                        'render': function(data, type, row, meta) {
                            if(data==""||data==null){
                                return "--";
                            }
                            return data;
                        }},
                    {"sTitle":'<font>归属运营商</font>',"sWidth":"8%","sClass":"dt-left", 'data': 'operate','bSortable': true,
                        'render': function(data, type, row, meta) {
                            if(data==""||data==null){
                                return "--";
                            }
                            return data;
                        }},
                    {"sTitle":'<font>频次</font>',"sWidth":"7%","sClass":"dt-left", 'data': 'all','bSortable': true,
                        'render': function(data, type, row, meta) {
                            if(data==""||data==null){
                                return "--";
                            }
                            return data;
                        }},
                    {"sTitle":'<font>主叫频次</font>',"sWidth":"7%","sClass":"dt-left", 'data': 'calling','bSortable': true,
                        'render': function(data, type, row, meta) {
                            if(data==""||data==null){
                                return "--";
                            }
                            return data;
                        }},
                    {"sTitle":'<font>被叫频次</font>',"sWidth":"7%","sClass":"dt-left", 'data': 'called','bSortable': true,
                        'render': function(data, type, row, meta) {
                            if(data==""||data==null){
                                return "--";
                            }
                            return data;
                        }},
                    {"sTitle":'<font>积分</font>',"sWidth":"7%","sClass":"dt-left", 'data': 'integral','bSortable': true,
                        'render': function(data, type, row, meta) {
                            if(data==""||data==null){
                                return "--";
                            }
                            return data;
                        }},
                    {"sTitle":'<font>积分排名</font>',"sWidth":"6%","sClass":"dt-left", 'data': 'integralSort','bSortable': true,
                        'render': function(data, type, row, meta) {
                            if(data==""||data==null){
                                return "--";
                            }
                            return data;
                        }}
                ]
            });
        $("#dynamic-table_filter").css("display", "none");
    });
    commonPeople();
    //    initLiveTable();
    //初始化共同关系人分析
    function commonPeople(start_time,phoneNumbers) {
        $("#dynamic-table_filter").css('display', 'block');
        dynamictable_relationship = $("#dynamic-table_relationship").DataTable(
            {
                "paging": true,
                "bLengthChange" : false, /* 去掉每页显示多少条数据方法 */
                "iDisplayLength": 10, //默认每页数量
                "processing" : true,/*控制是否在数据加载时出现”Processing”的提示,一般在远程加载并且比较慢的情况下才会出现. 样式需要定义,否则比较丑.*/
                "pageLength" : 20,/*默认*/
                "lengthMenu" : [ [ 5, 10, 20, -1 ],
                    [ 5, 10, 20, "全部" ] ],
                /*"deferRender": true,*/
                "searching" : false,/*控制控件的搜索功能,如果为false,控件的搜索功能被完全禁用,而且默认搜索组件会被隐藏.*/
                "serverSide" : false,/* 启用服务器端分页,当设为true时,列表的过滤,搜索和排序信息会传递到Server端进行处理,实现真翻页方案的必需属性.反之,所有的列表功能都在客户端计算并执行*/
                "autoWidth" : false,/*用来启用或禁用自动列的宽度计算。通常被禁用作为优化（它需要一个有限的时间量来计算的宽度），默认值是true，所以通常将它设为false*/
                /*  "order": [   //表示先对第1列进行升序排序，再按照第二列升序排序，最后按照第三列降序排序
                 [0, "desc"]
                 ], */
                //因为需要多次初始化，所以需要设置允许销毁实例
                "destroy" : true,
                "bFilter" : false,
                "orderMulti" : false, //启用多列排序
                "order" : [], //取消默认排序查询,否则复选框一列会出现小箭头
                /* "pagingType": "full_numbers", *///分页样式：simple,simple_numbers,full,full_numbers
                /*   "table-layout":fix, */
                "row-border" : true,
                "oLanguage" : {
                    "sEmptyTable" : "没有记录",
                    "sProcessing" : "处理中，请稍候...",
                    "sLengthMenu" : "每页显示 _MENU_ 条记录",
                    "sZeroRecords" : "没有记录",
                    "sInfo" : " _START_ 到  _END_ 条记录,总记录数为 _TOTAL_ 条",
                    "sInfoEmpty" : "记录数为0",
                    "sInfoFiltered" : "(从全部记录数 _MAX_ 条中过滤)",
                    "sInfoPostFix" : "",
                    "sLoadingRecords" : "正在加载中,请稍候...",
                    "sSearch" : "搜索",
                    "sUrl" : "",
                    "oPaginate" : {
                        "sFirst" : "首页",
                        "sPrevious" : "上一页",
                        "sNext" : "下一页",
                        "sLast" : "末页"
                    }
                },
                ajax : {
                    url : getRootPath_web()+"/ticket/mutualContactsAnalyze?start_time="+start_time+"&phoneNumbers="+phoneNumbers+"&type=0",
                    "type" : "post",
                },
                /*序号自增长*/
                "fnDrawCallback" : function(){
                    this.api().column(0).nodes().each(function(cell, i) {
                        cell.innerHTML =  i + 1;
                    });
                },
                "bDeferRender" : true,/*是否启用延迟加载：当你使用AJAX数据源时，可以提升速度。*/
                "columns": [
                    {"sTitle":'<font>序号</font>','sWidth' :'5%',"sClass" :"dt-left", 'bSortable': false,
                        'render': function(data, type, row, meta) {
                            if(data==""||data == null ){
                                return "--";
                            }
                            return data;
                        }},
                    {"sTitle":'<font>输入手机号</font>',"sWidth":"7%","sClass":"dt-left", 'data': 'inputNumber','bSortable': true,
                        'render': function(data, type, row, meta) {
                            if(data==""||data=="null"){
                                return "--";
                            }
                            return data;
                        }},
                    {"sTitle":'<font>对方号码</font>',"sWidth":"7%","sClass":"dt-left", 'data': 'opositeNumber','bSortable': true,
                        'render': function(data, type, row, meta) {
                            if(data==""||data=="null"){
                                return "--";
                            }
                            return data;
                        }},
                    {"sTitle":'<font>归属地</font>',"sWidth":"7%","sClass":"dt-left", 'data': 'location','bSortable': true,
                        'render': function(data, type, row, meta) {
                            if(data==""||data=='"null"'){
                                return "--";
                            }
                            return data;
                        }},
                    {"sTitle":'<font>运营商</font>',"sWidth":"7%","sClass":"dt-left", 'data': 'domain','bSortable': true,
                        'render': function(data, type, row, meta) {
                            if(data==""||data=='"null"'){
                                return "--";
                            }
                            return data;
                        }},
                    {"sTitle":'<font>频次-主叫</font>',"sWidth":"8%","sClass":"dt-left", 'data': 'callingFrequency','bSortable': true,
                        'render': function(data, type, row, meta) {
                            if(data==""||data=='"null"'){
                                return "--";
                            }
                            return data;
                        }},
                    {"sTitle":'<font>频次-被叫</font>',"sWidth":"7%","sClass":"dt-left", 'data': 'calledFrequency','bSortable': true,
                        'render': function(data, type, row, meta) {
                            if(data==""||data=='"null"'){
                                return "--";
                            }
                            return data;
                        }},
                    {"sTitle":'<font>频次-全部</font>',"sWidth":"7%","sClass":"dt-left", 'data': 'allFrequency','bSortable': true,
                        'render': function(data, type, row, meta) {
                            if(data==""||data=="null"){
                                return "--";
                            }
                            return data;
                        }},

                ]
            });
        $("#dynamic-table_filter").css("display", "none");
    }
    //初始化表格
    function initLiveTable(startTime,endTime,idNumHotel) {
        $("#dynamic-table_filter").css('display', 'block');
        dynamictable_live = $("#dynamic-table_live").DataTable(
            {
                "paging": true,
                "bLengthChange" : false, /* 去掉每页显示多少条数据方法 */
                "iDisplayLength": 10, //默认每页数量
                "processing" : true,/*控制是否在数据加载时出现”Processing”的提示,一般在远程加载并且比较慢的情况下才会出现. 样式需要定义,否则比较丑.*/
                // "pageLength" : 5,/*默认*/
                "lengthMenu" : [ [ 5, 10, 20, -1 ],
                    [ 5, 10, 20, "全部" ] ],
                /*"deferRender": true,*/
                "searching" : false,/*控制控件的搜索功能,如果为false,控件的搜索功能被完全禁用,而且默认搜索组件会被隐藏.*/
                "serverSide" : false,/* 启用服务器端分页,当设为true时,列表的过滤,搜索和排序信息会传递到Server端进行处理,实现真翻页方案的必需属性.反之,所有的列表功能都在客户端计算并执行*/
                "autoWidth" : false,/*用来启用或禁用自动列的宽度计算。通常被禁用作为优化（它需要一个有限的时间量来计算的宽度），默认值是true，所以通常将它设为false*/
                /*  "order": [   //表示先对第1列进行升序排序，再按照第二列升序排序，最后按照第三列降序排序
                 [0, "desc"]
                 ], */
                //因为需要多次初始化，所以需要设置允许销毁实例
                "destroy" : true,
                "bFilter" : false,
                "orderMulti" : false, //启用多列排序
                "order" : [], //取消默认排序查询,否则复选框一列会出现小箭头
                /* "pagingType": "full_numbers", *///分页样式：simple,simple_numbers,full,full_numbers
                /*   "table-layout":fix, */
                "row-border" : true,
                "oLanguage" : {
                    "sEmptyTable" : "没有记录",
                    "sProcessing" : "处理中，请稍候...",
                    "sLengthMenu" : "每页显示 _MENU_ 条记录",
                    "sZeroRecords" : "没有记录",
                    "sInfo" : " _START_ 到  _END_ 条记录,总记录数为 _TOTAL_ 条",
                    "sInfoEmpty" : "记录数为0",
                    "sInfoFiltered" : "(从全部记录数 _MAX_ 条中过滤)",
                    "sInfoPostFix" : "",
                    "sLoadingRecords" : "正在加载中,请稍候...",
                    "sSearch" : "搜索",
                    "sUrl" : "",
                    "oPaginate" : {
                        "sFirst" : "首页",
                        "sPrevious" : "上一页",
                        "sNext" : "下一页",
                        "sLast" : "末页"
                    }
                },
                ajax : {
                    url : getRootPath_web()+"/elastic/analyseHotelPerson?resultType=1&startTime="+startTime+"&endTime="+endTime+"&idNumHotel="+idNumHotel,
                    "type" : "post"
                },
                /*序号自增长*/
                "fnDrawCallback" : function(){
                    this.api().column(0).nodes().each(function(cell, i) {
                        cell.innerHTML =  i + 1;
                    });
                },
                "bDeferRender" : true,/*是否启用延迟加载：当你使用AJAX数据源时，可以提升速度。*/
                "columns": [
                    {"sTitle":'<font>序号</font>','sWidth' :'5%',"sClass" :"dt-left", 'bSortable': true,
                        'render': function(data, type, row, meta) {
                            if(data==""||data==null){
                                return "--";
                            }
                            return data;
                        }},
                    {"sTitle":'<font>入住时间</font>',"sWidth":"7%","sClass":"dt-left", 'data': 'ltime','bSortable': true,
                        'render': function(data, type, row, meta) {
                            if(data==""||data==null){
                                return "--";
                            }
                            return data;
                        }},
                    {"sTitle":'<font>离开时间</font>',"sWidth":"7%","sClass":"dt-left", 'data': 'etime','bSortable': true,
                        'render': function(data, type, row, meta) {
                            if(data==""||data==null){
                                return "--";
                            }
                            return data;
                        }},
                    {"sTitle":'<font>同住人姓名</font>',"sWidth":"7%","sClass":"dt-left", 'data': 'personinfo','bSortable': true,
                        'render': function(data, type, row, meta) {
                            if(data==""||data==null){
                                return "--";
                            }
                            return data.name;
                        }},
                    {"sTitle":'<font>标签</font>',"sWidth":"7%","sClass":"dt-left", 'data': 'tag','bSortable': true,
                        'render': function(data, type, row, meta) {
                            if(data==""||data==null){
                                return "--";
                            }
                            return data;
                        }},
                    {"sTitle":'<font>同住人身份证号</font>',"sWidth":"7%","sClass":"dt-left", 'data': 'personinfo','bSortable': true,
                        'render': function(data, type, row, meta) {
                            if(data==""||data==null){
                                return "--";
                            }
                            return data.idcode;
                        }},
                    {"sTitle":'<font>同住人户籍</font>',"sWidth":"6%","sClass":"dt-left", 'data': 'personinfo','bSortable': true,
                        'render': function(data, type, row, meta) {
                            if(data==""||data==null){
                                return "--";
                            }
                            return data.address;
                        }},
                    {"sTitle":'<font>入住酒店名称</font>',"sWidth":"6%","sClass":"dt-left", 'data': 'hotelinfo','bSortable': true,
                        'render': function(data, type, row, meta) {
                            if(data==""||data==null){
                                return "--";
                            }
                            return data.hname;
                        }},
                    {"sTitle":'<font>入住人房间号</font>',"sWidth":"6%","sClass":"dt-left", 'data': 'noroom','bSortable': true,
                        'render': function(data, type, row, meta) {
                            if(data==""||data==null){
                                return "--";
                            }
                            return data;
                        }},
                    {"sTitle":'<font>入住酒店星级</font>',"sWidth":"6%","sClass":"dt-left", 'data': 'hotelinfo','bSortable': true,
                        'render': function(data, type, row, meta) {
                            if(data==""||data==null){
                                return "--";
                            }
                            return data.stars;
                        }},
                    {"sTitle":'<font>酒店详细地址</font>',"sWidth":"6%","sClass":"dt-left", 'data': 'hotelinfo','bSortable': true,
                        'render': function(data, type, row, meta) {
                            if(data==""||data==null){
                                return "--";
                            }
                            return data.haddress;
                        }}
                ]
            });
        $("#dynamic-table_filter").css("display", "none");
    }
    //话单表格
    function analysisBilled() {
        $("#dynamic-table_filter").css('display', 'block');
        dynamictable_Billed = $("#dynamictable_Billed").DataTable(
            {
                "bLengthChange" : false, /* 去掉每页显示多少条数据方法 */
                "processing" : true,/*控制是否在数据加载时出现”Processing”的提示,一般在远程加载并且比较慢的情况下才会出现. 样式需要定义,否则比较丑.*/
                "pageLength" : 20,/*默认*/
                "lengthMenu" : [ [ 5, 10, 20, -1 ],
                    [ 5, 10, 20, "全部" ] ],
                /*"deferRender": true,*/
                "searching" : false,/*控制控件的搜索功能,如果为false,控件的搜索功能被完全禁用,而且默认搜索组件会被隐藏.*/
                "serverSide" : true,/* 启用服务器端分页,当设为true时,列表的过滤,搜索和排序信息会传递到Server端进行处理,实现真翻页方案的必需属性.反之,所有的列表功能都在客户端计算并执行*/
                "autoWidth" : false,/*用来启用或禁用自动列的宽度计算。通常被禁用作为优化（它需要一个有限的时间量来计算的宽度），默认值是true，所以通常将它设为false*/
                /*  "order": [   //表示先对第1列进行升序排序，再按照第二列升序排序，最后按照第三列降序排序
                 [0, "desc"]
                 ], */
                //因为需要多次初始化，所以需要设置允许销毁实例
                "destroy" : true,
                "bFilter" : false,
                "orderMulti" : false, //启用多列排序
                "order" : [], //取消默认排序查询,否则复选框一列会出现小箭头
                /* "pagingType": "full_numbers", *///分页样式：simple,simple_numbers,full,full_numbers
                /*   "table-layout":fix, */
                "row-border" : true,
                "oLanguage" : {
                    "sEmptyTable" : "没有记录",
                    "sProcessing" : "处理中，请稍候...",
                    "sLengthMenu" : "每页显示 _MENU_ 条记录",
                    "sZeroRecords" : "没有记录",
                    "sInfo" : " _START_ 到  _END_ 条记录,总记录数为 _TOTAL_ 条",
                    "sInfoEmpty" : "记录数为0",
                    "sInfoFiltered" : "(从全部记录数 _MAX_ 条中过滤)",
                    "sInfoPostFix" : "",
                    "sLoadingRecords" : "正在加载中,请稍候...",
                    "sSearch" : "搜索",
                    "sUrl" : "",
                    "oPaginate" : {
                        "sFirst" : "首页",
                        "sPrevious" : "上一页",
                        "sNext" : "下一页",
                        "sLast" : "末页"
                    }
                },
                ajax : {
                    url : getRootPath_web() +"elastic/contactList",
                    "type" : "post"
                },
                /*序号自增长*/
                "fnDrawCallback" : function(){
                    this.api().column(0).nodes().each(function(cell, i) {
                        cell.innerHTML =  i + 1;
                    });
                },
                "bDeferRender" : true,/*是否启用延迟加载：当你使用AJAX数据源时，可以提升速度。*/
                "columns": [
                    {"sTitle":'<font>序号</font>','sWidth' :'5%',"sClass" :"dt-left", 'bSortable': false,
                        'render': function(data, type, row, meta) {
                            if(data==""||data==null){
                                return "--";
                            }
                            return data;
                        }},
                    {"sTitle":'<font>手机号</font>',"sWidth":"7%","sClass":"dt-left", 'data': 'phone','bSortable': true,
                        'render': function(data, type, row, meta) {
                            if(data==""||data==null){
                                return "--";
                            }
                            return data;
                        }},
                    {"sTitle":'<font>归属地</font>',"sWidth":"7%","sClass":"dt-left", 'data': 'city','bSortable': true,
                        'render': function(data, type, row, meta) {
                            if(data==""||data==null){
                                return "--";
                            }
                            return data;
                        }},
                    {"sTitle":'<font>归属运营商</font>',"sWidth":"8%","sClass":"dt-left", 'data': 'operate','bSortable': true,
                        'render': function(data, type, row, meta) {
                            if(data==""||data==null){
                                return "--";
                            }
                            return data;
                        }},
                    {"sTitle":'<font>频次</font>',"sWidth":"7%","sClass":"dt-left", 'data': 'all','bSortable': true,
                        'render': function(data, type, row, meta) {
                            if(data==""||data==null){
                                return "--";
                            }
                            return data;
                        }},
                    {"sTitle":'<font>主叫频次</font>',"sWidth":"7%","sClass":"dt-left", 'data': 'calling','bSortable': true,
                        'render': function(data, type, row, meta) {
                            if(data==""||data==null){
                                return "--";
                            }
                            return data;
                        }},
                    {"sTitle":'<font>被叫频次</font>',"sWidth":"7%","sClass":"dt-left", 'data': 'called','bSortable': true,
                        'render': function(data, type, row, meta) {
                            if(data==""||data==null){
                                return "--";
                            }
                            return data;
                        }},
                    {"sTitle":'<font>频次排名</font>',"sWidth":"7%","sClass":"dt-left", 'data': 'allSort','bSortable': true,
                        'render': function(data, type, row, meta) {
                            if(data==""||data==null){
                                return "--";
                            }
                            return data;
                        }},
                    {"sTitle":'<font>时长（秒）</font>',"sWidth":"7%","sClass":"dt-left", 'data': 'duration','bSortable': true,
                        'render': function(data, type, row, meta) {
                            if(data==""||data==null){
                                return "--";
                            }
                            return data;
                        }},
                    {"sTitle":'<font>时长排名</font>',"sWidth":"6%","sClass":"dt-left", 'data': 'durationSort','bSortable': true,
                        'render': function(data, type, row, meta) {
                            if(data==""||data==null){
                                return "--";
                            }
                            return data;
                        }}
                ]
            });
        $("#dynamic-table_filter").css("display", "none");
    }

    //初始化通联人左边历史记录
    function commonPeopleO(Num) {
        $("#dynamic-table_filter").css('display', 'block');
        wt1101 = $("#wt1101").DataTable(
            {
                "paging": true,
                "bLengthChange" : false, /* 去掉每页显示多少条数据方法 */
                "iDisplayLength": 10, //默认每页数量
                "processing" : true,/*控制是否在数据加载时出现”Processing”的提示,一般在远程加载并且比较慢的情况下才会出现. 样式需要定义,否则比较丑.*/
                "pageLength" : 5,/*默认*/
                "lengthMenu" : [ [ 5, 10, 20, -1 ],
                    [ 5, 10, 20, "全部" ] ],
                /*"deferRender": true,*/
                "searching" : false,/*控制控件的搜索功能,如果为false,控件的搜索功能被完全禁用,而且默认搜索组件会被隐藏.*/
                "serverSide" : false,/* 启用服务器端分页,当设为true时,列表的过滤,搜索和排序信息会传递到Server端进行处理,实现真翻页方案的必需属性.反之,所有的列表功能都在客户端计算并执行*/
                "autoWidth" : false,/*用来启用或禁用自动列的宽度计算。通常被禁用作为优化（它需要一个有限的时间量来计算的宽度），默认值是true，所以通常将它设为false*/
                /*  "order": [   //表示先对第1列进行升序排序，再按照第二列升序排序，最后按照第三列降序排序
                 [0, "desc"]
                 ], */
                //因为需要多次初始化，所以需要设置允许销毁实例
                "destroy" : true,
                "bFilter" : false,
                "orderMulti" : false, //启用多列排序
                "order" : [], //取消默认排序查询,否则复选框一列会出现小箭头
                /* "pagingType": "full_numbers", *///分页样式：simple,simple_numbers,full,full_numbers
                /*   "table-layout":fix, */
                "row-border" : true,
                "oLanguage" : {
                    "sEmptyTable" : "没有记录",
                    "sProcessing" : "处理中，请稍候...",
                    "sLengthMenu" : "每页显示 _MENU_ 条记录",
                    "sZeroRecords" : "没有记录",
                    "sInfo" : " _START_ 到  _END_ 条记录,总记录数为 _TOTAL_ 条",
                    "sInfoEmpty" : "记录数为0",
                    "sInfoFiltered" : "(从全部记录数 _MAX_ 条中过滤)",
                    "sInfoPostFix" : "",
                    "sLoadingRecords" : "正在加载中,请稍候...",
                    "sSearch" : "搜索",
                    "sUrl" : "",
                    "oPaginate" : {
                        "sFirst" : "首页",
                        "sPrevious" : "上一页",
                        "sNext" : "下一页",
                        "sLast" : "末页"
                    }
                },
                ajax : {
                    url : getRootPath_web()+"/elastic/analyseList?analyseType="+Num,
                    "type" : "post",
                },
                "bDeferRender" : true,/*是否启用延迟加载：当你使用AJAX数据源时，可以提升速度。*/
                "columns": [
                    {"sTitle":'<font>开始日期</font>',"sWidth":"7%","sClass":"dt-left", 'data': 'createTime','bSortable': false,
                        'render': function(data, type, row, meta) {
                            if(data==""||data=="null"){
                                return "--";
                            }
                            return data;
                        }},
                    {"sTitle":'<font>手机号</font>',"sWidth":"7%","sClass":"dt-left", 'data': 'title','bSortable': false,
                        'render': function(data, type, row, meta) {
                            if(data==""||data=="null"){
                                return "--";
                            }
                            return data;
                        }},
                    {"sTitle":'<font>操作</font>',"sWidth":"7%","sClass":"dt-left", 'data': 'id','bSortable': false,
                        'render': function(data, type, row, meta) {
                            if( data==""||data=="null" ){
                                return "--";
                            }
                            var data = "'"+data+"'";
                            return '<a class="operation" onclick="Detail_One(' + data + ')">查看</a>'+
                                '<a class="operation" onclick="remove_One(' + data + ')">删除</a>';
                        }},
                ]
            });
        $("#dynamic-table_filter").css("display", "none");
    };
    //初始化共同分析人左边历史记录
    function commonPeopleT(Num) {
        $("#dynamic-table_filter").css('display', 'block');
        wt2202 = $("#wt2202").DataTable(
            {
                "paging": true,
                "bLengthChange" : false, /* 去掉每页显示多少条数据方法 */
                "iDisplayLength": 10, //默认每页数量
                "processing" : true,/*控制是否在数据加载时出现”Processing”的提示,一般在远程加载并且比较慢的情况下才会出现. 样式需要定义,否则比较丑.*/
                "pageLength" : 5,/*默认*/
                "lengthMenu" : [ [ 5, 10, 20, -1 ],
                    [ 5, 10, 20, "全部" ] ],
                /*"deferRender": true,*/
                "searching" : false,/*控制控件的搜索功能,如果为false,控件的搜索功能被完全禁用,而且默认搜索组件会被隐藏.*/
                "serverSide" : false,/* 启用服务器端分页,当设为true时,列表的过滤,搜索和排序信息会传递到Server端进行处理,实现真翻页方案的必需属性.反之,所有的列表功能都在客户端计算并执行*/
                "autoWidth" : false,/*用来启用或禁用自动列的宽度计算。通常被禁用作为优化（它需要一个有限的时间量来计算的宽度），默认值是true，所以通常将它设为false*/
                /*  "order": [   //表示先对第1列进行升序排序，再按照第二列升序排序，最后按照第三列降序排序
                 [0, "desc"]
                 ], */
                //因为需要多次初始化，所以需要设置允许销毁实例
                "destroy" : true,
                "bFilter" : false,
                "orderMulti" : false, //启用多列排序
                "order" : [], //取消默认排序查询,否则复选框一列会出现小箭头
                /* "pagingType": "full_numbers", *///分页样式：simple,simple_numbers,full,full_numbers
                /*   "table-layout":fix, */
                "row-border" : true,
                "oLanguage" : {
                    "sEmptyTable" : "没有记录",
                    "sProcessing" : "处理中，请稍候...",
                    "sLengthMenu" : "每页显示 _MENU_ 条记录",
                    "sZeroRecords" : "没有记录",
                    "sInfo" : " _START_ 到  _END_ 条记录,总记录数为 _TOTAL_ 条",
                    "sInfoEmpty" : "记录数为0",
                    "sInfoFiltered" : "(从全部记录数 _MAX_ 条中过滤)",
                    "sInfoPostFix" : "",
                    "sLoadingRecords" : "正在加载中,请稍候...",
                    "sSearch" : "搜索",
                    "sUrl" : "",
                    "oPaginate" : {
                        "sFirst" : "首页",
                        "sPrevious" : "上一页",
                        "sNext" : "下一页",
                        "sLast" : "末页"
                    }
                },
                ajax : {
                    url : getRootPath_web()+"/elastic/analyseList?analyseType="+Num,
                    "type" : "post",
                },
                "bDeferRender" : true,/*是否启用延迟加载：当你使用AJAX数据源时，可以提升速度。*/
                "columns": [
                    {"sTitle":'<font>开始日期</font>',"sWidth":"7%","sClass":"dt-left", 'data': 'createTime','bSortable': false,
                        'render': function(data, type, row, meta) {
                            if(data==""||data=="null"){
                                return "--";
                            }
                            return data;
                        }},
                    {"sTitle":'<font>手机号</font>',"sWidth":"7%","sClass":"dt-left", 'data': 'title','bSortable': false,
                        'render': function(data, type, row, meta) {
                            if(data==""||data=="null"){
                                return "--";
                            }
                            return data;
                        }},
                    {"sTitle":'<font>操作</font>',"sWidth":"7%","sClass":"dt-left", 'data': 'id','bSortable': false,
                        'render': function(data, type, row, meta) {
                            if( data==""||data=="null" ){
                                return "--";
                            }
                            var dataT = "'"+data+"'";
                            return '<a class="operation" onclick="Detail_T(' + dataT + ')">查看</a>'+
                                '<a class="operation" onclick="remove_T(' + dataT + ')">删除</a>';
                        }},
                ]
            });
        $("#dynamic-table_filter").css("display", "none");
    };
    //初始化同住人左边历史记录
    function commonPeopleS(Num) {
        $("#dynamic-table_filter").css('display', 'block');
        wt3303 = $("#wt3303").DataTable(
            {
                "paging": true,
                "bLengthChange" : false, /* 去掉每页显示多少条数据方法 */
                "iDisplayLength": 10, //默认每页数量
                "processing" : true,/*控制是否在数据加载时出现”Processing”的提示,一般在远程加载并且比较慢的情况下才会出现. 样式需要定义,否则比较丑.*/
                "pageLength" : 5,/*默认*/
                "lengthMenu" : [ [ 5, 10, 20, -1 ],
                    [ 5, 10, 20, "全部" ] ],
                /*"deferRender": true,*/
                "searching" : false,/*控制控件的搜索功能,如果为false,控件的搜索功能被完全禁用,而且默认搜索组件会被隐藏.*/
                "serverSide" : false,/* 启用服务器端分页,当设为true时,列表的过滤,搜索和排序信息会传递到Server端进行处理,实现真翻页方案的必需属性.反之,所有的列表功能都在客户端计算并执行*/
                "autoWidth" : false,/*用来启用或禁用自动列的宽度计算。通常被禁用作为优化（它需要一个有限的时间量来计算的宽度），默认值是true，所以通常将它设为false*/
                /*  "order": [   //表示先对第1列进行升序排序，再按照第二列升序排序，最后按照第三列降序排序
                 [0, "desc"]
                 ], */
                //因为需要多次初始化，所以需要设置允许销毁实例
                "destroy" : true,
                "bFilter" : false,
                "orderMulti" : false, //启用多列排序
                "order" : [], //取消默认排序查询,否则复选框一列会出现小箭头
                /* "pagingType": "full_numbers", *///分页样式：simple,simple_numbers,full,full_numbers
                /*   "table-layout":fix, */
                "row-border" : true,
                "oLanguage" : {
                    "sEmptyTable" : "没有记录",
                    "sProcessing" : "处理中，请稍候...",
                    "sLengthMenu" : "每页显示 _MENU_ 条记录",
                    "sZeroRecords" : "没有记录",
                    "sInfo" : " _START_ 到  _END_ 条记录,总记录数为 _TOTAL_ 条",
                    "sInfoEmpty" : "记录数为0",
                    "sInfoFiltered" : "(从全部记录数 _MAX_ 条中过滤)",
                    "sInfoPostFix" : "",
                    "sLoadingRecords" : "正在加载中,请稍候...",
                    "sSearch" : "搜索",
                    "sUrl" : "",
                    "oPaginate" : {
                        "sFirst" : "首页",
                        "sPrevious" : "上一页",
                        "sNext" : "下一页",
                        "sLast" : "末页"
                    }
                },
                ajax : {
                    url : getRootPath_web()+"/elastic/analyseList?analyseType="+Num,
                    "type" : "post",
                },
                "bDeferRender" : true,/*是否启用延迟加载：当你使用AJAX数据源时，可以提升速度。*/
                "columns": [
                    {"sTitle":'<font>开始日期</font>',"sWidth":"7%","sClass":"dt-left", 'data': 'createTime','bSortable': false,
                        'render': function(data, type, row, meta) {
                            if(data==""||data=="null"){
                                return "--";
                            }
                            return data;
                        }},
                    {"sTitle":'<font>身份证</font>',"sWidth":"7%","sClass":"dt-left", 'data': 'title','bSortable': false,
                        'render': function(data, type, row, meta) {
                            if(data==""||data=="null"){
                                return "--";
                            }
                            return data;
                        }},
                    {"sTitle":'<font>操作</font>',"sWidth":"7%","sClass":"dt-left", 'data': 'id','bSortable': false,
                        'render': function(data, type, row, meta) {
                            if( data==""||data=="null" ){
                                return "--";
                            }
                            var dataS = "'"+data+"'";
                            return '<a class="operation" onclick="Detail_S(' + dataS + ')">查看</a>'+
                                '<a class="operation" onclick="remove_S(' + dataS + ')">删除</a>';
                        }},
                ]
            });
        $("#dynamic-table_filter").css("display", "none");
    };
    //初始化话单左边历史记录
    function commonPeopleF(Num) {
        $("#dynamic-table_filter").css('display', 'block');
        wt4404 = $("#wt4404").DataTable(
            {
                "paging": true,
                "bLengthChange" : false, /* 去掉每页显示多少条数据方法 */
                "iDisplayLength": 10, //默认每页数量
                "processing" : true,/*控制是否在数据加载时出现”Processing”的提示,一般在远程加载并且比较慢的情况下才会出现. 样式需要定义,否则比较丑.*/
                "pageLength" : 5,/*默认*/
                "lengthMenu" : [ [ 5, 10, 20, -1 ],
                    [ 5, 10, 20, "全部" ] ],
                /*"deferRender": true,*/
                "searching" : false,/*控制控件的搜索功能,如果为false,控件的搜索功能被完全禁用,而且默认搜索组件会被隐藏.*/
                "serverSide" : false,/* 启用服务器端分页,当设为true时,列表的过滤,搜索和排序信息会传递到Server端进行处理,实现真翻页方案的必需属性.反之,所有的列表功能都在客户端计算并执行*/
                "autoWidth" : false,/*用来启用或禁用自动列的宽度计算。通常被禁用作为优化（它需要一个有限的时间量来计算的宽度），默认值是true，所以通常将它设为false*/
                /*  "order": [   //表示先对第1列进行升序排序，再按照第二列升序排序，最后按照第三列降序排序
                 [0, "desc"]
                 ], */
                //因为需要多次初始化，所以需要设置允许销毁实例
                "destroy" : true,
                "bFilter" : false,
                "orderMulti" : false, //启用多列排序
                "order" : [], //取消默认排序查询,否则复选框一列会出现小箭头
                /* "pagingType": "full_numbers", *///分页样式：simple,simple_numbers,full,full_numbers
                /*   "table-layout":fix, */
                "row-border" : true,
                "oLanguage" : {
                    "sEmptyTable" : "没有记录",
                    "sProcessing" : "处理中，请稍候...",
                    "sLengthMenu" : "每页显示 _MENU_ 条记录",
                    "sZeroRecords" : "没有记录",
                    "sInfo" : " _START_ 到  _END_ 条记录,总记录数为 _TOTAL_ 条",
                    "sInfoEmpty" : "记录数为0",
                    "sInfoFiltered" : "(从全部记录数 _MAX_ 条中过滤)",
                    "sInfoPostFix" : "",
                    "sLoadingRecords" : "正在加载中,请稍候...",
                    "sSearch" : "搜索",
                    "sUrl" : "",
                    "oPaginate" : {
                        "sFirst" : "首页",
                        "sPrevious" : "上一页",
                        "sNext" : "下一页",
                        "sLast" : "末页"
                    }
                },
                ajax : {
                    url : getRootPath_web()+"/elastic/analyseList?analyseType="+Num,
                    "type" : "post",
                },
                "bDeferRender" : true,/*是否启用延迟加载：当你使用AJAX数据源时，可以提升速度。*/
                "columns": [
                    {"sTitle":'<font>开始日期</font>',"sWidth":"7%","sClass":"dt-left", 'data': 'createTime','bSortable': false,
                        'render': function(data, type, row, meta) {
                            if(data==""||data=="null"){
                                return "--";
                            }
                            return data;
                        }},
                    {"sTitle":'<font>手机号</font>',"sWidth":"7%","sClass":"dt-left", 'data': 'title','bSortable': false,
                        'render': function(data, type, row, meta) {
                            if(data==""||data=="null"){
                                return "--";
                            }
                            return data;
                        }},
                    {"sTitle":'<font>操作</font>',"sWidth":"7%","sClass":"dt-left", 'data': 'id','bSortable': false,
                        'render': function(data, type, row, meta) {
                            if( data==""||data=="null" ){
                                return "--";
                            }
                            var dataF = "'"+data+"'";
                            return '<a class="operation" onclick="Detail_F(' + dataF + ')">查看</a>'+
                                '<a class="operation" onclick="remove_F(' + dataF + ')">删除</a>';
                        }},
                ]
            });
        $("#dynamic-table_filter").css("display", "none");
    };
    //初始化通联人左边历史记录删除和查询
    function remove_One(the_id) {
        layer.confirm( "你确定要删除这条历史记录吗？",
            { btn: ['确认', '取消'] },
            function () {
                $.ajax({
                    url: getRootPath_web() + "elastic/deleteAnalyse",
                    type: "post",
                    dataType: "json",
                    data: {
                        id: the_id
                    },
                    success: function (data) {
                        if (data.code == 200) {
                            layer.msg(data.msg, {icon: 1});
                            commonPeopleO(1)
                        }
                        else {
                            layer.msg(data.msg, {icon: 2});
                        }
                    },
                    error: function (data) {
                        layer.msg('操作失败！', {icon: 2});
                    }
                });
                layer.closeAll();
            },
            function () {
                layer.closeAll();
                /*进行取消操作*/
            }
        );
    }
    function  Detail_One(id) {
        $("#btn_yes_O").hide();
        $.ajax({
            type: 'POST',
            url: getRootPath_web()+"/elastic/findAnalyseById",//发送请求
            dataType : "json",
            data:{
                id:id,
            },
            success:function ( data ) {
                var root = data.content.substring(3);
                var dataa = JSON.parse(root);

                var dow = data.term.substring(3);
                var term = JSON.parse(dow);
                $("#startTime").val( term.startTime );
                $("#phoneNumber").val( term.phoneNumber );
                $("#TonlyTime option").each( function () {
                    if( $(this).val() == term.TonlyTime  ){
                        $(this).attr("selected", "selected")
                    }
                });
                $("#TopNumber option").each( function () {
                    if( $(this).val() == term.Topnumber  ){
                        $(this).attr("selected", "selected")
                    }
                })
                conmmunOne( dataa  );
                $("input[name='contact']").attr("disabled",true);
            }
        });
    }
    //初始化共同分析人左边历史记录删除和查询
    function remove_T(the_id) {
        layer.confirm( "你确定要删除这条历史记录吗？",
            { btn: ['确认', '取消'] },
            function () {
                $.ajax({
                    url: getRootPath_web() + "elastic/deleteAnalyse",
                    type: "post",
                    dataType: "json",
                    data: {
                        id: the_id
                    },
                    success: function (data) {
                        if (data.code == 200) {
                            layer.msg(data.msg, {icon: 1});
                            commonPeopleT(2)
                        }
                        else {
                            layer.msg(data.msg, {icon: 2});
                        }
                    },
                    error: function (data) {
                        layer.msg('操作失败！', {icon: 2});
                    }
                });
                layer.closeAll();
            },
            function () {
                layer.closeAll();
                /*进行取消操作*/
            }
        );
    }
    function  Detail_T(id) {
        $("#btn_yes_T").hide();
        $.ajax({
            type: 'POST',
            url: getRootPath_web()+"/elastic/findAnalyseById",//发送请求
            dataType : "json",
            data:{
                id:id,
            },
            success:function ( data ) {
                var root = data.content.substring(3);
                var dataw = JSON.parse(root);
                var dow = data.term.substring(3);
                var term = JSON.parse(dow);
                $("#relationshipTime").val( term.startTime );
                $("#MultiplePhone").val( term.phoneNumber );
                $("input[name='relationship']").attr("disabled",true);
                refreshOne( dataw  );
            }
        });
    }
    //初始化同住人左边历史记录删除和查询
    function remove_S(the_id) {
        layer.confirm( "你确定要删除这条历史记录吗？",
            { btn: ['确认', '取消'] },
            function () {
                $.ajax({
                    url: getRootPath_web() + "elastic/deleteAnalyse",
                    type: "post",
                    dataType: "json",
                    data: {
                        id: the_id
                    },
                    success: function (data) {
                        if (data.code == 200) {
                            layer.msg(data.msg, {icon: 1});
                            commonPeopleS(3)
                        }
                        else {
                            layer.msg(data.msg, {icon: 2});
                        }
                    },
                    error: function (data) {
                        layer.msg('操作失败！', {icon: 2});
                    }
                });
                layer.closeAll();
            },
            function () {
                layer.closeAll();
                /*进行取消操作*/
            }
        );
    }
    function  Detail_S(id) {
        $("#btn_yes_S").hide();
        $.ajax({
            type: 'POST',
            url: getRootPath_web()+"/elastic/findAnalyseById",//发送请求
            dataType : "json",
            data:{
                id:id,
            },
            success:function ( data ) {
                var root = data.content.substring(3);
                var dataS = JSON.parse(root);
                var dow = data.term.substring(3);
                var term = JSON.parse(dow);
                $("#idNumHotel").val( term.idNumHotel );
                $("#liveTime option").each( function () {
                    if( $(this).val() == term.liveTime  ){
                        $(this).attr("selected", "selected")
                    }
                })
                $("#ale input").attr("disabled",true);
                dataType( dataS  );
            }
        });
    }
    //初始化话单左边历史记录删除和查询
    function remove_F(the_id) {
        layer.confirm( "你确定要删除这条历史记录吗？",
            { btn: ['确认', '取消'] },
            function () {
                $.ajax({
                    url: getRootPath_web() + "elastic/deleteAnalyse",
                    type: "post",
                    dataType: "json",
                    data: {
                        id: the_id
                    },
                    success: function (data) {
                        if (data.code == 200) {
                            layer.msg(data.msg, {icon: 1});
                            commonPeopleF(4)
                        }
                        else {
                            layer.msg(data.msg, {icon: 2});
                        }
                    },
                    error: function (data) {
                        layer.msg('操作失败！', {icon: 2});
                    }
                });
                layer.closeAll();
            },
            function () {
                layer.closeAll();
                /*进行取消操作*/
            }
        );
    }
    function  Detail_F(id) {
        $("#btn_yes_F").hide();
        $.ajax({
            type: 'POST',
            url: getRootPath_web()+"/elastic/findAnalyseById",//发送请求
            dataType : "json",
            data:{
                id:id,
            },
            success:function ( data ) {
                var root = data.content.substring(3);
                var datae = JSON.parse(root);

                var dow = data.term.substring(3);
                var term = JSON.parse(dow);
                $("#startTime1").val( term.startTime1 );
                $("#phoneNumber1").val( term.phoneNumber1 );
                $("#TonlyTime1 option").each( function () {
                    if( $(this).val() == term.TonlyTime1  ){
                        $(this).attr("selected", "selected")
                    }
                });
                $("#TopNumber1 option").each( function () {
                    if( $(this).val() == term.Topnumber1  ){
                        $(this).attr("selected", "selected")
                    }
                })
                $("input[name='phone']").attr("disabled",true);
                conmmunW( datae  );
            }
        });
    }
</script>
<!--通联人分析-->
<script type="text/javascript">
    $("#showStype input").click(function () {
        $("#wt100 > div").eq($(this).index()).show().siblings().hide();
    })
    var ayyre1;
    getNowFormatDate();
    function getNowFormatDate() {
        var date = new Date();
        var seperator1 = "-";
        var seperator2 = ":";
        var month = date.getMonth() + 1;
        var strDate = date.getDate();
        if (month >= 1 && month <= 9) {
            month = "0" + month;
        }
        if (strDate >= 0 && strDate <= 9) {
            strDate = "0" + strDate;
        }
        var currentdate = date.getFullYear() + seperator1 + month + seperator1 + strDate;
        $("#startTime").val(currentdate);
        $("#finishTime").val(currentdate);
        return currentdate;
    }
    var startTime = $("#startTime").val();
    removeDate(startTime,90);
    function removeDate(date,days){
        var d=new Date(date);
        d.setDate(d.getDate()-days);
        var m=d.getMonth()+1;
        if (m >= 0 && m <= 9) {
            m = "0" + m;
        }
        var getDate = d.getDate();
        if ( getDate >= 0 && getDate <= 9) {
            getDate = "0" + getDate;
        }
        $("#startTime").val(d.getFullYear()+'-'+m+'-'+getDate );
        $("#startTime2").val(d.getFullYear()+'-'+m+'-'+getDate);
        return d.getFullYear()+'-'+ m +'-'+d.getDate();
    }
    //通联人请求数据返回渲染
    function conmmun() {
        $("input[name='contact']").attr("disabled",false);
        $("input[name='contact']").attr("checked",false);
        $("input[name='contact'][value='1']").prop("checked",true);
        $("input[name='contact'][value='0']").prop("checked",true);
        $("#btn_yes_O").show();
        $(".wt110 svg").remove();
        var chaxuntext = $(".chaxuntext").text;
        //获取到当前的时间减去90天的时间
        var startTime2 = $("#startTime2").val();
        var finishTime = $("#finishTime").val();
        //开始时间
        var startTime = $("#startTime").val();
        //手机号码
        var phoneNumber = $("#phoneNumber").val();
        //通联时段
        var TonlyTime = $("#TonlyTime option:checked").val();
        //TOP数量
        var Topnumber = $("#TopNumber option:checked").val();
        var object = new Object();
        // object["TonlyTime"] = TonlyTime;
        // object["Topnumber"] = Topnumber;
        //返回后台值
        // http://blog.thomsonreuters.com/index.php/mobile-patent-suits-graphic-of-the-day/
        $("#startTime11").val( startTime );
        if( startTime == startTime2 ){
            object["startTime"] = $("#startTime").val();
            object["finishTime"] = $("#finishTime").val();
        }else{
            addDate(startTime,90);
            function addDate(date,days){
                var d=new Date(date);
                d.setDate(d.getDate()+days);
                var m=d.getMonth()+1;
                if (m >= 0 && m <= 9) {
                    m = "0" + m;
                }
                var getDate = d.getDate();
                if ( getDate >= 0 && getDate <= 9) {
                    getDate = "0" + getDate;
                }
                $("#finishTime").val(d.getFullYear()+'-'+m+'-'+getDate );
                return d.getFullYear()+'-'+m+'-'+d.getDate();
            }
            object["startTime"] = $("#startTime").val();
            object["finishTime"] = $("#finishTime").val();
        }
        if( startTime == "" ){
            layer.msg('请输入开始时间！',{time:600});
            return false
        }
        if( phoneNumber == "" ){
            layer.msg('请输入电话号码！',{time:600});
            return false
        }
        var myreg=/^[1][3,4,5,7,8][0-9]{9}$/;
        if (!myreg.test(phoneNumber)) {
            layer.msg('电话号码格式不正确！',{time:600});
            return false;
        }
        object["phoneNumber"] = phoneNumber;
        //全局通联人分析号码
        contactPhone = phoneNumber;
        window.parent.layer.load(1, {shade: [0.3, '#393D49']});
        $.ajax({
            url: projectPath+"elastic/contactPerson",
            //url:"../data/data.json",
            type: "post",
            dataType: "json",
            data: object,
            success: function (data) {
                if( data.flag ){
                    //$.cookie('DedicatedPeople2',JSON.stringify(data));
                    //$("#DedicatedPeople2").attr("data",data);
                    //$("#iframe").attr("src","newHtml.html");
                    sessionStorage.setItem("add",1);
                    sessionStorage.setItem("startTime",startTime);
                    sessionStorage.setItem("phoneNumber",phoneNumber);
//					sessionStorage.setItem("TonlyTime",TonlyTime);
//					sessionStorage.setItem("TopNumber",TopNumber);
                    sessionStorage.setItem("DedicatedPeople2",JSON.stringify(data.statistics))
                    //加载通联人表格
                    dynamictable_contact.search("").draw();
                    commonData = data.statistics;
                    // var root = data.statistics;
                    // conmmunOne(root);
                    //默认不勾选的条件
                    var condition = "2,3,4,5";
                    //根据勾选刷新页面
                    refreshDataByCondition(commonData,"contact",condition);
                    var root = data.statistics;
                    window.parent.layer.closeAll('loading');
                }else{
                    layer.alert("查询失败！");
                }
            }
        })
    }
    function conmmunOne( root ) {
        console.log( "root=" + root );
        ayyre1 = root;
        $(".wt110 > svg").remove();
        var width = document.documentElement.scrollWidth - 40 || document.body.scrollWidth - 40;
        var height = document.documentElement.scrollHeight - 110 || document.body.scrollHeight - 110;
        var nodes = {};
        root.forEach(function(link) {//参考https://stackoverflow.com/questions/23986466/d3-force-layout-linking-nodes-by-name-instead-of-index
            //利用source和target名称进行连线以及节点的确认
            link.target = nodes[link.phone] || (nodes[link.phone] = {name: link.phone});
            link.source = nodes[link.phoneNumber] || (nodes[link.phoneNumber] = {name: link.phoneNumber});
        });
        var force = d3.layout.force()//layout将json格式转化为力学图可用的格式
            .nodes(d3.values(nodes))//设定节点数组
            .links(root)//设定连线数组
            .friction(0.12)//摩擦系数0-1
            .linkStrength(0)//* linkStrength() ： 數值從0~1，控制綫的牽引力，如果說設定為1的時候，拉動某一個點，其它點也會跟著移動如果是設定為0的時候，拉動一個點，其它點會保持不動，綫會拉長。
            .size([width, height])//大小
            .linkDistance(350)//连接线长度
            .charge(-1900)//值为+，则相互吸引，绝对值越大吸引力越大。值为-，则相互排斥，绝对值越大排斥力越大
            .on("tick", tick)//指时间间隔，隔一段时间刷新一次画面
            .start(0);//开始转换
        var zoom = d3.behavior.zoom() //缩放配置，
            .scaleExtent([0,2]) //缩放比例
            .on("zoom", zoomed);
        function zoomed() { //缩放函数
            svg.selectAll("g").attr("transform", //svg下的g标签移动大小
                "translate(" + d3.event.translate + ")scale(" + d3.event.scale + ")");
        }
        var svg = d3.select(".wt110").append("svg") //添加svg元素进行图形的绘制
            .attr("width", width)
            .attr("height", height)
            .call(zoom);
        //箭头
        var marker = //注意SVG规范中明确指出，附加到一个'Marker'元素上的“事件属性和事件的listener”不会被处理
            svg.append("marker") //添加一个marker标签来绘制箭头
                .attr("id", "resolved") //箭头id，用于其他标记进行引用时的url
                .attr("markerUnits", "userSpaceOnUse") //定义标记的坐标系统，userSpaceOnUse表示按照引用的元件来决定，strokeWidth按照用户单位决定
                .attr("viewBox", "0 -5 10 10") //坐标系的区域
                .attr("refX", 40) //箭头坐标X轴
                .attr("refY", 0)  //箭头坐标Y轴
                .attr("markerWidth", 12) //标识的大小
                .attr("markerHeight", 12)
                .attr("orient", "auto") //绘制方向，可设定为：auto（自动确认方向）和 角度值
                .attr("stroke-width", 3) //箭头宽度
                .append("path")
                .attr("d", "M0,-5L10,0L0,5") //绘制箭头，路径为一个三角形，有疑问参考svg的path http://www.runoob.com/svg/svg-path.html
                .attr('fill', '#000000'); //箭头颜色
        //设置连接线
        var edges_line = svg.append("g").selectAll(".edgepath")
            .data(root) //连线数据
            .enter() //当数组中的个数大于元素个数时，由d3创建空元素并与数组中超出的部分进行绑定。
            //可以参考http://www.ourd3js.com/wordpress/797/ enter、exit、update的区别
            .append("path") //添加path标签
            .attr({
                'd': function (d) {
                    return 'M ' + d.source.x + ' ' + d.source.y + ' L ' + d.target.x + ' ' + d.target.y
                }, //变量 d 是由D3.js提供的一个在匿名函数中的可用变量。这个变量是对当前要处理的元素的_data_属性的引用。
                'class': 'edgepath', //定义该path标签class为edgepath
                'id': function (d, i) {
                    return 'edgepath' + i;
                },
                'pid': function (d, i) {
                    return d.phoneNumber;
                },
                'zid': function (d, i) {
                    return d.phone;
                },
                'wid': function (d,i) {
                    return d.exception;
                },
            }) // i也是d3.js提供的变量，表示当前处理的HTML元素在已选元素选集中的索引值
            .style("stroke", "#4874C2") //设置线条颜色
            .style("stroke-width", 2) //线条粗细
            .attr("marker-end", "url(#resolved)"); //根据箭头标记的id号引用箭头
        //连线上的文字
        var edges_text = svg.append("g").selectAll(".edgelabel")
            .data(root)
            .enter()
            .append("text") //添加text标签
            .attr({
                'class': 'edgelabel', //定义该text标签class为edgelabel
                'id': function (d, i) {
                    return 'edgepath' + i;
                },
                'dx': 60, //在连线上的坐标
                'dy': 0
            });
        //设置线条上的文字路径
        edges_text.append('textPath')
            .attr('xlink:href', function (d, i) {
                return '#edgepath' + i
            })
            .style("pointer-events", "none")
            .text(function (d) {
                //console.log("频次"+d.duration+"-"+"排名"+ d.durationSort)
                // var theTime = parseInt(d.duration);// 秒
                // var minute = 0;// 分
                // var hour = 0;// 小时
                // var skyNumber = 0;// 天
                // if(theTime > 60) {
                //     minute = parseInt(theTime/60);
                //     theTime = parseInt(theTime%60);
                //     if( minute > 60 ) {
                //         hour = parseInt(minute/60);
                //         minute = parseInt(minute%60);
                //     }
                // }
                // if( hour > 24 ) {
                //     skyNumber = parseInt(hour/24);
                //     hour = parseInt(hour%60);
                // }
                // var result = ""+parseInt(theTime)+"秒";
                // if(minute > 0) {
                //     result = ""+parseInt(minute)+"分"+result;
                // }
                // if(hour > 0) {
                //     result = ""+parseInt(hour)+"小时"+result;
                // }
                // if(skyNumber > 0) {
                //     result = ""+parseInt(skyNumber)+"天"+result;
                // }
                var html="";
                if($("#phoneNumber").val()==d.phoneNumber){

                    html= "主叫频次"+ d.calling +"-"+"积分"+ d.integral;
                }else{

                    html= "被叫频次"+ d.called +"-"+"积分"+ d.integral;
                }
                return html;
            });
        function drag() { //拖拽函数
            return force.drag()
                .on("dragstart", function (d) {
                    d3.event.sourceEvent.stopPropagation(); //取消默认事件
                    d.fixed = true; //拖拽开始后设定被拖拽对象为固定
                });
        }
        //圆圈的提示文字 根据需要到数据库中进行读取数据
        var tooltip = d3.select("body")
            .append("div") //添加div并设置成透明
            .attr("class", "tooltip")
            .style("opacity", 0.0);
        //圆圈
        var circle = svg.append("g").selectAll("image")
            .data(force.nodes())
            .enter()
            .append("image")
            .attr("xlink:href", function (d) {
                if( d.name.length == 11 ){
                    return "img/1.2_phone_mobile.png";
                }else{
                    return "img/1.1_phone_fixed.png";
                }
            })
            .attr("id", function (d) {
                return d.name;
            })
            .attr("width", "60px") //设置图片的宽
            .attr("height", "60px") //设置图片的高
            .attr("class", "polo") //
            .on("click", function (node) {
                //单击时让连接线加粗
                edges_line.style("stroke-width", function (line) {
                    var addPush = [];
                    if ( line.source.name == node.name || line.target.name == node.name ) { //当与连接点连接时变粗
                        return 4;
                    } else {
                        return 2;
                    }
                });
                circle.style('stroke-width', 2); //所有的圆圈边框
                d3.select(this).style('stroke-width', 4); //被选中的圆圈边框
            })
            .call(drag()); //使顶点可以被拖动
        svg.selectAll("g").call(drag()); //为svg下的所有g标签添加拖拽事件
        svg.on("dblclick.zoom", null); //取消svg和圆圈的双击放大事件（d3中默认开启7个事件，关闭防止与上面的双击事件冲突）
        circle.on("dblclick.zoom", null);
        var text = svg.append("g").selectAll("text")
            .data(force.nodes())
            //返回缺失元素的占位对象（placeholder），指向绑定的数据中比选定元素集多出的一部分元素。
            .enter()
            .append("text") //添加text标签
            .attr("dy", "5.5em") //将文字下移
            .attr("text-anchor", "middle") //在圆圈中加上数据
            .style('fill', function (node) {
                var color = "#4874C2"; //文字颜色
                return color;
            })
            .attr('x', function (d) {
                // console.log(d.name+"---"+ d.name.length);
                var re_en = /[a-zA-Z]+/g;
                //如果是全英文，不换行
                if (d.name.match(re_en) ) {
                    d3.select(this).append('tspan') //添加tspan用来方便时使用绝对或相对坐标来调整文本
                        .attr('x', 0)
                        .attr('y', 2)
                        .attr('class',"prev")
                        .text(function () {
                            return d.name;
                        });
                }
                //如果小于8个字符，不换行
                else if (d.name.length <= 15) {
                    d3.select(this).append('tspan')
                        .attr('x', 0)
                        .attr('y', 2)
                        .attr('class',"prev")
                        .text(function () {
                            return d.name;
                        });
                }
                d3.select(this).append('tspan') //添加tspan用来方便时使用绝对或相对坐标来调整文本
                    .attr('x', 0)
                    .attr('y', 2)
                    .attr("dy", "6.5em") //将文字下移
                    .text(function () {
                        return "";
                    });
            })
        function tick() { //刷新页面函数
            circle.attr("transform", transform1); //圆圈
            text.attr("transform", transform2); //顶点文字
            edges_line.attr('d', function (d) { //连接线
                var path = 'M ' + d.source.x + ' ' + d.source.y + ' L ' + d.target.x + ' ' + d.target.y;
                return path;
            });
            edges_text.attr('transform', function (d, i) { //连线上的文字
                if (d.target.x < d.source.x) { //判断起点和终点的位置，来让文字一直显示在线的上方且一直是正对用户
                    bbox = this.getBBox(); //获取矩形空间,并且调整翻转中心。（因为svg与css中的翻转不同，具体区别可看http://www.zhangxinxu.com/wordpress/2015/10/understand-svg-transform/）
                    rx = bbox.x + bbox.width / 2;
                    ry = bbox.y + bbox.height / 2;
                    return 'rotate(180 ' + rx + ' ' + ry + ')';
                } else {
                    return 'rotate(0)';
                }
            })
                .attr('dx', function (d, i) {
                    return Math.sqrt(Math.pow(d.target.x - d.source.x, 2) + Math.pow(d.target.y - d.source.y, 2)) / 2 - 20;
                    //设置文字一直显示在线的中间
                });
        }
        //设置图片的坐标
        function transform1(d) {
            return "translate(" + (d.x - 20) + "," + (d.y - 30) + ")";
        }
        //设置文字的坐标
        function transform2(d) {
            return "translate(" + (d.x + 10) + "," + (d.y - 15) + ")";
        }
        $(".prev").each(function () {
            var texi = $(this);
            $.each(root,function(i,item){
                if(  texi.text() ==  item.phoneNumber   ){
                    if( item.casetag == null || item.casetag == "" || item.casetag == undefined ){
                        texi.next().text( "备注：暂无备注" );
                    }else{
                        texi.next().text( "备注："+ item.casetag );
                    }
                }else if (  texi.text() ==  item.phone   ) {
                    if( item.casetag == null || item.casetag == "" || item.casetag == undefined ){
                        texi.next().text( "备注：暂无备注" );
                    }else{
                        texi.next().text( "备注："+ item.casetag );
                    }
                }
            });
        })
        //删除和备注某一条信息
        $(".polo").click(function () {
            event.stopPropagation();
            $("#details").hide();
            $(".information").hide();
            var d = $(this);
            var pos = d.offset();
            var t = pos.top + d.height(); // 弹出框的上边位置
            var l = pos.left + d.width();  // 弹出框的左边位置
            $("#details").css({ "top": t, "left": l });
            $("#details").show();
            var thsid = $(this).attr("id");
            var thsida = $(this).attr("ida");
            var initLiveTable1  = sessionStorage.getItem("DedicatedPeople2");
            var data = $.parseJSON(initLiveTable1);
            var ayyre = [];
            if( thsid == $("#phoneNumber").val() ){
                $("#details").hide();
            }
            //删除当前的节点和元素
            $(".remove_hiw").unbind('click').click(function (event) {
                event.stopPropagation();
                $("#details").hide();
                if( $("#phoneNumber").val() == thsid ){
                    layer.confirm('当前人员为搜索人员，如果删除则数据为空！', {
                        btn: ['确定','取消'] //按钮
                    }, function(){
                        sessionStorage.setItem("DedicatedPeople2",JSON.stringify(""));
                        layer.closeAll();
                        conmmunOne("");
                        ayyre1 = "";
                    }, function(){
                        layer.closeAll();
                    });
                    $(this).parent().hide();
                }else{
                    layer.confirm('是否要删除当前的人员？', {
                        btn: ['确定','取消'] //按钮
                    }, function(){
                        $.each(data,function (i,root) {
                            if( thsid ==  root.phone ||  thsid ==  root.phoneNumber  ) {
                                //thsid.remove()
                            }else{
                                ayyre.push( root );
                            }
                        });
                        sessionStorage.setItem("DedicatedPeople2",JSON.stringify(ayyre));
                        conmmunOne(ayyre);
                        layer.closeAll();
                        ayyre1 = ayyre;
                    }, function(){
                        layer.closeAll();
                    });
                    $(this).parent().hide();
                }
            });
            //给当前节点添加备注
            $(".ToView").unbind('click').click(function (event) {
                event.stopPropagation();
                $("#textarea_id").val("");
                $("#details").hide();
                layer.open({
                    title : "备注信息",
                    content:"<textarea id='textarea_id'></textarea>",
                    btn : [ '确定', '取消' ],
                    yes:function(){
                        $.each(data,function (i,root) {
                            if( thsid ==  root.phoneNumber   ) {
                                root.casetag = $("#textarea_id").val();
                                ayyre.push( root );
                            }else if( thsid ==  root.phone   ){
                                root.casetag = $("#textarea_id").val();
                                ayyre.push( root );
                            }else{
                                ayyre.push( root );
                            }
                        });
                        sessionStorage.setItem("DedicatedPeople2",JSON.stringify(ayyre));
                        conmmunOne(ayyre);
                        layer.closeAll();
                        ayyre1 = ayyre;
                    },btn2:function (index,layero) {
                        layer.close(index);
                    }
                })
            })
        });
        $(".edgepath").click(function () {
            list($(this).attr("zid"),$(this).attr("pid"),$("#startTime11").val(), $("#finishTime").val());
        })
        $(".edgepath").hover(function () {
            var exceptionOne = $(this).attr("wid").split(",");
            //数组排序如果后台返回来了无规律的属性且需要排序
            function sequence(a,b){
                if ( a > b ) {
                    return 1;
                }else if(a<b){
                    return -1
                }else{
                    return 0;
                }
            }
            var exceptionValue =  exceptionOne.sort(sequence).join("");
            if( exceptionValue.indexOf("0") != -1 && exceptionValue.indexOf("1")  != -1 && exceptionValue.indexOf("2")  != -1 && exceptionValue.indexOf("3") != -1 ){
                layer.msg("时长异常,频次异常,时段异常",{time:0});
            }else if( exceptionValue.indexOf("0")  != -1 && exceptionValue.indexOf("1")  != -1 && exceptionValue.indexOf("2")  != -1 ){
                layer.msg("时长异常,频次异常",{time:0});
            }else if( exceptionValue.indexOf("0")  != -1 && exceptionValue.indexOf("1")  != -1 && exceptionValue.indexOf("3")  != -1 ){
                layer.msg("时长异常,时段异常",{time:0});
            }else if( exceptionValue.indexOf("0")  != -1 && exceptionValue.indexOf("3")  != -1 && exceptionValue.indexOf("2")  != -1 ){
                layer.msg("频次异常,时段异常",{time:0});
            }else if( exceptionValue.indexOf("0") != -1 && exceptionValue.indexOf("1") != -1 ){
                layer.msg("时长异常",{time:0});
            }else if( exceptionValue.indexOf("0")  != -1 && exceptionValue.indexOf("2") != -1 ){
                layer.msg("频次异常",{time:0});
            }else if( exceptionValue.indexOf("0")  != -1 && exceptionValue.indexOf("3")  != -1 ){
                layer.msg("时段异常",{time:0});
            }
        },function(){
            layer.msg("",{time:10});
        })
    };
    //点击保存分析结果
    $("#btn_yes_O").unbind('click').click(function () {
        var object = new Object();
        //开始时间
        var startTime = $("#startTime").val();
        //手机号码
        var phoneNumber = $("#phoneNumber").val();
        //通联时段
        var TonlyTime = $("#TonlyTime option:checked").val();
        //TOP数量
        var Topnumber = $("#TopNumber option:checked").val();
        object["TonlyTime"] = TonlyTime;
        object["Topnumber"] = Topnumber;
        object["phoneNumber"] = phoneNumber;
        object["startTime"] = startTime;
        console.log( ayyre1 );
        $.ajax({
            type: 'POST',
            url: getRootPath_web()+"/elastic/saveAnalyse",//发送请求
            dataType : "json",
            data:{
                id:"",
                userId:"",
                createUser:"",
                analyseType:"1",
                content:"str"+JSON.stringify(ayyre1),
                title:phoneNumber,
                term:"str"+JSON.stringify(object)
            },
            success:function (data) {
                if( data.code == "200" ){
                    layer.msg(data.msg, {icon: 1});
                }else{
                    layer.msg(data.msg, {icon: 2});
                }
            }
        });
        commonPeopleO("1");
    })
</script>
<!--共同关系人分析-->
<script type="text/javascript">
    $("#showStype_O input").click(function () {
        $("#wt200 > div").eq($(this).index()).show().siblings().hide();
    });
    var ayyre1;
    var ayyreaddPush;
    getNowFormatDate();
    function getNowFormatDate() {
        var date = new Date();
        var seperator1 = "-";
        var seperator2 = ":";
        var month = date.getMonth() + 1;
        var strDate = date.getDate();
        if (month >= 1 && month <= 9) {
            month = "0" + month;
        }
        if (strDate >= 0 && strDate <= 9) {
            strDate = "0" + strDate;
        }
        var currentdate = date.getFullYear() + seperator1 + month + seperator1 + strDate;
        $("#relationshipTime").val(currentdate);
        return currentdate;
    }
    var startTime = $("#relationshipTime").val();
    removeDate(startTime,365);
    function removeDate(date,days){
        var d=new Date(date);
        d.setDate(d.getDate()-days);
        var m=d.getMonth()+1;
        if (m >= 0 && m <= 9) {
            m = "0" + m;
        }
        var getDate = d.getDate();
        if ( getDate >= 0 && getDate <= 9) {
            getDate = "0" + getDate;
        }
        $("#relationshipTime").val(d.getFullYear()+'-'+m+'-'+getDate);
        return d.getFullYear()+'-'+ m +'-'+d.getDate();
    }
    function showStype_O() {
        var push_add = [];
        var push_add2 = [];
        var push_add3 = [];
        $("input[name='relationship']").attr("disabled",false);
        $("input[name='relationship']").attr("checked",false);
        $("input[name='relationship'][value='0']").prop("checked",true);
        $("input[name='relationship'][value='1']").prop("checked",true);
        $("#btn_yes_T").show();
        var object = new Object();
        //开始日期
        var relationshipTime = $("#relationshipTime").val();
        //手机号
        var MultiplePhone = $("#MultiplePhone").val();
        var str = $.trim(MultiplePhone).replace(/,/g,''), result = "";
        for(var i = 0,len=str.length;i<len;i++){
            result += str[i]
            if( (i+1) % 11 == 0 ) {
                result += ',';
            }
            $("#MultiplePhone").val(result)
        };
        var spo = new Array() ;
        var spo = result.substring(0,result.length-1).split(',');
        if( relationshipTime == "" ){
            layer.msg('请输入开始日期！',{time:600});
            return false
        }
        if( MultiplePhone == "" ){
            layer.msg('请输入电话号码！',{time:600});
            return false
        }
        for(var y = 0 ;y <spo.length;y++){
            var myreg = /^(((13[0-9]{1})|(14[0-9]{1})|(17[0]{1})|(15[0-3]{1})|(15[5-9]{1})|(18[0-9]{1}))+\d{8})$/;
            if (!myreg.test(spo[y])) {
                layer.msg('电话号码格式不正确！',{time:600});
                return false;
            }
        }
        object["phoneNumbers"] = result.substring(0,result.length-1);
        object["start_time"] = relationshipTime;
        object["type"] = "1";
        $("#relationshipTime2").val( relationshipTime );
        commonPeople(relationshipTime,result.substring(0,result.length-1))
        $.ajax({
            url:getRootPath_web()+"/ticket/mutualContactsAnalyze",
            //url:"../data/seike.json",
            type:"post",
            dataType:"json",
            data:object,
            success: function (data) {
                //$.cookie('commonPeople2',JSON.stringify(data));
                //$("#iframe").attr("src","newHtml.html");
                var add_data = data.data;
                for(var i = 0 ;i<add_data.length;i++){
                    if( add_data[i].calledFrequency > 0 ){
                        if( add_data[i].callingFrequency > 0 ){
                            push_add.push( JSON.parse( "{\"opositeNumber\":\"" + add_data[i].inputNumber +"\",\"calledFrequency\":\""+ add_data[i].calledFrequency+"\",\"inputNumber\":\""+ add_data[i].opositeNumber +"\",\"domain\":\""+add_data[i].domain+"\",\"allFrequency\":\""+add_data[i].allFrequency+"\",\"areacode\":\""+ add_data[i].areacode +"\",\"location\":\""+add_data[i].location+"\",\"callingFrequency\":\""+add_data[i].callingFrequency+"\",\"casetag\":\""+add_data[i].casetag+"\",\"phoneNumber\":2}"))
                        }
                    }else if( add_data[i].callingFrequency > 0 ){
                        if( add_data[i].calledFrequency > 0 ){
                            push_add.push(JSON.parse( "{\"opositeNumber\":\"" + add_data[i].opositeNumber +"\",\"calledFrequency\":\""+ add_data[i].calledFrequency+"\",\"inputNumber\":\""+ add_data[i].inputNumber +"\",\"domain\":\""+add_data[i].domain+"\",\"allFrequency\":\""+add_data[i].allFrequency+"\",\"areacode\":\""+ add_data[i].areacode +"\",\"location\":\""+add_data[i].location+"\",\"callingFrequency\":\""+add_data[i].callingFrequency+"\",\"casetag\":\""+add_data[i].casetag+"\",\"phoneNumber\":2}"))
                        }
                    }
                }
                var nue_data = push_add.concat(add_data);
                console.log(push_add);
                sessionStorage.setItem("commonPeople2", JSON.stringify(nue_data));
                sessionStorage.setItem("phoneNumbers", result.substring(0, result.length - 1));
                sessionStorage.setItem("start_time", relationshipTime);
                sessionStorage.setItem("add", 2);
                //$("#commonPeople2").attr("data",data);
                var root = nue_data;
                relationData = nue_data;
                // refreshOne( root );
                //默认不勾选的条件
                var condition = "2,3,4,5";
                //根据勾选刷新页面
                refreshDataByCondition(relationData,"relationship",condition);
            }
        })
    }
    function refreshOne( root ) {
        var MultiplePhone = $("#MultiplePhone").val();
        var spo = MultiplePhone.substring(0,MultiplePhone.length-1).split(',');
        console.log( spo );
        var addPushO;
        $(".wt210 svg").remove();
        var width = document.documentElement.scrollWidth - 40 || document.body.scrollWidth - 40;
        var height = document.documentElement.scrollHeight - 110 || document.body.scrollHeight - 110;
        var nodes = {};
        root.forEach(function(link) {//参考https://stackoverflow.com/questions/23986466/d3-force-layout-linking-nodes-by-name-instead-of-index
            //利用source和target名称进行连线以及节点的确认
            link.source = nodes[link.opositeNumber] || (nodes[link.opositeNumber] = {name: link.opositeNumber});
            link.target = nodes[link.inputNumber] || (nodes[link.inputNumber] = {name: link.inputNumber});
        });
        var force = d3.layout.force()//layout将json格式转化为力学图可用的格式
            .nodes(d3.values(nodes))//设定节点数组
            .links(root)//设定连线数组
            .size([width, height])//大小
            .friction(0.1)//摩擦系数0-1
            .linkDistance(450)//连接线长度
            .charge(-1700)//值为+，则相互吸引，绝对值越大吸引力越大。值为-，则相互排斥，绝对值越大排斥力越大
            .on("tick", tick)//指时间间隔，隔一段时间刷新一次画面
            .start(0);//开始转换
        var zoom = d3.behavior.zoom() //缩放配置，
            .scaleExtent([0,2]) //缩放比例
            .on("zoom", zoomed);
        function zoomed() { //缩放函数
            svg.selectAll("g").attr("transform", //svg下的g标签移动大小
                "translate(" + d3.event.translate + ")scale(" + d3.event.scale + ")");
        }
        var svg = d3.select(".wt210").append("svg") //添加svg元素进行图形的绘制
            .attr("width", width)
            .attr("height", height)
            .call(zoom);
        //箭头
        // $.each(root,function (i,tol) {
        // if( tol.calledFrequency == 1 ){
        //
        // }
        // })
        var marker = //注意SVG规范中明确指出，附加到一个'Marker'元素上的“事件属性和事件的listener”不会被处理
            svg.append("marker") //添加一个marker标签来绘制箭头
                .attr("id", "resolved") //箭头id，用于其他标记进行引用时的url
                .attr("markerUnits", "userSpaceOnUse") //定义标记的坐标系统，userSpaceOnUse表示按照引用的元件来决定，strokeWidth按照用户单位决定
                .attr("viewBox", "0 -5 10 10") //坐标系的区域
                .attr("refX", 40) //箭头坐标X轴
                .attr("refY", 0)  //箭头坐标Y轴
                .attr("markerWidth", 12) //标识的大小
                .attr("markerHeight", 12)
                .attr("orient", "auto") //绘制方向，可设定为：auto（自动确认方向）和 角度值
                .attr("stroke-width", 3) //箭头宽度
                .append("path")
                .attr("d", "M0,-5L10,0L0,5") //绘制箭头，路径为一个三角形，有疑问参考svg的path http://www.runoob.com/svg/svg-path.html
                .attr('fill', '#000000'); //箭头颜色
        // var marker2 = //注意SVG规范中明确指出，附加到一个'Marker'元素上的“事件属性和事件的listener”不会被处理
        //     svg.append("marker") //添加一个marker标签来绘制箭头
        //         .attr("id", "resolved") //箭头id，用于其他标记进行引用时的url
        //         .attr("markerUnits", "userSpaceOnUse") //定义标记的坐标系统，userSpaceOnUse表示按照引用的元件来决定，strokeWidth按照用户单位决定
        //         .attr("viewBox", "0 -5 10 10") //坐标系的区域
        //         .attr("refX", 40) //箭头坐标X轴
        //         .attr("refY", 0)  //箭头坐标Y轴
        //         .attr("markerWidth", 12) //标识的大小
        //         .attr("markerHeight", 12)
        //         .attr("orient", "auto") //绘制方向，可设定为：auto（自动确认方向）和 角度值
        //         .attr("stroke-width", 3) //箭头宽度
        //         .append("path")
        //         .attr("d", "M0,-5L10,0L0,5") //绘制箭头，路径为一个三角形，有疑问参考svg的path http://www.runoob.com/svg/svg-path.html
        //         .attr('fill', '#000000'); //箭头颜色
        //设置连接线
        var edges_line = svg.append("g").selectAll(".edgepath")
            .data(root) //连线数据
            .enter() //当数组中的个数大于元素个数时，由d3创建空元素并与数组中超出的部分进行绑定。
            //可以参考http://www.ourd3js.com/wordpress/797/ enter、exit、update的区别
            .append("path") //添加path标签
            .attr({
                'd': function (d) {
                    return 'M ' + d.source.x + ' ' + d.source.y + ' L ' + d.target.x + ' ' + d.target.y
                }, //变量 d 是由D3.js提供的一个在匿名函数中的可用变量。这个变量是对当前要处理的元素的_data_属性的引用。
                'class': 'edgepathW', //定义该path标签class为edgepath
                'id': function (d, i) {
                    return 'edgepathW' + i;
                },
                'pid': function (d, i) {
                    return d.inputNumber;
                },
                'zid': function (d, i) {
                    return d.opositeNumber;
                },

            }) // i也是d3.js提供的变量，表示当前处理的HTML元素在已选元素选集中的索引值
            .style("stroke", "#4874C2") //设置线条颜色
            .style("stroke-width", 2) //线条粗细
            .attr("marker-end", "url(#resolved)"); //根据箭头标记的id号引用箭头
        //.attr("marker-end", "url(#resolved2)"); //根据箭头标记的id号引用箭头
        //连线上的文字
        $(".edgepathW").click(function () {
            var startTime = $("#relationshipTime2").val();
            var startTimeO = startTime.split('-');
            var startTimeW = parseInt(startTimeO[0])+1;
            var finishTime = startTimeW+"-"+ startTimeO[1] +"-"+startTimeO[2];
            list($(this).attr("zid"),$(this).attr("pid"),startTime,finishTime)
        })
        var edges_text = svg.append("g").selectAll(".edgelabel")
            .data(root)
            .enter()
            .append("text") //添加text标签
            .attr({
                'class': 'edgelabel', //定义该text标签class为edgelabel
                'id': function (d, i) {
                    return 'edgepathW' + i;
                },
                'dx': 60, //在连线上的坐标
                'dy': 0
            });
        //设置线条上的文字路径
        edges_text.append('textPath')
            .attr('xlink:href', function (d, i) {
                return '#edgepathW' + i
            })
            .style("pointer-events", "none")
            .text(function (d) {
                for( var i = 0 ;i< spo.length;i++){
                    if( spo[i] == d.inputNumber ){
                        return "被叫频次"+ d.callingFrequency;
                    }else{
                        return "主叫频次"+ d.calledFrequency;
                    }
                }
            });
        function drag() { //拖拽函数
            return force.drag()
                .on("dragstart", function (d) {
                    d3.event.sourceEvent.stopPropagation(); //取消默认事件
                    d.fixed = true; //拖拽开始后设定被拖拽对象为固定
                });
            //.on("drag", dragmove);
        }
        //圆圈的提示文字 根据需要到数据库中进行读取数据
        var tooltip = d3.select("body")
            .append("div") //添加div并设置成透明
            .attr("class", "tooltip")
            .style("opacity", 0.0);
        //圆圈
        var circle = svg.append("g").selectAll("image")
            .data(force.nodes())
            .enter()
            .append("image")
            .attr("xlink:href", function (d) {
//                        var spo = result.substring(0,result.length-1).split(',');
//                        for(var y = 0 ;y <spo.length;y++){
//                            if( d.name == spo[y] ){
//                                return "img/2.2_sex_lady.png";
//                            }else {
//                                return "img/2.1_sex_man.png";
//                            }
//                        }
                if( d.name.length == 11 ){
                    return "img/1.2_phone_mobile.png";
                }else{
                    return "img/1.1_phone_fixed.png";
                }
            })
            .attr("id", function (d) {
                return d.name;
            })
            .attr("class", "polw") //设置class
            .attr("width", "60px") //设置图片的宽
            .attr("height", "60px") //设置图片的高
            .on("click", function (node) {
                var addPush = [];
                //单击时让连接线加粗
                edges_line.style("stroke-width", function (line) {
                    if (line.source.name == node.name || line.target.name == node.name) { //当与连接点连接时变粗
                        addPush.push( line.inputNumber );
                        ayyreaddPush = addPush;
                        addPushO = line.opositeNumber
                        return 4;
                    } else {
                        return 2;
                    }
                });
                $(".information").show();
                var startTime = $("#relationshipTime2").val();
                var startTimeO = startTime.split('-');
                var startTimeW = parseInt(startTimeO[0])+1;
                var finishTime = startTimeW+"-"+ startTimeO[1] +"-"+startTimeO[2];
                circle.style('stroke-width', 2); //所有的圆圈边框
                d3.select(this).style('stroke-width', 4); //被选中的圆圈边框
                $(".information").click(function () {
                    $.ajax({
                        type: 'POST',
                        url:projectPath+"elastic/contrast",//发送请求
                        data : {
                            phoneA:addPushO,
                            phoneB:ayyreaddPush.join(','),
                            startTime:startTime,
                            finishTime:finishTime
                        },
                        dataType : "json",
                        success: function(data) {
                            var statistics = data;
                            var thead_html = new Array();
                            thead_html.push("<tr>");
                            var key = [];
                            var i = 0;
                            for (var prop in statistics){
                                thead_html.push("<th style='width: 15%;'>"+ prop +"</th>>");
                                key[i]=prop;
                                ++i;
                            }
                            thead_html.push("</tr>");
                            $("#thead_div").html(thead_html.join(''));
                            var tbody_html=new Array();
                            for(var i=0;i<statistics[key[0]].length;i++){
                                if(i==500){
                                    break;
                                }
                                tbody_html.push('<tr>');
                                for(var j=0;j<key.length;j++){
                                    //                        if(j==50){
                                    //                            break;
                                    //						}
                                    if(statistics[key[j]].length<=i){
                                        tbody_html.push('<td></td>');
                                    }else{
                                        tbody_html.push('<td>'+statistics[key[j]][i]["START_TIME"]+'<br>'+statistics[key[j]][i]["CALLING_TYPE"]+'-'+statistics[key[j]][i]["CALLING_TIME"]+'秒'+'-'+statistics[key[j]][i]["CALLING_PLACE"]+'</td>');
                                    }
                                }
                                tbody_html.push('</tr>');
                            }
                            $("#tbody_div").html(tbody_html.join(''));
                            layer.open({
                                offset : 20,
                                type : 1,
                                title : '对照详单',
                                fix : false,
                                maxmin : true,
                                shade : false,
                                shadeClose : false,
                                area: ["90%", "90%"],
                                content : $("#contrast_div"),
                                end : function() {
                                    layer.closeAll();
                                }
                            });
                        }
                    });
                })
            })
            .call(drag()); //使顶点可以被拖动
        svg.selectAll("g").call(drag()); //为svg下的所有g标签添加拖拽事件
        svg.on("dblclick.zoom", null); //取消svg和圆圈的双击放大事件（d3中默认开启7个事件，关闭防止与上面的双击事件冲突）
        circle.on("dblclick.zoom", null);
        var text = svg.append("g").selectAll("text")
            .data(force.nodes())
            //返回缺失元素的占位对象（placeholder），指向绑定的数据中比选定元素集多出的一部分元素。
            .enter()
            .append("text") //添加text标签

            .attr("text-anchor", "middle") //在圆圈中加上数据
            .style('fill', function (node) {
                var color = "#4874C2"; //文字颜色
                return color;
            })
            .attr('x', function (d) {
                // console.log(d.name+"---"+ d.name.length);
                var re_en = /[a-zA-Z]+/g;
                //如果是全英文，不换行
                if (d.name.match(re_en)) {
                    d3.select(this).append('tspan') //添加tspan用来方便时使用绝对或相对坐标来调整文本
                        .attr('x', 0)
                        .attr('y', 2)
                        .attr("dy", "5.5em") //将文字下移
                        .attr('class', "odd")
                        .text(function () {
                            return d.name;
                        });
                }
                //如果小于8个字符，不换行
                else if (d.name.length <= 15) {
                    d3.select(this).append('tspan')
                        .attr('x', 0)
                        .attr('y', 2)
                        .attr("dy", "5.5em") //将文字下移
                        .attr('class', "odd")
                        .text(function () {
                            return d.name;
                        });
                }
                d3.select(this).append('tspan')
                    .attr('x', 0)
                    .attr('y', 2)
                    .attr("dy", "7em") //将文字下移
                    .text(function () {
                        return d.namea;
                    });
            });
        // $(".polw").each(function () {
        //     var texiw = $(this);
        //     var spo =
        //     $.each(spo,function(i,item){
        //         if( texiw.attr("id") == item ){
        //             texiw.attr("href","img/2.2_sex_lady.png")
        //         }
        //     });
        // });
        function tick() { //刷新页面函数
            circle.attr("transform", transform1); //圆圈
            text.attr("transform", transform2); //顶点文字
            edges_line.attr('d', function (d) { //连接线
                var path = 'M ' + d.source.x + ' ' + d.source.y + ' L ' + d.target.x + ' ' + d.target.y;
                return path;
            });
            edges_text.attr('transform', function (d, i) { //连线上的文字
                if (d.target.x < d.source.x) { //判断起点和终点的位置，来让文字一直显示在线的上方且一直是正对用户
                    bbox = this.getBBox(); //获取矩形空间,并且调整翻转中心。（因为svg与css中的翻转不同，具体区别可看http://www.zhangxinxu.com/wordpress/2015/10/understand-svg-transform/）
                    rx = bbox.x + bbox.width / 2;
                    ry = bbox.y + bbox.height / 2;
                    return 'rotate(180 ' + rx + ' ' + ry + ')';
                } else {
                    return 'rotate(0)';
                }
            })
                .attr('dx', function (d, i) {
                    return Math.sqrt(Math.pow(d.target.x - d.source.x, 2) + Math.pow(d.target.y - d.source.y, 2)) / 2 - 20;
                    //设置文字一直显示在线的中间
                });
        }
        //设置图片的坐标
        function transform1(d) {
            return "translate(" + (d.x - 20) + "," + (d.y - 30) + ")";
        }
        //设置文字的坐标
        function transform2(d) {
            return "translate(" + (d.x + 10) + "," + (d.y - 15) + ")";
        }
        //循环备注
        $(".odd").each(function () {
            var texi = $(this);
            $.each(root,function(i,item){
                if(  texi.text() ==  item.inputNumber ){
                    if( item.casetag == null || item.casetag == "" || item.casetag == undefined ){
                        texi.next().text( "备注：暂无备注" );
                    }else{
                        texi.next().text( "备注："+ item.casetag );
                    }
                }else if( texi.text() ==  item.opositeNumber ){
                    if( item.casetag == null || item.casetag == "" || item.casetag == undefined ){
                        texi.next().text( "备注：暂无备注" );
                    }else{
                        texi.next().text( "备注："+ item.casetag );
                    }
                }
            });
        })
        //删除和备注某一条信息
        $(".polw").click(function () {
            event.stopPropagation();
            $("#details").hide();
            var d = $(this);
            var pos = d.offset();
            var t = pos.top + d.height(); // 弹出框的上边位置
            var l = pos.left + d.width();  // 弹出框的左边位置
            $("#details").css({ "top": t, "left": l });
            $("#details").show();
            var thsid = $(this).attr("id");
            var thsida = $(this).attr("ida");
            var initLiveTable1  = sessionStorage.getItem("commonPeople2");
            var data = $.parseJSON(initLiveTable1);
            var ayyre = [];
            var ayyre1 = [];
            var result = $("#MultiplePhone").val();
            var spo = new Array() ;
            var spo = result.substring(0,result.length-1).split(',');
            $.each(spo,function (i,root) {
                if( root == thsid ){
                    $("#details").hide();
                }
            })
            //删除当前的节点和元素
            $(".remove_hiw").unbind('click').click(function (event) {
                event.stopPropagation();
                $("#details").hide();
                if( $("#MultiplePhone").val() == thsid ){
                    layer.confirm('当前人员为搜索人员，如果删除则数据为空！', {
                        btn: ['确定','取消'] //按钮
                    }, function(){
                        sessionStorage.setItem("commonPeople2",JSON.stringify(""));
                        layer.closeAll();
                        refreshOne("");
                    }, function(){
                        layer.closeAll();
                    });
                    $(this).parent().hide();
                }else{
                    layer.confirm('是否要删除当前的人员？', {
                        btn: ['确定','取消'] //按钮
                    }, function(){
                        $.each(data,function (i,root) {
                            if( thsid ==  root.inputNumber ||  thsid ==  root.opositeNumber ) {
                                //thsid.remove()
                            }else{
                                ayyre.push( root );
                            }
                        });
                        sessionStorage.setItem("commonPeople2",JSON.stringify(ayyre));
                        refreshOne(ayyre);
                        layer.closeAll();
                    }, function(){
                        layer.closeAll();
                    });
                    $(this).parent().hide();
                }
            });
            console.log( ayyre );
            //给当前节点添加备注
            $(".ToView").unbind('click').click(function (event) {
                event.stopPropagation();
                $("#textarea_id").val("");
                $("#details").hide();
                layer.open({
                    title : "备注信息",
                    content:"<textarea id='textarea_id'></textarea>",
                    btn : [ '确定', '取消' ],
                    yes:function(){
                        $.each(data,function (i,root) {
                            if( thsid ==  root.inputNumber  ) {
                                root.casetag = $("#textarea_id").val();
                                ayyre1.push( root );
                            }else if( thsid ==  root.opositeNumber ){
                                root.casetag = $("#textarea_id").val();
                                ayyre1.push( root );
                            }else{
                                ayyre1.push( root );
                            }
                        });
                        sessionStorage.setItem("DedicatedPeople2",JSON.stringify(ayyre1));
                        refreshOne(ayyre1);
                        layer.closeAll();
                    },btn2:function (index,layero) {
                        layer.close(index);
                    }
                })
            })
        })
    }
    //点击保存分析结果
    $("#btn_yes_T").unbind('click').click(function () {
        var object = new Object();
        //开始时间
        var startTime = $("#relationshipTime").val();
        //手机号码
        var phoneNumber = $("#MultiplePhone").val();
        object["startTime"] = startTime;
        object["phoneNumber"] = phoneNumber;
        console.log( ayyre1 );
        $.ajax({
            type: 'POST',
            url: getRootPath_web()+"/elastic/saveAnalyse",//发送请求
            dataType : "json",
            data:{
                id:"",
                userId:"",
                createUser:"",
                analyseType:"2",
                content:"str"+JSON.stringify(ayyre1),
                title:phoneNumber,
                term:"str"+JSON.stringify(object)
            },
            success:function (data) {
                if( data.code == "200" ){
                    layer.msg(data.msg, {icon: 1});
                }else{
                    layer.msg(data.msg, {icon: 2});
                }
            }
        });
        commonPeopleT("2");
    });
</script>
<!--同住人分析-->
<script type="text/javascript">
    //自定义时输入框显示控制
    $("#liveTime").change(function(){
        console.log($(this).val());
        var interval = $(this).val();
        if(interval == "custom"){
            $("#cardDiv").css({width:"23%"});
            $("#timeDiv").css({width:"23%"});
            $("#inputDiv").removeClass("hide");
        }else {
            $("#inputDiv").addClass("hide");
            $("#cardDiv").css({width:"34%"});
            $("#timeDiv").css({width:"34%"});
            getNowFormatDate();
        }
    });
    $("#showStype_W input").click(function () {
        $("#wt300 > div").eq($(this).index()).show().siblings().hide();
    });
    var ayyre1;
    console.log( ayyre1 );
    getNowFormatDate();
    function getNowFormatDate() {
        var date = new Date();
        var seperator1 = "-";
        var seperator2 = ":";
        var month = date.getMonth() + 1;
        var strDate = date.getDate();
        if (month >= 1 && month <= 9) {
            month = "0" + month;
        }
        if (strDate >= 0 && strDate <= 9) {
            strDate = "0" + strDate;
        }
        var currentdate = date.getFullYear() + seperator1 + month + seperator1 + strDate;
        $("#occupancy").val(currentdate);
        $("#occupancy2").val(currentdate);
        return currentdate;
    }
    // function analysisHotel() {
    //     $.ajax({
    //         type: 'POST',
    //         url: getRootPath_web()+"/elastic/analyseHotelPerson",//发送请求
    //         dataType : "json",
    //         data:{
    //             liveTime:$("#liveTime").val(),
    //             idNumHotel:$("#idNumHotel").val(),
    //         },
    //         success: function(data) {
    //             console.log(data);
    //         }
    //     });
    // }
    function showStype_W(){
        $("#reg").val("");
        $("#ale input").attr("disabled",false);
        $("#ale input").prop("checked","true");
        $("#ale input[value='6']").removeAttr("checked");
        $("#ale input[value='7']"). removeAttr("checked");
        $("#btn_yes_S").show();
        var object = new Object();
        var liveTime = $("#liveTime option:checked").val();
        if( liveTime == ''){
            $("#occupancy2").val("1970-01-01");
        }else if(liveTime == "custom"){
            //自定义时间段
            $("#occupancy2").val($('#sTime').val());
            $("#occupancy").val($('#eTime').val());
        }else{
            removeDate($("#occupancy").val(),liveTime)
            function removeDate(date,days){
                var d = new Date(date);
                d.setDate(d.getDate()-days);
                var m=d.getMonth()+1;
                if (m >= 0 && m <= 9) {
                    m = "0" + m;
                }
                var getDate = d.getDate();
                if ( getDate >= 0 && getDate <= 9) {
                    getDate = "0" + getDate;
                }
                $("#occupancy2").val(d.getFullYear()+'-'+m+'-'+getDate );
                return d.getFullYear()+'-'+m+'-'+d.getDate();
            }
        }
        //结束日期
        var liveTime = $("#occupancy").val();
        //开始日期
        var occupancy = $("#occupancy2").val();
        console.log( liveTime,occupancy);
        //身份证号
        var idNumHotel = $("#idNumHotel").val();
        // if( liveTime == "" ){
        //     layer.msg('请输入入住日期！',{time:600});
        //     return false
        // }
        // if( idNumHotel == "" ){
        //     layer.msg('请输入身份证号！',{time:600});
        //     return false
        // }
        checkCardId(idNumHotel);
        function checkCardId(socialNo){

            if(socialNo == "")
            {
                layer.msg('请输入身份证号！',{time:600});
                return false;
            }
            if (socialNo.length != 15 && socialNo.length != 18)
            {
                layer.msg('输入身份证号码格式不正确！',{time:600});
                return false;
            }
            var area={11:"北京",12:"天津",13:"河北",14:"山西",15:"内蒙古",21:"辽宁",22:"吉林",23:"黑龙江",31:"上海",32:"江苏",33:"浙江",34:"安徽",35:"福建",36:"江西",37:"山东",41:"河南",42:"湖北",43:"湖南",44:"广东",45:"广西",46:"海南",50:"重庆",51:"四川",52:"贵州",53:"云南",54:"西藏",61:"陕西",62:"甘肃",63:"青海",64:"宁夏",65:"新疆",71:"台湾",81:"香港",82:"澳门",91:"国外"};
            if(area[parseInt(socialNo.substr(0,2))]==null) {
                layer.msg('身份证号码不正确(地区非法)！',{time:600});
                return false;
            }
            if (socialNo.length == 15)
            {
                pattern= /^\d{15}$/;
                if (pattern.exec(socialNo)==null){
                    layer.msg('15位身份证号码必须为数字!',{time:600});
                    return false;
                }
                var birth = parseInt("19" + socialNo.substr(6,2));
                var month = socialNo.substr(8,2);
                var day = parseInt(socialNo.substr(10,2));
                switch(month) {
                    case '01':
                    case '03':
                    case '05':
                    case '07':
                    case '08':
                    case '10':
                    case '12':
                        if(day>31) {
                            layer.msg('输入身份证号码不格式正确!',{time:600});
                            return false;
                        }
                        break;
                    case '04':
                    case '06':
                    case '09':
                    case '11':
                        if(day>30) {
                            layer.msg('输入身份证号码不格式正确!',{time:600});
                            return false;
                        }
                        break;
                    case '02':
                        if((birth % 4 == 0 && birth % 100 != 0) || birth % 400 == 0) {
                            if(day>29) {
                                layer.msg('输入身份证号码不格式正确!',{time:600});
                                return false;
                            }
                        } else {
                            if(day>28) {
                                layer.msg('输入身份证号码不格式正确!',{time:600});
                                return false;
                            }
                        }
                        break;
                    default:
                        layer.msg('输入身份证号码不格式正确!',{time:600});
                        return false;
                }
                var nowYear = new Date().getYear();
                if(nowYear - parseInt(birth)<15 || nowYear - parseInt(birth)>100) {
                    layer.msg('输入身份证号码不格式正确!',{time:600});
                    return false;
                }
                return true;
            }
            var Wi = new Array(
                7,9,10,5,8,4,2,1,6,
                3,7,9,10,5,8,4,2,1
            );
            var   lSum        = 0;
            var   nNum        = 0;
            var   nCheckSum   = 0;
            for (i = 0; i < 17; ++i)
            {


                if ( socialNo.charAt(i) < '0' || socialNo.charAt(i) > '9' )
                {
                    layer.msg('输入身份证号码不格式正确!',{time:600});
                    return false;
                }
                else
                {
                    nNum = socialNo.charAt(i) - '0';
                }
                lSum += nNum * Wi[i];
            }
            if( socialNo.charAt(17) == 'X' || socialNo.charAt(17) == 'x')
            {
                lSum += 10*Wi[17];
            }
            else if ( socialNo.charAt(17) < '0' || socialNo.charAt(17) > '9' )
            {
                layer.msg('输入身份证号码不格式正确!',{time:600});
                return false;
            }
            else
            {
                lSum += ( socialNo.charAt(17) - '0' ) * Wi[17];
            }



            if ( (lSum % 11) == 1 )
            {
                return true;
            }
            else
            {
                layer.msg('输入身份证号码不格式正确!',{time:600});
                return false;
            }

        }
        idCard = idNumHotel;
        initLiveTable(occupancy,liveTime,idNumHotel);
        $.ajax({
            url:getRootPath_web()+"/elastic/analyseHotelPerson",
            //url:"relation.json",
            type:"post",
            dataType:"json",
            data:{
                startTime:occupancy,
                endTime:liveTime,
                idNumHotel:idNumHotel,
                resultType:"2",
            },
            success: function (data) {
                //$.cookie('initLiveTable2',JSON.stringify(data));
                //$("#iframe").attr("src","newHtml.html");
                //localStorage.setItem("initLiveTable2",data.data);
                sessionStorage.setItem("initLiveTable2",JSON.stringify(data.data));
                sessionStorage.setItem("liveTime",liveTime);
                sessionStorage.setItem("idNumHotel",idNumHotel);
                sessionStorage.setItem("add",3);
                // $("#initLiveTable2").attr("data",data);
                var root = data.data;
                iDdata = root;
                // dataType(root);
                //默认除同案警以外 全选
                var condition = "67";
                //根据勾选刷新页面
                refreshByCondition(condition);
            }
        });
        var initLiveTable1  = sessionStorage.getItem("initLiveTable2");
    }
    function dataType(root) {
        $(".wt310 svg").remove();
        var width = document.documentElement.scrollWidth - 40 || document.body.scrollWidth - 40;
        var height = document.documentElement.scrollHeight - 110 || document.body.scrollHeight - 110;
        var nodes = {};
        root.forEach(function(link) {//参考https://stackoverflow.com/questions/23986466/d3-force-layout-linking-nodes-by-name-instead-of-index
            //利用source和target名称进行连线以及节点的确认
            link.source = nodes[link.hotelinfo.nohotel] || (nodes[link.hotelinfo.nohotel] = {name: link.hotelinfo.nohotel});
            link.target = nodes[link.personinfo.idcode] || (nodes[link.personinfo.idcode] = {name: link.personinfo.idcode});
        });
        var force = d3.layout.force()//layout将json格式转化为力学图可用的格式
            .nodes(d3.values(nodes))//设定节点数组
            .links(root)//设定连线数组
            .friction(0.1)//摩擦系数0-1
            //.linkStrength(0)//* linkStrength() ： 數值從0~1，控制綫的牽引力，如果說設定為1的時候，拉動某一個點，其它點也會跟著移動如果是設定為0的時候，拉動一個點，其它點會保持不動，綫會拉長。
            .size([width, height])//大小
            .linkDistance(450)//连接线长度
            .charge(-1700)//值为+，则相互吸引，绝对值越大吸引力越大。值为-，则相互排斥，绝对值越大排斥力越大
            .on("tick", tick)//指时间间隔，隔一段时间刷新一次画面
            .start(0);//开始转换
        var zoom = d3.behavior.zoom() //缩放配置，
            .scaleExtent([0,2]) //缩放比例
            .on("zoom", zoomed);
        function zoomed() { //缩放函数
            svg.selectAll("g").attr("transform", //svg下的g标签移动大小
                "translate(" + d3.event.translate + ")scale(" + d3.event.scale + ")");
        }
        var svg = d3.select(".wt310").append("svg") //添加svg元素进行图形的绘制
            .attr("width", width)
            .attr("height", height)
            .call(zoom);
        //箭头
        // var marker = //注意SVG规范中明确指出，附加到一个'Marker'元素上的“事件属性和事件的listener”不会被处理
        //     svg.append("marker") //添加一个marker标签来绘制箭头
        //         .attr("id", "resolved") //箭头id，用于其他标记进行引用时的url
        //         .attr("markerUnits", "userSpaceOnUse") //定义标记的坐标系统，userSpaceOnUse表示按照引用的元件来决定，strokeWidth按照用户单位决定
        //         .attr("viewBox", "0 -5 10 10") //坐标系的区域
        //         .attr("refX", 40) //箭头坐标X轴
        //         .attr("refY", 0)  //箭头坐标Y轴
        //         .attr("markerWidth", 12) //标识的大小
        //         .attr("markerHeight", 12)
        //         .attr("orient", "auto") //绘制方向，可设定为：auto（自动确认方向）和 角度值
        //         .attr("stroke-width", 3) //箭头宽度
        //         .append("path")
        //         .attr("d", "M0,-5L10,0L0,5") //绘制箭头，路径为一个三角形，有疑问参考svg的path http://www.runoob.com/svg/svg-path.html
        //         .attr('fill', '#000000'); //箭头颜色
        //设置连接线
        var edges_line = svg.append("g").selectAll(".edgepath")
            .data(root) //连线数据
            .enter() //当数组中的个数大于元素个数时，由d3创建空元素并与数组中超出的部分进行绑定。
            //可以参考http://www.ourd3js.com/wordpress/797/ enter、exit、update的区别
            .append("path") //添加path标签
            .attr({
                'd': function (d) {
                    return 'M ' + d.source.x + ' ' + d.source.y + ' L ' + d.target.x + ' ' + d.target.y
                }, //变量 d 是由D3.js提供的一个在匿名函数中的可用变量。这个变量是对当前要处理的元素的_data_属性的引用。
                'class': 'edgepathS', //定义该path标签class为edgepath
                'id': function (d, i) {
                    return 'edgepathS' + i;
                },
                'pid': function (d, i) {
                    return d.hotelinfo.nohotel;
                },
                'zid': function (d, i) {
                    return d.personinfo.idcode;
                },
            }) // i也是d3.js提供的变量，表示当前处理的HTML元素在已选元素选集中的索引值
            .style("stroke", "#4874C2") //设置线条颜色
            .style("stroke-width", 2) //线条粗细
            .attr("marker-end", "url(#resolved)"); //根据箭头标记的id号引用箭头
        //连线上的文字
        var edges_text = svg.append("g").selectAll(".edgelabel")
            .data(root)
            .enter()
            .append("text") //添加text标签
            .attr({
                'class': 'edgelabel', //定义该text标签class为edgelabel
                'id': function (d, i) {
                    return 'edgepathS' + i;
                },
                'dx': 60, //在连线上的坐标
                'dy': 0
            });
        //设置线条上的文字路径
        edges_text.append('textPath')
            .attr('xlink:href', function (d, i) {
                return '#edgepathS' + i
            })
            .style("pointer-events", "none")
            .text(function (d) {
                return  d.tag;
            });
        function drag() { //拖拽函数
            return force.drag()
                .on("dragstart", function (d) {
                    d3.event.sourceEvent.stopPropagation(); //取消默认事件
                    d.fixed = true; //拖拽开始后设定被拖拽对象为固定
                });
            //.on("drag", dragmove);
        }
        //圆圈的提示文字 根据需要到数据库中进行读取数据
        var tooltip = d3.select("body")
            .append("div") //添加div并设置成透明
            .attr("class", "tooltip")
            .style("opacity", 0.0);
        //圆圈
        var pli;
        var circle = svg.append("g").selectAll("image")
            .data(force.nodes())
            .enter()
            .append("image")
            .attr("xlink:href", function (d) {
                d3.select(this).append('image')
                var newArr = [];
                for(var i = 0;i <= root.length;i++){
                    if( root[i].etime == d.name ){
                        return "img/hotel.png";
                    }else {
                        return "img/2.1_sex_man.png";
                    }
                }
            })
            .attr("id", function (d) {
                return d.name;
            })
            .attr("width", "60px") //设置图片的宽
            .attr("height", "60px") //设置图片的高
            .style("fill", "#4874C2") //设置线条颜色
            .style("background", "#4874C2") //设置线条颜色
            .style("background", "#4874C2") //设置线条颜色
            .style("stroke", "#4874C2") //设置线条颜色
            .attr("class","img_O")//设置一个class
            .on("click", function (node) {
                //单击时让连接线加粗
                edges_line.style("stroke-width", function (line) {
                    if (line.source.name == node.name || line.target.name == node.name) { //当与连接点连接时变粗
                        return 4;
                    } else {
                        return 2;
                    }
                });
                circle.style('stroke-width', 2); //所有的圆圈边框
                d3.select(this).style('stroke-width', 4); //被选中的圆圈边框
            })
            .call(drag()); //使顶点可以被拖动
        svg.selectAll("g").call(drag()); //为svg下的所有g标签添加拖拽事件
        svg.on("dblclick.zoom", null); //取消svg和圆圈的双击放大事件（d3中默认开启7个事件，关闭防止与上面的双击事件冲突）
        circle.on("dblclick.zoom", null);
        var text = svg.append("g").selectAll("text")
            .data(force.nodes())
            //返回缺失元素的占位对象（placeholder），指向绑定的数据中比选定元素集多出的一部分元素。
            .enter()
            .append("text") //添加text标签
            .attr("text-anchor", "middle") //在圆圈中加上数据
            .style('fill', function (node) {
                var color = "#4874C2"; //文字颜色
                return color;
            })
            .data(force.nodes())
            .attr('x', function (d) {
                // console.log(d.name+"---"+ d.name.length);
                //如果小于8个字符，不换行
                d3.select(this).append('tspan')
                    .attr('x', 0)
                    .attr('y', 2)
                    .attr("dy", "5.5em") //将文字下移
                    .text(function () {
                        return d.namea;
                    });
                d3.select(this).append('tspan')
                    .attr('x', 0)
                    .attr('y', 2)
                    .attr("dy", "7em") //将文字下移
                    .text(function () {
                        return d.namea;
                    });

                d3.select(this).append('tspan')
                    .attr('x', 0)
                    .attr('y', 2)
                    .attr("dy", "8.5em") //将文字下移
                    .attr("class","tian")
                    .text(function () {
                        return d.namea;
                    });

                d3.select(this).append('tspan')
                    .attr('x', 0)
                    .attr('y', 2)
                    .attr("dy", "10em") //将文字下移
                    .text(function () {
                        return d.namea;
                    });
                d3.select(this).append('tspan')
                    .attr('x', 0)
                    .attr('y', 2)
                    .attr("dy", "11.5em") //将文字下移
                    .attr("class","tspan")
                    .text(function () {
                        return d.namea;
                    });
                d3.select(this).append('tspan')
                    .attr('x', 0)
                    .attr('y', 2)
                    .attr("dy", "13em") //将文字下移
                    .attr("class","tspan")
                    .text(function () {
                        return d.name;
                    });
            });

        $(".tspan").each(function () {
            var texi = $(this);
            $.each(root,function(i,item){
                if( texi.text() == item.personinfo.idcode ){
                    texi.prev().text( "备注："+item.casetag );
                    texi.prev().prev().text( item.personinfo.name );
                    texi.prev().prev().prev().text( "入住天数："+item.days );
                    texi.prev().prev().prev().attr("title","开始时间："+ item.ltime +" 结束时间："+item.etime)
                    texi.prev().prev().prev().prev().text( "户籍："+item.personinfo.address );
                    if ( item.personinfo.sex  == 1){
                        // texi.parent().each(function () {
                        //     var yiw = $(this);
                        //     $(".img_O").each(function () {
                        //         var thiw = $(this);
                        // 	if( thiw.index() == yiw.index() ){
                        //             thiw.attr("src","img/2.1_sex_man.png")
                        // 	}
                        //     })
                        // })
                        texi.prev().prev().prev().prev().prev().text( "男" );
                    }else if( item.personinfo.sex  == 2 ){
                        texi.prev().prev().prev().prev().prev().text( "女" );
                    }else if( item.personinfo.sex  == 3 ){
                        texi.prev().prev().prev().prev().prev().text( "其他" );
                    }
                }else if( texi.text() == item.hotelinfo.nohotel ){
                    texi.prev().prev().prev().text( item.hotelinfo.haddress );
                    texi.prev().prev().prev().prev().text( "酒店星级："+item.hotelinfo.stars +"星" );
                    texi.prev().prev().prev().prev().prev().text( item.hotelinfo.hname  );
                    texi.prev().prev().remove();
                    texi.prev().remove();
                    texi.remove();
                }
            });
        });
        $(".img_O").each(function () {
            var texiw = $(this);
            $.each(root,function(i,item){
                if( texiw.attr("id") == item.personinfo.idcode ){
                    texiw.attr( "ida",item.hotelinfo.nohotel)
                    if( item.personinfo.sex == "1" ){
                        texiw.attr("href","img/2.1_sex_man.png")
                    }else if( item.personinfo.sex == "2" ){
                        texiw.attr("href","img/2.2_sex_lady.png")
                    }else if( item.personinfo.sex == "3" ){
                        texiw.attr("href","img/2.3_sex_other.png")
                    }else if( item.personinfo.sex == "10" ){
                        if( item.hotelinfo.stars == 1){
                            texiw.attr("href","img/3.1_hotel_star1.png");
                        }else if( item.hotelinfo.stars == 2 ){
                            texiw.attr("href","img/3.2_hotel_star2.png");
                        }else if( item.hotelinfo.stars == 3 ){
                            texiw.attr("href","img/3.3_hotel_star3.png");
                        }else if( item.hotelinfo.stars == 4 ){
                            texiw.attr("href","img/3.4_hotel_star4.png");
                        }else if( item.hotelinfo.stars == 5 ){
                            texiw.attr("href","img/3.5_hotel_star5.png");
                        }else if( item.hotelinfo.stars > 5 ){
                            texiw.attr("href","img/3.5_hotel_star5.png");
                        }else if( item.hotelinfo.stars > "" ){
                            texiw.attr("href","img/3.0_hotel_star0.png");
                        }
                        texiw.attr({
                            "height":"80px"
                        })
                    }
                }else if( texiw.attr("id") == item.hotelinfo.nohotel ){
                    if( item.hotelinfo.stars == 1){
                        texiw.attr("href","img/3.1_hotel_star1.png");
                    }else if( item.hotelinfo.stars == 2 ){
                        texiw.attr("href","img/3.2_hotel_star2.png");
                    }else if( item.hotelinfo.stars == 3 ){
                        texiw.attr("href","img/3.3_hotel_star3.png");
                    }else if( item.hotelinfo.stars == 4 ){
                        texiw.attr("href","img/3.4_hotel_star4.png");
                    }else if( item.hotelinfo.stars == 5 ){
                        texiw.attr("href","img/3.5_hotel_star5.png");
                    }else if( item.hotelinfo.stars > 5 ){
                        texiw.attr("href","img/3.5_hotel_star5.png");
                    }else if( item.hotelinfo.stars > "" ){
                        texiw.attr("href","img/3.0_hotel_star0.png");
                    }
                    texiw.attr({
                        "height":"80px"
                    })
                }
            });
            // if( texiw.attr("id") == $("#idNumHotel").val() ){
            //     texiw.attr("href","img/2.1_sex_man.png");
            // }
        });
        function tick() { //刷新页面函数
            circle.attr("transform", transform1); //圆圈
            text.attr("transform", transform2); //顶点文字
            edges_line.attr('d', function (d) { //连接线
                var path = 'M ' + d.source.x + ' ' + d.source.y + ' L ' + d.target.x + ' ' + d.target.y;
                return path;
            });
            edges_text.attr('transform', function (d, i) { //连线上的文字
                if (d.target.x < d.source.x) { //判断起点和终点的位置，来让文字一直显示在线的上方且一直是正对用户
                    bbox = this.getBBox(); //获取矩形空间,并且调整翻转中心。（因为svg与css中的翻转不同，具体区别可看http://www.zhangxinxu.com/wordpress/2015/10/understand-svg-transform/）
                    rx = bbox.x + bbox.width / 2;
                    ry = bbox.y + bbox.height / 2;
                    return 'rotate(180 ' + rx + ' ' + ry + ')';
                } else {
                    return 'rotate(0)';
                }
            })
                .attr('dx', function (d, i) {
                    return Math.sqrt(Math.pow(d.target.x - d.source.x, 2) + Math.pow(d.target.y - d.source.y, 2)) / 2 - 20;
                    //设置文字一直显示在线的中间
                });
        }
        //设置图片的坐标
        function transform1(d) {
            return "translate(" + (d.x - 20) + "," + (d.y - 30) + ")";
        }
        //设置文字的坐标
        function transform2(d) {
            return "translate(" + (d.x + 10) + "," + (d.y - 15) + ")";
        }
        $(".tian").hover(function () {
            if(  $(this).attr("title") != undefined ){
                layer.msg($(this).attr("title"),{time:0});
            }
        },function () {
            if(  $(this).attr("title") != undefined ){
                layer.msg($(this).attr("title"),{time:10});
            }
        });
        //删除和备注某一条信息
        $(".img_O").click(function () {
            event.stopPropagation();
            $(".information").hide();
            $("#details").hide();
            var d = $(this);
            var pos = d.offset();
            var t = pos.top + d.height(); // 弹出框的上边位置
            var l = pos.left + d.width();  // 弹出框的左边位置
            $("#details").css({ "top": t, "left": l });
            $("#details").show();
            var thsid = $(this).attr("id");
            var thsida = $(this).attr("ida");
            var initLiveTable1  = sessionStorage.getItem("initLiveTable2");
            var data = ayyre1;
            var ayyre = [];
            // var ayyre1 = [];
            //删除当前的节点和元素
            $(".remove_hiw").unbind('click').click(function (event) {
                event.stopPropagation();
                $("#details").hide();
                if( $("#idNumHotel").val() == thsid ){
                    layer.confirm('当前人员为搜索人员，如果删除则数据为空！', {
                        btn: ['确定','取消'] //按钮
                    }, function(){
                        sessionStorage.setItem("initLiveTable2",JSON.stringify(""));
                        layer.closeAll();
                        dataType("");
                    }, function(){
                        layer.closeAll();
                    });
                    $(this).parent().hide();
                }else{
                    layer.confirm('是否要删除当前的人员？', {
                        btn: ['确定','取消'] //按钮
                    }, function(){
                        $.each(data,function (i,root) {
                            if( thsid ==  root.personinfo.idcode &&  thsida ==  root.hotelinfo.nohotel ) {
                                //thsid.remove()
                            }else{
                                ayyre.push( root );
                            }
                        });
                        //sessionStorage.setItem("initLiveTable2",JSON.stringify(ayyre));
                        dataType(ayyre);
                        ayyre = ayyre1;
                        layer.closeAll();
                    }, function(){
                        layer.closeAll();
                    });
                    $(this).parent().hide();
                }
            })
            //给当前节点添加备注
            $(".ToView").unbind('click').click(function (event) {
                ayyre1 = [];
                event.stopPropagation();
                $("#textarea_id").val("");
                $("#details").hide();
                layer.open({
                    title : "备注信息",
                    content:"<textarea id='textarea_id'></textarea>",
                    btn : [ '确定', '取消' ],
                    yes:function(){
                        $.each(data,function (i,root) {
                            if( thsid ==  root.personinfo.idcode &&  thsida ==  root.hotelinfo.nohotel ) {
                                root.casetag = $("#textarea_id").val();
                                ayyre1.push( root );
                            }else{
                                ayyre1.push( root );
                            }
                        });
                        dataType(ayyre1);
                        layer.closeAll();
                    },btn2:function (index,layero) {
                        layer.close(index);
                    }
                })
            })
        })
    }
    function toImportTicket() {
        layer.open({
            title : "导入",
            content : "<form id='importTicket'  method='POST' enctype='multipart/form-data' ><input id='file' type='file' name='file'/></form>",
            skin : 'layui-layer-lana',
            shadeClose : 'true',
            btn : [ '确定', '取消' ],
            yes : function(index, layero) {
                var data = new FormData($("#importTicket")[0]);
                $.ajax({
                    type : "post",
                    url : projectPath+"/RPDHan/importTicket",
                    data : data,
                    dataType : "json",
                    async : false,
                    cache : false,
                    contentType : false,
                    processData : false,
                    success : function(data) {
                        console.log(data);
                        if (data.data.flag) {
                            layer.msg(data.data.msg, {
                                icon : 1,
                                time : 2000
                            });
                        } else {
                            layer.msg(data.data.msg, {
                                anim:6,
                                icon : 2,
                                time : 2000
                            });
                        }
                    },
                    error : function() {
                        layer.msg("系统错误，请联系管理员！", {
                            icon : 2,
                            time : 2000
                        });
                    }
                });
            }
        });
    }
    //获取筛选条件的未选中值 形成字符串
    $(function(){
        var condition = '';
        var s = $("input[name='live']");
        s.each(function(i) {
            $(this).click(function(){
                //开始之前清除之前的筛选条件
                condition = '';
                s.each(function () {
                    if(!$(this).prop('checked')){
                        condition += $(this).val();
                    }
                });
                //根据勾选刷新页面
                refreshByCondition(condition);
            });
        });
    });
    function refreshLive() {
        var sameReg = $("#reg").val();
        if (sameReg != "" && (sameReg.length == 2 || sameReg.length == 4 || sameReg.length == 6)){
            //符合条件进行筛选
            var condition = '';
            var s = $("input[name='live']");
            s.each(function(i) {
                //开始之前清除之前的筛选条件
                if(!$(this).prop('checked')){
                    condition += $(this).val();
                }
            });
            //根据勾选刷新页面
            refreshByCondition(condition);
        }else if(sameReg == ""){
            condition = "67";
            //根据勾选刷新页面
            refreshByCondition(condition);
        }
    }
    //根据筛选条件分析住宿信息
    function refreshByCondition(condition) {
        console.log("---condition--"+ condition);
        //获取分析之后的原始数据
        var initLiveTable1  = sessionStorage.getItem("initLiveTable2");
        var data = $.parseJSON(initLiveTable1);
        console.log("---data数组长度--"+ data.length);
        //建立分析数组
        var ayy1 = [],ayy2 = [],ayy3 = [],ayy4 = [],ayy5 = [],ayy6 = [],ayy7 = [],ayy8 = [],
            ayy9 = [],ayy10 = [],ayy11 = [];
        // //当前身份证
        // var idCard = $("#idNumHotel").val();
        //身份证前两位
        var sameProvince = idCard.substr(0,2);
        //身份证前四位
        var sameCity = idCard.substr(0,4);
        //制定输入的户籍数字
        var sameReg = $("#reg").val();
        console.log(sameProvince + "---sameCity--"+ sameCity + "--sameReg---" + sameReg+ "--idCard---" + idCard);

        //遍历之前看一下同省的选择情况
        if(condition.indexOf("a") != -1 && condition.indexOf("b") != -1){
            // alert(1);
            //如果同省非同省无选择  默认ayy2为全量原始数据
            ayy2 = data;
        }else {
            //同省或者非同省至少有一个选择了，可以进行数组的筛选
            //否则跳过看同乡情况

            //未选择同省 循环原始数据
            $.each(data,function (i,cur) {
                if( condition.indexOf("a") != -1){
                    //排除当前分析人
                    if((sameProvince == cur.personinfo.idcode.substr(0,2) && idCard != cur.personinfo.idcode)){
                        //判断为同省 不添加
                    }else {
                        ayy1.push(cur);
                    }
                }else{
                    //选择了同省
                    ayy1.push(cur);
                }
            });

            //未选择非同省 循环ayy1
            $.each(ayy1,function (i,cur) {
                if( condition.indexOf("b") != -1){
                    //排除当前分析人
                    if((sameProvince != cur.personinfo.idcode.substr(0,2) && idCard != cur.personinfo.idcode && "10" != cur.personinfo.sex)){
                        //判断为非同省 不添加
                    }else {
                        ayy2.push(cur);
                    }
                }else{
                    //选择了非同省
                    ayy2.push(cur);
                }
            });
        }

        if((condition.indexOf("a") == -1 || condition.indexOf("b") == -1) && (condition.indexOf("c") != -1 && condition.indexOf("d") != -1)){
            ayy4 = ayy2;
        }else {
            //未选择同乡 循环ayy2
            $.each(ayy2,function (i,cur) {
                if( condition.indexOf("c") != -1){
                    //排除当前分析人
                    if(sameCity == cur.personinfo.idcode.substr(0,4) && idCard != cur.personinfo.idcode){
                        //判断为同乡 不添加
                    }else {
                        ayy3.push(cur);
                    }
                }else{
                    //选择了同乡 不过滤
                    ayy3.push(cur);
                }
            });

            //未选择非同乡 循环ayy3
            $.each(ayy3,function (i,cur) {
                if( condition.indexOf("d") != -1){
                    //排除当前分析人
                    if(sameCity != cur.personinfo.idcode.substr(0,4) && idCard != cur.personinfo.idcode && "10" != cur.personinfo.sex){
                        //判断为非同乡 不添加
                    }else {
                        ayy4.push(cur);
                    }
                }else{
                    //选择了非同乡 不过滤
                    ayy4.push(cur);
                }
            });
        }

        //未选择港澳台 循环ayy4 预留 不做功能
        // $.each(ayy4,function (i,cur) {
        //     if( condition.indexOf("4") != -1){
        //         //排除当前分析人
        //         if(港澳台判断){
        //             //判断为港澳台 不添加
        //         }else {
        //             ayy5.push(cur);
        //         }
        //     }else{
        //         //选择了非同乡 不过滤
        //         ayy5.push(cur);
        //     }
        // });
        ayy5 = ayy4;
        //未选择外籍 循环ayy5 预留 不做功能
        // $.each(ayy5,function (i,cur) {
        //     if( condition.indexOf("5") != -1){
        //         //排除当前分析人
        //         if(外籍判断){
        //             //判断为外籍 不添加
        //         }else {
        //             ayy6.push(cur);
        //         }
        //     }else{
        //         //选择了非同乡 不过滤
        //         ayy6.push(cur);
        //     }
        // });
        ayy6 = ayy5;
        //判断指定户籍是否有内容并且长度为2、4、6 如果有过滤
        if(sameReg != "" && (sameReg.length == 2 || sameReg.length == 4 || sameReg.length == 6)){
            //循环ayy6
            $.each(ayy6,function (i,cur) {
                //排除当前分析人 符合指定户籍留下其余去除
                if(sameReg.length == 2){
                    if(sameReg == cur.personinfo.idcode.substr(0,2) || idCard == cur.personinfo.idcode || "10" == cur.personinfo.sex){
                        //符合条件 留下
                        ayy7.push(cur);
                    }
                }else if(sameReg.length == 4){
                    if(sameReg == cur.personinfo.idcode.substr(0,4) || idCard == cur.personinfo.idcode || "10" == cur.personinfo.sex){
                        //符合条件 留下
                        ayy7.push(cur);
                    }
                }else {
                    if(sameReg == cur.personinfo.idcode.substr(0,6) || idCard == cur.personinfo.idcode || "10" == cur.personinfo.sex){
                        //符合条件 留下
                        ayy7.push(cur);
                    }
                }
            });
        }else {
            ayy7 = ayy6;
        }

        //未选择男 循环ayy7
        $.each(ayy7,function (i,cur) {
            if( condition.indexOf("1") != -1){
                //排除当前分析人
                if(cur.personinfo.sex == "1" && idCard != cur.personinfo.idcode){
                    //判断为男 不添加
                }else {
                    ayy8.push(cur);
                }
            }else{
                //选择了男 不过滤
                ayy8.push(cur);
            }
        });

        //未选择女 循环ayy8
        $.each(ayy8,function (i,cur) {
            if( condition.indexOf("2") != -1){
                //排除当前分析人
                if(cur.personinfo.sex == "2" && idCard != cur.personinfo.idcode ){
                    //判断为女 不添加
                }else {
                    ayy9.push(cur);
                }
            }else{
                //选择了女 不过滤
                ayy9.push(cur);
            }
        });
        //未选择其他 循环ayy9
        $.each(ayy9,function (i,cur) {
            if( condition.indexOf("3") != -1){
                //排除当前分析人
                if(cur.personinfo.sex != "1" && cur.personinfo.sex != "2" && cur.personinfo.sex != "10" && idCard != cur.personinfo.idcode ){
                    //判断为其他 不添加
                }else {
                    ayy10.push(cur);
                }
            }else{
                //选择了其他 不过滤
                ayy10.push(cur);
            }
        });

        //仅选择了同涉案未选择同涉警
        if(condition.indexOf("6") == -1 && condition.indexOf("7") != -1 ){
            //循环ayy10
            $.each(ayy10,function (i,cur) {
                if(cur.casetag == "1" || cur.casetag == "3" || idCard == cur.personinfo.idcode || cur.personinfo.sex == "10"){
                    //判断为同涉案 添加
                    ayy11.push(cur);
                }
            });
        }else if(condition.indexOf("6") != -1 && condition.indexOf("7") == -1 ){
            //仅选择了同涉警未选择同涉案
            //循环ayy10
            $.each(ayy10,function (i,cur) {
                if(cur.casetag == "2" || cur.casetag == "3" || idCard == cur.personinfo.idcode || cur.personinfo.sex == "10"){
                    //判断为同涉案 添加
                    ayy11.push(cur);
                }
            });
        }else if(condition.indexOf("6") == -1 && condition.indexOf("7") == -1 ){
            //既选择了同涉警又选择了同涉案
            //循环ayy10
            $.each(ayy10,function (i,cur) {
                //排除当前分析人
                if(cur.casetag == "1" || cur.casetag == "2" || cur.casetag == "3" || idCard == cur.personinfo.idcode || cur.personinfo.sex == "10"){
                    //判断为同涉案 不添加
                    ayy11.push(cur);
                }
            });
        }else {
            ayy11 = ayy10;
        }
        console.log("---数组长度--"+ ayy11.length);
        // console.log("---ayy11--"+ JSON.stringify(ayy11));
        console.log("---ayy11--"+ JSON.stringify(ayy11));
        ayyre1 = ayy11;

        //****************************************************//
        //如果剔除后只剩下酒店的关系数组 显示无数据
        var flag = false;
        $.each(ayy11,function (i,pll) {
            if( pll.personinfo.sex != "10"){
                flag = true
            }
        });
        if(flag){
            dataType(ayy11);
        }else{
            dataType("");
        }
    };
    //点击保存分析结果
    $("#btn_yes_S").unbind('click').click(function () {
        var object = new Object();
        //身份证
        var idNumHotel = $("#idNumHotel").val();
        //时段
        var liveTime = $("#liveTime option:checked ").val();
        object["idNumHotel"] = idNumHotel;
        object["liveTime"] = liveTime;
        console.log( ayyre1 );
        $.ajax({
            type: 'POST',
            url: getRootPath_web()+"/elastic/saveAnalyse",//发送请求
            dataType : "json",
            data:{
                id:"",
                userId:"",
                createUser:"",
                analyseType:"3",
                content:"str"+JSON.stringify(ayyre1),
                title:idNumHotel,
                term:"str"+JSON.stringify(object)
            },
            success:function (data) {
                if( data.code == "200" ){
                    layer.msg(data.msg, {icon: 1});
                }else{
                    layer.msg(data.msg, {icon: 2});
                }
            }
        });
        commonPeopleS("3");
    });
</script>
<!--话单人分析-->
<script type="text/javascript">
    $("#showStype4 input").click(function () {
        $("#wt400 > div").eq($(this).index()).show().siblings().hide();
    });
    var ayyre1;
    getNowFormatDate();
    function getNowFormatDate() {
        var date = new Date();
        var seperator1 = "-";
        var seperator2 = ":";
        var month = date.getMonth() + 1;
        var strDate = date.getDate();
        if (month >= 1 && month <= 9) {
            month = "0" + month;
        }
        if (strDate >= 0 && strDate <= 9) {
            strDate = "0" + strDate;
        }
        var currentdate = date.getFullYear() + seperator1 + month + seperator1 + strDate;
        $("#startTime1").val(currentdate);
        $("#finishTime1").val(currentdate);
        return currentdate;
    }
    var startTime1 = $("#startTime1").val();
    removeDate(startTime1,90);
    function removeDate(date,days){
        var d = new Date(date);
        d.setDate(d.getDate()-days);
        var m=d.getMonth()+1;
        if (m >= 0 && m <= 9) {
            m = "0" + m;
        }
        var getDate = d.getDate();
        if ( getDate >= 0 && getDate <= 9) {
            getDate = "0" + getDate;
        }
        $("#startTime1").val(d.getFullYear()+'-'+m+'-'+getDate );
        return d.getFullYear()+'-'+ m +'-'+d.getDate();
    }
    //通联人请求数据返回渲染
    function conmmun1() {
        $("input[name='phone']").attr("disabled",false);
        $("input[name='phone']").removeAttr("checked");
        $("input[name='phone'][value='0']").prop("checked","true");
        $("input[name='phone'][value='1']").prop("checked","true");
        $("#btn_yes_F").show();
        //获取到当前的时间减去90天的时间
        var startTime4 = $("#startTime4").val();
        var finishTime = $("#finishTime1").val();
        var chaxuntext = $(".chaxuntext").text;
        //开始时间
        var startTime1 = $("#startTime1").val();
        //手机号码
        var phoneNumber1 = $("#phoneNumber1").val();
        //通联时段
        var TonlyTime1 = $("#TonlyTime1 option:checked").val();
        //TOP数量
        var Topnumber1 = $("#TopNumber1 option:checked").val();
        var object = new Object();
        object["TonlyTime"] = TonlyTime1;
        object["Topnumber"] = Topnumber1;
        $("#startTime4").val( startTime1 );
        //返回后台值
        // http://blog.thomsonreuters.com/index.php/mobile-patent-suits-graphic-of-the-day/
        if( startTime1 == startTime4 ){
            object["startTime"] = $("#startTime1").val();
            object["finishTime"] = $("#finishTime1").val();
        }else{
            addDate(startTime1,90)
            function addDate(date,days){
                var d=new Date(date);
                d.setDate(d.getDate()+days);
                var m=d.getMonth()+1;
                if (m >= 0 && m <= 9) {
                    m = "0" + m;
                }
                var getDate = d.getDate();
                if ( getDate >= 0 && getDate <= 9) {
                    getDate = "0" + getDate;
                }
                $("#finishTime1").val(d.getFullYear()+'-'+m+'-'+getDate );
                return d.getFullYear()+'-'+m+'-'+d.getDate();
            }
            object["startTime"] = $("#startTime1").val();
            object["finishTime"] = $("#finishTime1").val();
        }
        if( startTime1 == "" ){
            layer.msg('请输入开始时间！',{time:600});
            return false
        }
        if( phoneNumber1 == "" ){
            layer.msg('请输入电话号码！',{time:600});
            return false
        }
        var myreg=/^[1][3,4,5,7,8][0-9]{9}$/;
        if (!myreg.test(phoneNumber1) ) {
            layer.msg('电话号码格式不正确！',{time:600});
            return false;
        }
        object["phoneNumber"] = phoneNumber1;
        //记录 话单分析场景 待分析的手机号码
        toBePhone = phoneNumber1;
        console.log("toBePhone"+toBePhone);
        window.parent.layer.load(1, {shade: [0.3, '#393D49']});
        $.ajax({
            url: getRootPath_web()+"/elastic/contact",
            //url:"../data/data.json",
            type: "post",
            dataType: "json",
            data: object,
            success: function (data) {
                //加载话单表格
                analysisBilled();
                //$.cookie('DedicatedPeople2',JSON.stringify(data));
                //$("#DedicatedPeople2").attr("data",data);
                //$("#iframe").attr("src","newHtml.html");
                window.parent.layer.closeAll('loading');
                sessionStorage.setItem("initLiveTable4",JSON.stringify(data.statistics));
                commonData = data.statistics;
                phoneData = data.statistics;
                var root = data.statistics;
                conmmunW(root);
                //默认不勾选的条件
                var condition = "2,3,4,5";
                //根据勾选刷新页面
                refreshDataByCondition(phoneData,"phone",condition);
            }
        })
    }
    function conmmunW(root) {
        $(".wt410 > svg").remove();
        var width = document.documentElement.scrollWidth - 40 || document.body.scrollWidth - 40;
        var height = document.documentElement.scrollHeight - 110 || document.body.scrollHeight - 110;
        var nodes = {};
        root.forEach(function(link) {//参考https://stackoverflow.com/questions/23986466/d3-force-layout-linking-nodes-by-name-instead-of-index
            //利用source和target名称进行连线以及节点的确认
            link.source = nodes[link.phoneNumber] || (nodes[link.phoneNumber] = {name: link.phoneNumber});
            link.target = nodes[link.phone] || (nodes[link.phone] = {name: link.phone});
        });
        var force = d3.layout.force()//layout将json格式转化为力学图可用的格式
            .nodes(d3.values(nodes))//设定节点数组
            .links(root)//设定连线数组
            .friction(0.1)//摩擦系数0-1
            //.linkStrength(0)//* linkStrength() ： 數值從0~1，控制綫的牽引力，如果說設定為1的時候，拉動某一個點，其它點也會跟著移動如果是設定為0的時候，拉動一個點，其它點會保持不動，綫會拉長。
            .size([width, height])//大小
            .linkDistance(450)//连接线长度
            .charge(-1700)//值为+，则相互吸引，绝对值越大吸引力越大。值为-，则相互排斥，绝对值越大排斥力越大
            .on("tick", tick)//指时间间隔，隔一段时间刷新一次画面
            .start(0);//开始转换
        var zoom = d3.behavior.zoom() //缩放配置，
            .scaleExtent([0,2]) //缩放比例
            .on("zoom", zoomed);
        function zoomed() { //缩放函数
            svg.selectAll("g").attr("transform", //svg下的g标签移动大小
                "translate(" + d3.event.translate + ")scale(" + d3.event.scale + ")");
        }
        var svg = d3.select(".wt410").append("svg") //添加svg元素进行图形的绘制
            .attr("width", width)
            .attr("height", height)
            .call(zoom);
        //箭头
        var marker = //注意SVG规范中明确指出，附加到一个'Marker'元素上的“事件属性和事件的listener”不会被处理
            svg.append("marker") //添加一个marker标签来绘制箭头
                .attr("id", "resolved") //箭头id，用于其他标记进行引用时的url
                .attr("markerUnits", "userSpaceOnUse") //定义标记的坐标系统，userSpaceOnUse表示按照引用的元件来决定，strokeWidth按照用户单位决定
                .attr("viewBox", "0 -5 10 10") //坐标系的区域
                .attr("refX", 40) //箭头坐标X轴
                .attr("refY", 0)  //箭头坐标Y轴
                .attr("markerWidth", 12) //标识的大小
                .attr("markerHeight", 12)
                .attr("orient", "auto") //绘制方向，可设定为：auto（自动确认方向）和 角度值
                .attr("stroke-width", 3) //箭头宽度
                .append("path")
                .attr("d", "M0,-5L10,0L0,5") //绘制箭头，路径为一个三角形，有疑问参考svg的path http://www.runoob.com/svg/svg-path.html
                .attr('fill', '#000000'); //箭头颜色
        //设置连接线
        var edges_line = svg.append("g").selectAll(".edgepath")
            .data(root) //连线数据
            .enter() //当数组中的个数大于元素个数时，由d3创建空元素并与数组中超出的部分进行绑定。
            //可以参考http://www.ourd3js.com/wordpress/797/ enter、exit、update的区别
            .append("path") //添加path标签
            .attr({
                'd': function (d) {
                    return 'M ' + d.source.x + ' ' + d.source.y + ' L ' + d.target.x + ' ' + d.target.y
                }, //变量 d 是由D3.js提供的一个在匿名函数中的可用变量。这个变量是对当前要处理的元素的_data_属性的引用。
                'class': 'edgepathE', //定义该path标签class为edgepath
                'id': function (d, i) {
                    return 'edgepathE' + i;
                },
                'pid': function (d, i) {
                    return d.phoneNumber;
                },
                'zid': function (d, i) {
                    return d.phone;
                },
            }) // i也是d3.js提供的变量，表示当前处理的HTML元素在已选元素选集中的索引值
            .style("stroke", "#4874C2") //设置线条颜色
            .style("stroke-width", 2) //线条粗细
            .attr("marker-end", "url(#resolved)"); //根据箭头标记的id号引用箭头
        $(".edgepathE").click(function () {
            var startTime = $("#startTime4").val();
            var finishTime = $("#finishTime1").val();
            list($(this).attr("zid"),$(this).attr("pid"),startTime,finishTime)
        })
        //连线上的文字
        var edges_text = svg.append("g").selectAll(".edgelabel")
            .data(root)
            .enter()
            .append("text") //添加text标签
            .attr({
                'class': 'edgelabel', //定义该text标签class为edgelabel
                'id': function (d, i) {
                    return 'edgepathE' + i;
                },
                'dx': 60, //在连线上的坐标
                'dy': 0
            });
        //设置线条上的文字路径
        edges_text.append('textPath')
            .attr('xlink:href', function (d, i) {
                return '#edgepathE' + i
            })
            .style("pointer-events", "none")
            .text(function (d) {
                //console.log("频次"+d.duration+"-"+"排名"+ d.durationSort)
                // var theTime = parseInt(d.duration);// 秒
                // var minute = 0;// 分
                // var hour = 0;// 小时
                // var skyNumber = 0;// 天
                // if(theTime > 60) {
                //     minute = parseInt(theTime/60);
                //     theTime = parseInt(theTime%60);
                //     if( minute > 60 ) {
                //         hour = parseInt(minute/60);
                //         minute = parseInt(minute%60);
                //     }
                // }
                // if( hour > 24 ) {
                //     skyNumber = parseInt(hour/24);
                //     hour = parseInt(hour%60);
                // }
                // var result = ""+parseInt(theTime)+"秒";
                // if(minute > 0) {
                //     result = ""+parseInt(minute)+"分"+result;
                // }
                // if(hour > 0) {
                //     result = ""+parseInt(hour)+"小时"+result;
                // }
                // if(skyNumber > 0) {
                //     result = ""+parseInt(skyNumber)+"天"+result;
                // }
                var html="";
                if($("#phoneNumber1").val()==d.phoneNumber){
                    html= "主叫频次"+ d.calling +"-"+"排名"+ d.allSort +"时长"+ d.duration+"秒"+"-"+"排名"+ d.durationSort;
                }else{
                    html= "被叫频次"+ d.called +"-"+"排名"+ d.allSort +"时长"+ d.duration+"秒"+"排名"+ d.durationSort;
                }
                return html;
            });
        function drag() { //拖拽函数
            return force.drag()
                .on("dragstart", function (d) {
                    d3.event.sourceEvent.stopPropagation(); //取消默认事件
                    d.fixed = true; //拖拽开始后设定被拖拽对象为固定
                });
        }
        //圆圈的提示文字 根据需要到数据库中进行读取数据
        var tooltip = d3.select("body")
            .append("div") //添加div并设置成透明
            .attr("class", "tooltip")
            .style("opacity", 0.0);
        //圆圈
        var circle = svg.append("g").selectAll("image")
            .data(force.nodes())
            .enter()
            .append("image")
            .attr("xlink:href", function (d) {
                if( d.name.length == 11 ){
                    return "img/1.2_phone_mobile.png";
                }else{
                    return "img/1.1_phone_fixed.png";
                }
            })
            .attr("id", function (d) {
                return d.name;
            })
            .attr("class", "polf") //设置class
            .attr("width", "60px") //设置图片的宽
            .attr("height", "60px") //设置图片的高
            .on("click", function (node) {
                //单击时让连接线加粗
                edges_line.style("stroke-width", function (line) {
                    if (line.source.name == node.name || line.target.name == node.name) { //当与连接点连接时变粗
                        return 4;
                    } else {
                        return 1;
                    }
                });
                circle.style('stroke-width', 2); //所有的圆圈边框
                d3.select(this).style('stroke-width', 4); //被选中的圆圈边框
            })
            .call(drag()); //使顶点可以被拖动
        svg.selectAll("g").call(drag()); //为svg下的所有g标签添加拖拽事件
        svg.on("dblclick.zoom", null); //取消svg和圆圈的双击放大事件（d3中默认开启7个事件，关闭防止与上面的双击事件冲突）
        circle.on("dblclick.zoom", null);
        var text = svg.append("g").selectAll("text")
            .data(force.nodes())
            //返回缺失元素的占位对象（placeholder），指向绑定的数据中比选定元素集多出的一部分元素。
            .enter()
            .append("text") //添加text标签
            .attr("dy", "5.5em") //将文字下移
            .attr("text-anchor", "middle") //在圆圈中加上数据
            .style('fill', function (node) {
                var color = "#4874C2"; //文字颜色
                return color;
            })
            .attr('x', function (d) {
                // console.log(d.name+"---"+ d.name.length);
                var re_en = /[a-zA-Z]+/g;
                //如果是全英文，不换行
                d3.select(this).append('tspan') //添加tspan用来方便时使用绝对或相对坐标来调整文本
                    .attr('x', 0)
                    .attr('y', 2)
                    .attr('class', "popy")
                    .text(function () {
                        return d.name;
                    });
                d3.select(this).append('tspan') //添加tspan用来方便时使用绝对或相对坐标来调整文本
                    .attr('x', 0)
                    .attr('y', 2)
                    .attr("dy", "6.5em") //将文字下移
                    .text(function () {
                        return "";
                    });
            })
        function tick() { //刷新页面函数
            circle.attr("transform", transform1); //圆圈
            text.attr("transform", transform2); //顶点文字
            edges_line.attr('d', function (d) { //连接线
                var path = 'M ' + d.source.x + ' ' + d.source.y + ' L ' + d.target.x + ' ' + d.target.y;
                return path;
            });
            edges_text.attr('transform', function (d, i) { //连线上的文字
                if (d.target.x < d.source.x) { //判断起点和终点的位置，来让文字一直显示在线的上方且一直是正对用户
                    bbox = this.getBBox(); //获取矩形空间,并且调整翻转中心。（因为svg与css中的翻转不同，具体区别可看http://www.zhangxinxu.com/wordpress/2015/10/understand-svg-transform/）
                    rx = bbox.x + bbox.width / 2;
                    ry = bbox.y + bbox.height / 2;
                    return 'rotate(180 ' + rx + ' ' + ry + ')';
                } else {
                    return 'rotate(0)';
                }
            })
                .attr('dx', function (d, i) {
                    return Math.sqrt(Math.pow(d.target.x - d.source.x, 2) + Math.pow(d.target.y - d.source.y, 2)) / 2 - 20;
                    //设置文字一直显示在线的中间
                });
        }
        //设置图片的坐标
        function transform1(d) {
            return "translate(" + (d.x - 20) + "," + (d.y - 30) + ")";
        }
        //设置文字的坐标
        function transform2(d) {
            return "translate(" + (d.x + 10) + "," + (d.y - 15) + ")";
        }
        //循环备注
        $(".popy").each(function () {
            var texi = $(this);
            $.each(root,function(i,item){
                if(  texi.text() ==  item.phoneNumber   ){
                    if( item.casetag == null || item.casetag == "" || item.casetag == undefined ){
                        texi.next().text( "备注：暂无备注" );
                    }else{
                        texi.next().text( "备注："+ item.casetag );
                    }
                }else if (  texi.text() ==  item.phone   ) {
                    if( item.casetag == null || item.casetag == "" || item.casetag == undefined ){
                        texi.next().text( "备注：暂无备注" );
                    }else{
                        texi.next().text( "备注："+ item.casetag );
                    }
                }
            });
        })
        //删除和备注某一条信息
        $(".polf").click(function () {
            event.stopPropagation();
            $(".information").hide();
            $("#details").hide();
            var d = $(this);
            var pos = d.offset();
            var t = pos.top + d.height(); // 弹出框的上边位置
            var l = pos.left + d.width();  // 弹出框的左边位置
            $("#details").css({ "top": t, "left": l });
            $("#details").show();
            var thsid = $(this).attr("id");
            var thsida = $(this).attr("ida");
            var initLiveTable1  = sessionStorage.getItem("initLiveTable4");
            var data = $.parseJSON(initLiveTable1);
            var ayyre = [];
            var ayyre1 = [];
            if( thsid == $("#phoneNumber1").val() ){
                $("#details").hide();
            }
            //删除当前的节点和元素
            $(".remove_hiw").unbind('click').click(function (event) {
                event.stopPropagation();
                $("#details").hide();
                if( $("#idNumHotel").val() == thsid ){
                    layer.confirm('当前人员为搜索人员，如果删除则数据为空！', {
                        btn: ['确定','取消'] //按钮
                    }, function(){
                        sessionStorage.setItem("initLiveTable4",JSON.stringify(""));
                        layer.closeAll();
                        conmmunW("");
                    }, function(){
                        layer.closeAll();
                    });
                    $(this).parent().hide();
                }else{
                    layer.confirm('是否要删除当前的人员？', {
                        btn: ['确定','取消'] //按钮
                    }, function(){
                        $.each(data,function (i,root) {
                            if( thsid ==  root.phone ||  thsid ==  root.phoneNumber ) {
                                //thsid.remove()
                            }else{
                                ayyre.push( root );
                            }
                        });
                        sessionStorage.setItem("initLiveTable4",JSON.stringify(ayyre));
                        conmmunW(ayyre);
                        layer.closeAll();
                    }, function(){
                        layer.closeAll();
                    });
                    $(this).parent().hide();
                }
            })
            //给当前节点添加备注
            $(".ToView").unbind('click').click(function (event) {
                event.stopPropagation();
                $("#textarea_id").val("");
                $("#details").hide();
                layer.open({
                    title : "备注信息",
                    content:"<textarea id='textarea_id'></textarea>",
                    btn : [ '确定', '取消' ],
                    yes:function(){
                        $.each(data,function (i,root) {
                            if( thsid ==  root.phoneNumber   ) {
                                root.casetag = $("#textarea_id").val();
                                ayyre1.push( root );
                            }else if( thsid ==  root.phone   ){
                                root.casetag = $("#textarea_id").val();
                                ayyre1.push( root );
                            }else{
                                ayyre1.push( root );
                            }
                        });
                        sessionStorage.setItem("initLiveTable4",JSON.stringify(ayyre1));
                        conmmunW(ayyre1);
                        layer.closeAll();
                    },btn2:function (index,layero) {
                        layer.close(index);
                    }
                })
            })
        })
    };
    //点击保存分析结果
    $("#btn_yes_F").unbind('click').click(function () {
        var object = new Object();
        //开始时间
        var startTime1 = $("#startTime1").val();
        //手机号码
        var phoneNumber1 = $("#phoneNumber1").val();
        //通联时段
        var TonlyTime1 = $("#TonlyTime1 option:checked").val();
        //TOP数量
        var TopNumber1 = $("#TopNumber1 option:checked").val();
        object["TonlyTime1"] = TonlyTime1;
        object["Topnumber1"] = TopNumber1;
        object["phoneNumber1"] = phoneNumber1;
        object["startTime1"] = startTime1;
        console.log( ayyre1 );
        $.ajax({
            type: 'POST',
            url: getRootPath_web()+"/elastic/saveAnalyse",//发送请求
            dataType : "json",
            data:{
                id:"",
                userId:"",
                createUser:"",
                analyseType:"4",
                content:"str"+JSON.stringify(ayyre1),
                title:phoneNumber1,
                term:"str"+JSON.stringify(object)
            },
            success:function (data) {
                if( data.code == "200" ){
                    layer.msg(data.msg, {icon: 1});
                }else{
                    layer.msg(data.msg, {icon: 2});
                }
            }
        });
        commonPeopleF("4");
    });
</script>
<!--通联人、关系人、话单分析筛选的公共方法-->
<script type="text/javascript">
    //记录筛选条件
    var condition = '';
    //对应通联人的筛选
    $(function(){
        var s = $("input[name='contact']");
        s.each(function(i) {
            $(this).click(function(){
                condition = '';
                s.each(function () {
                    if(!$(this).prop('checked')){
                        condition += $(this).val();
                    }
                });
                //根据勾选刷新页面
                refreshDataByCondition(commonData,"contact",condition);
            });
        });
    });
    //对应关系人的筛选
    $(function(){
        var s = $("input[name='relationship']");
        s.each(function(i) {
            $(this).click(function(){
                condition = '';
                s.each(function () {
                    if(!$(this).prop('checked')){
                        condition += $(this).val();
                    }
                });
                //根据勾选刷新页面
                refreshDataByCondition(relationData,"relationship",condition);
            });
        });
    });
    //对应话单分析的筛选
    $(function(){
        var s = $("input[name='phone']");
        s.each(function(i) {
            $(this).click(function(){
                condition = '';
                s.each(function () {
                    if(!$(this).prop('checked')){
                        condition += $(this).val();
                    }
                });
                //根据勾选刷新页面
                refreshDataByCondition(phoneData,"phone",condition);
            });
        });
    });
    //根据条件选取不同的场景值过滤
    function refreshDataByCondition(rootData,inputName,condition) {
        var analysePhone = "";
        //根据场景值刷新不同的图形
        if(inputName == "contact"){
            //通联人场景
            $(".wt110 svg").remove();
            analysePhone = contactPhone;
            console.log("analysePhone"+contactPhone);
        }else if(inputName == "relationship"){
            //关系人分析场景
            $(".wt210 svg").remove();
        }else if(inputName == "phone"){
            //话单分析场景
            $(".wt410 svg").remove();
            analysePhone = toBePhone;
            console.log("analysePhone"+toBePhone);
        }
        //原数组
        var root = rootData;
        console.log("root");
        console.log(root);
        //抽取的主叫号码为待分析电话号码的数组
        var root00 = [];
        //为满足双向箭头，抽取的主叫号码不是待分析电话号码的数组
        var root01 = [];
        var root07 = [];

        //话单分析跟通联人分析使用
        if(inputName == "contact"||inputName == "phone"){
            //仅抽取待分析号码为主叫的数组
            $.each(root,function (i,cur) {
                //返回数组中的分析电话号码字段
                if(cur.phoneNumber == analysePhone){
                    root00.push(cur);
                }else {
                    root01.push(cur);
                }
            });
        }else {
            root00 = root;
        }

        root07 = getAnalyseArray(root00,inputName,condition);

        //话单分析跟通联人分析使用
        if(inputName == "contact"||inputName == "phone"){
            var root08 = getAnalyseArray02(root01,inputName,condition);;
            //对筛选完的数组添加双向箭头
            $.each(root08,function (i,cur) {
                root07.push(cur);
            });
        }

        //根据场景值刷新不同的图形
        if(inputName == "contact"){
            //通联人场景
            ayyre1 = root07;
            conmmunOne(root07);
            sessionStorage.setItem("DedicatedPeople2",JSON.stringify(root07));
        }else if(inputName == "relationship"){
            //关系人分析场景
            ayyre1 = root07;
            refreshOne(root07);
            sessionStorage.setItem("commonPeople2",JSON.stringify(root07));
        }else if(inputName == "phone"){
            //话单分析场景
            ayyre1 = root07;
            conmmunW( root07 );
            sessionStorage.setItem("initLiveTable4",JSON.stringify(root07));
        }
    }

    //筛选主叫号码
    function getAnalyseArray(rootArr,inputName,condition) {
        var root02 = [];
        var root03 = [];
        var root04 = [];
        var root05 = [];
        var root06 = [];
        var root07 = [];
        // alert(condition.indexOf("3") != -1);
        $.each(rootArr,function (i,cur) {
            var curPhone = (inputName == "contact"||inputName == "phone")?cur.phone:cur.opositeNumber;
            // alert(cur.opositeNumber);
            //如果不包含本地号
            if(condition.indexOf("0") != -1){
                if((curPhone.length == 11 && curPhone.substring(0,1) == "1" && cur.areacode == areaCode)
                    || (curPhone.length == 15 && curPhone.substring(0,4) == "0086" && cur.areacode == areaCode)
                    && (curPhone.substring(0,3) != "170" || curPhone.substring(0,3) != "171")){
                    console.log(cur.areacode);
                    console.log(areaCode);
                    //判断为本地号，不添加
                }else {
                    root02.push(cur);
                }
            }else {
                root02.push(cur);
            }
            // alert(JSON.stringify(cur));
        });
        // console.log("root02");
        // console.log(root02);
        $.each(root02,function(i,cur){
            var curPhone = (inputName == "contact"||inputName == "phone")?cur.phone:cur.opositeNumber;
            //如果不包含外地号
            if(condition.indexOf("1") != -1){
                if((curPhone.length == 11 && curPhone.substring(0,1) == "1" && cur.areacode != areaCode)
                    || (curPhone.length == 15 && curPhone.substring(0,4) == "0086" && cur.areacode != areaCode)
                    && (curPhone.substring(0,3) != "170" || curPhone.substring(0,3) != "171")){
                    //判断为外地号，不添加
                }else {
                    root03.push(cur);
                }
            }else {
                root03.push(cur);
            }
        });
        // console.log("root03");
        // console.log(root03);
        $.each(root03,function(i,cur){
            var curPhone = (inputName == "contact"||inputName == "phone")?cur.phone:cur.opositeNumber;
            //如果不包含港澳台
            if(condition.indexOf("2") != -1){
                if(curPhone.substring(0,5) == "00852" || curPhone.substring(0,5) == "00853" || curPhone.substring(0,5) == "00886"){
                    //判断为港澳台，不添加
                }else {
                    root04.push(cur);
                }
            }else {
                root04.push(cur);
            }
        });
        // console.log("root04");
        // console.log(root04);
        $.each(root04,function(i,cur){
            var curPhone = (inputName == "contact"||inputName == "phone")?cur.phone:cur.opositeNumber;
            //如果不包含国际号
            if(condition.indexOf("3") != -1){
                if(curPhone.substring(0,2) == "00" && curPhone.substring(0,5) != "00852"
                    && curPhone.substring(0,5) != "00853" && curPhone.substring(0,5) != "00886" && curPhone.substring(0,4) != "0086"){
                    //判断为国际号，不添加
                }else {
                    root05.push(cur);
                }
            }else {
                root05.push(cur);
            }
        });
        // console.log("root05");
        // console.log(root05);
        $.each(root05,function(i,cur){
            var curPhone = (inputName == "contact"||inputName == "phone")?cur.phone:cur.opositeNumber;
            //如果不是客服电话
            if(condition.indexOf("4") != -1){
                if(curPhone.length < 7 || curPhone.substring(0,3) == "400"||curPhone.substring(0,3) == "800"){
                    //判断为客服电话，不添加
                }else {
                    root06.push(cur);
                }
            }else {
                root06.push(cur);
            }
        });
        // console.log("root06");
        // console.log(root06);
        $.each(root06,function(i,cur){
            var curPhone = (inputName == "contact"||inputName == "phone")?cur.phone:cur.opositeNumber;
            //如果不包含虚拟运营商
            if(condition.indexOf("5") != -1){
                if(curPhone.substring(0,3) == "170" || curPhone.substring(0,3) == "171"){
                    //判断为虚拟运营商，不添加
                }else {
                    root07.push(cur);
                }
            }else {
                root07.push(cur);
            }
        });
        console.log(root07.length);
        // console.log("root07");
        // console.log(root07);

        return root07;
    }
    //筛选被叫号码
    function getAnalyseArray02(rootArr,inputName,condition) {
        var root02 = [];
        var root03 = [];
        var root04 = [];
        var root05 = [];
        var root06 = [];
        var root07 = [];
        // alert(condition.indexOf("3") != -1);
        $.each(rootArr,function (i,cur) {
            var curPhone = (inputName == "contact"||inputName == "phone")?cur.phoneNumber:cur.inputNumber;
            // alert(cur.opositeNumber);
            //如果不包含本地号
            if(condition.indexOf("0") != -1){
                if((curPhone.length == 11 && curPhone.substring(0,1) == "1" && cur.areacode == areaCode)
                    || (curPhone.length == 15 && curPhone.substring(0,4) == "0086" && cur.areacode == areaCode)
                    && (curPhone.substring(0,3) != "170" || curPhone.substring(0,3) != "171")){
                    console.log(cur.areacode);
                    console.log(areaCode);
                    //判断为本地号，不添加
                }else {
                    root02.push(cur);
                }
            }else {
                root02.push(cur);
            }
            // alert(JSON.stringify(cur));
        });
        // console.log("root02");
        // console.log(root02);
        $.each(root02,function(i,cur){
            var curPhone = (inputName == "contact"||inputName == "phone")?cur.phoneNumber:cur.inputNumber;
            //如果不包含外地号
            if(condition.indexOf("1") != -1){
                if((curPhone.length == 11 && curPhone.substring(0,1) == "1" && cur.areacode != areaCode)
                    ||(curPhone.length == 15 && curPhone.substring(0,4) == "0086" && cur.areacode != areaCode)
                    && (curPhone.substring(0,3) != "170" || curPhone.substring(0,3) != "171")){
                    //判断为外地号，不添加
                }else {
                    root03.push(cur);
                }
            }else {
                root03.push(cur);
            }
        });
        // console.log("root03");
        // console.log(root03);
        $.each(root03,function(i,cur){
            var curPhone = (inputName == "contact"||inputName == "phone")?cur.phoneNumber:cur.inputNumber;
            //如果不包含港澳台
            if(condition.indexOf("2") != -1){
                if(curPhone.substring(0,5) == "00852" || curPhone.substring(0,5) == "00853" || curPhone.substring(0,5) == "00886"){
                    //判断为港澳台，不添加
                }else {
                    root04.push(cur);
                }
            }else {
                root04.push(cur);
            }
        });
        // console.log("root04");
        // console.log(root04);
        $.each(root04,function(i,cur){
            var curPhone = (inputName == "contact"||inputName == "phone")?cur.phoneNumber:cur.inputNumber;
            //如果不包含国际号
            if(condition.indexOf("3") != -1){
                if(curPhone.substring(0,2) == "00" && curPhone.substring(0,5) != "00852"
                    && curPhone.substring(0,5) != "00853" && curPhone.substring(0,5) != "00886" && curPhone.substring(0,4) != "0086"){
                    //判断为国际号，不添加
                }else {
                    root05.push(cur);
                }
            }else {
                root05.push(cur);
            }
        });
        // console.log("root05");
        // console.log(root05);
        $.each(root05,function(i,cur){
            var curPhone = (inputName == "contact"||inputName == "phone")?cur.phoneNumber:cur.inputNumber;
            //如果不是客服电话
            if(condition.indexOf("4") != -1){
                if(curPhone.length < 7 || curPhone.substring(0,3) == "400"||curPhone.substring(0,3) == "800"){
                    //判断为客服电话，不添加
                }else {
                    root06.push(cur);
                }
            }else {
                root06.push(cur);
            }
        });
        // console.log("root06");
        // console.log(root06);
        $.each(root06,function(i,cur){
            var curPhone = (inputName == "contact"||inputName == "phone")?cur.phoneNumber:cur.inputNumber;
            //如果不包含虚拟运营商
            if(condition.indexOf("5") != -1){
                if(curPhone.substring(0,3) == "170" || curPhone.substring(0,3) == "171"){
                    //判断为虚拟运营商，不添加
                }else {
                    root07.push(cur);
                }
            }else {
                root07.push(cur);
            }
        });
        console.log(root07.length);
        // console.log("root07");
        // console.log(root07);

        return root07;
    }

    function showDetail(startTime,endTime,callNum,calledNum){
        url='listOfDetails.html?startTime='+startTime+'&endTime='+endTime
            +'&callNum='+callNum+'&calledNum='+calledNum;
        var ii;
        ii = layer.ready(function () {
            ii = layer.open({
                offset: 20,
                type: 2,
                title: '话单详情',
                fix: false,
                maxmin: true,
                shadeClose: true,
                area: ['800px', '600px'],
                content:url,
                end: function () {
                    $('#form-dialogdsss').attr("style", "display:none");
                }
            });
        }).index;
    }
</script>
</body>
</html>
