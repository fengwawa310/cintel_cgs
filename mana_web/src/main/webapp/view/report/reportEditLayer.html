<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>线索举报</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
    <!-- basic styles -->
    <link href="../assets/css/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="../assets/css/font-awesome.min.css" />

    <!-- ace styles -->
    <link rel="stylesheet" href="../assets/css/ace.min.css" />
    <link rel="stylesheet" type="text/css" href="../css/jquery.dataTables.min.css" />
    <script src="../assets/js/jquery-2.0.3.min.js"></script>

    <script src="../js/common.js"></script>
    <link rel="stylesheet" href="../css/commonStyle.css" />
    <link rel="stylesheet" href="../css/case.css" />
    <link rel="stylesheet" href="../css/report.css" />
    <script src="../assets/js/datepicker/WdatePicker.js"></script>

    <!-- <![endif]-->
    <script src="../assets/js/bootstrap.min.js"></script>
    <script src="../assets/js/typeahead-bs2.min.js"></script>

    <!-- ace scripts -->
    <script src="../assets/js/ace-elements.min.js"></script>
    <script src="../assets/js/ace.min.js"></script>
    <!-- page specific plugin scripts -->

    <!-- inline scripts related to this page -->
    <script src="../assets/js/layer/layer.js"></script>
</head>
<body>
<div style="width: 100%;height: 100%;margin: 0 auto;padding: 8px;background: white">
    <!--案件基本信息录入-->
    <div class="breadcrumbs" style="width: auto;height: auto;padding: 0px">
        <!--案件信息录入-->
        <div class="row breadcrumbs" style="text-align: center;margin: 0px;border-left: none;border-top: none;border-right: none">
            <div class="col-md-12">
                <span class="title">举报信息</span>
            </div>
        </div>
        <form action="" id="my_report_form">
            <!--举报id-->
            <input id="tipoffId" name="tipoffId" type="hidden"/>
            <!--举报人姓名、举报人电话、举报人身份证号-->
            <div class="row breadcrumbs caseContainer">
                <div class="col-md-4 noPadding">
                    <div class="col-md-4 caseTxt">
                        <span class="notNull">*</span>
                        <span>举报人姓名</span>
                    </div>
                    <div class="col-md-8 caseInput">
                        <input id="tipoffReporter" name="tipoffReporter" class="verification"/>
                    </div>
                </div>

                <div class="col-md-4 noPadding">
                    <div class="col-md-4 caseTxt">
                        <span class="notNull">*</span>
                        <span>举报人电话</span>
                    </div>
                    <div class="col-md-8 caseInput">
                        <input id="reporterPhone" name="reporterPhone" class="verification"/>
                    </div>
                </div>
                <div class="col-md-4 noPadding">
                    <div class="col-md-4 caseTxt">
                        <span class="notNull">*</span>
                        <span>举报人身份证号</span>
                    </div>
                    <div class="col-md-8 caseInput lastInput">
                        <input id="reporterIdcard" name="reporterIdcard" class="verification"/>
                    </div>
                </div>
            </div>
            <!--被举报人姓名、被举报人电话、被举报人身份证号-->
            <div class="row breadcrumbs caseContainer">
                <div class="col-md-4 noPadding">
                    <div class="col-md-4 caseTxt">
                        <span class="notNull">*</span>
                        <span>被举报人姓名</span>
                    </div>
                    <div class="col-md-8 caseInput">
                        <input id="beingReported" name="beingReported" class="verification" type="text" />
                    </div>
                </div>
                <div class="col-md-4 noPadding">
                    <div class="col-md-4 caseTxt">
                        <span>被举报人电话</span>
                    </div>
                    <div class="col-md-8 caseInput">
                        <input id="beingReportedPhone" name="beingReportedPhone"/>
                    </div>
                </div>
                <div class="col-md-4 noPadding">
                    <div class="col-md-4 caseTxt">
                        <span>被举报人身份证号</span>
                    </div>
                    <div class="col-md-8 caseInput lastInput">
                        <input id="beingReportedIdcard" name="beingReportedIdcard"/>
                    </div>
                </div>
            </div>
            <!--案件地域、涉案类别-->
            <div class="row breadcrumbs caseContainer">
                    <div class="col-md-4 noPadding">
                        <div class="col-md-4 caseTxt">
                            <span class="notNull">*</span>
                            <span>案件地域</span>
                        </div>
                        <div class="col-md-8 caseInput">
                            <select id="caseUnit" name="caseUnit" class="verification">
                                <option>--- 请选择 ---</option>
                            </select>
                        </div>
                    </div>
                    <div class="col-md-4 noPadding">
                        <div class="col-md-4 caseTxt">
                            <span class="notNull">*</span>
                            <span>涉案类别</span>
                        </div>
                        <div class="col-md-8 caseInput borderRnone">
                            <select id="caseClass" name="caseClass" class="verification">
                                <option value="">--- 请选择 ---</option>
                            </select>
                        </div>
                    </div>
                    <!--当涉案类别选择其他时展示-->
                    <div class="col-md-4 noPadding lastInput" style="background: white">
                        <div class="col-md-8 caseInput borderRnone" style="margin-left: 30px">
                            <input  id="caseClassMemo" name="caseClassMemo" class="hint hide" placeholder="  请输入其他涉案类别"/>
                        </div>
                    </div>
                </div>
            <!--线索标题-->
            <div class="row breadcrumbs caseContainer">
                <div class="col-md-2 caseTxt" style="width: 11.11%">
                    <span class="notNull">*</span>
                    <span>线索标题</span>
                </div>
                <div class="col-md-9 caseInput lastInput" style="width: 88.88%">
                    <input id="clueTitle" name="clueTitle" class="verification" type="text" style="width: 99%" />
                </div>
            </div>
            <!--简要案情-->
            <div class="row breadcrumbs caseContainer" style="min-height: 80px">
                <div class="col-md-2 caseTxt" style="width:11.11%;min-height: 80px;line-height: 80px">
                    <span class="notNull">*</span>
                    <span>线索内容</span>
                </div>
                <div class="col-md-10 caseInput lastInput" style="width:88.88%;min-height: 80px">
                    <textarea id="clueContent" name="clueContent" class="areaTxt verification" type="text">
                    </textarea>
                </div>
            </div>
        </form>
        <!--提交栏-->
        <div class="row breadcrumbs titleBadge noBorder">
            <div class="col-md-12 searchBtn" style="border: none">
                <button class="btn btn-primary" type="button" onclick="save()"> 提交 </button>
            </div>
        </div>

    </div>
</div>

<!--拼音搜索输入框-->
<!-- select -->
<script type="text/javascript" src="../js/changtopy.js"></script>
<script type="text/javascript" src="../js/getpyszm.js"></script>
<script type="text/javascript" src="../js/jquery.multiseselect.js"></script>
<script type="text/javascript" src="../js/jquery.singleselect.js"></script>
<link rel="stylesheet" type="text/css" href="../css/selectbox.css"/>
<script type="text/javascript">


    $("#caseClass").on("change",function(){
        if($("option:selected",this).val()==1916){
            $("#caseClassMemo").attr('class','show');
        }else{
            $("#caseClassMemo").attr('class','hide');
        }
    });

    var update=0;
    //初始化
    $(function(){
        var my_dicUnit;
        //查询所有单位机构
        $.ajax({
            type: 'POST',
            url: projectPath+"dic/findDicUnit?falg=true",//发送请求
            cache: false,
            async: false,
            dataType : "json",
            success: function(data) {
                my_dicUnit=data;
            }
        });
        $("#caseUnit").html(my_dicUnit.html);
        //案件地域
        selectDicUnit("");
        //涉案类别
        selectDicCommon(19,"caseClass");
        var thisURL = document.URL;
        var getval = thisURL.split('?')[1];
        if(getval!=undefined&&getval!=null&&getval!=""){
            if(getval.indexOf("tipoffId")!=-1){
                findReportById(getval);
            }
        }
    })
    //回显
    function findReportById(getval){
        console.log(getval);
        ++update;
        $.ajax({
            type: 'POST',
            url: projectPath+"reportHandler/findReportById?"+getval,//发送请求
            dataType : "json",
            success: function(data) {
                var json = $.parseJSON(data.data);
                //举报信息
                var reportObj = json.data.etTipoff;
                for (var prop in reportObj){
                    $("#my_report_form").find("[name='"+prop+"']").val((reportObj[prop]==null?"":reportObj[prop]));
                }
                //涉案类别为其它时
                if($("#caseClass").val()==1916){
                    $("#caseClassMemo").attr('class','show');
                }else{
                    $("#caseClassMemo").attr('class','hide');
                }

            }
        });
    }

    //保存
    function save() {
        var my_report_form=$("#my_report_form");
        var my_report_formStr=Common.validateForm(my_report_form);
        if(my_report_formStr==""){
            return;
        }
        window.parent.layer.load(1, {shade: [0.3, '#393D49']});
        if(update==0)
        {//添加
            $.ajax({
                type: 'POST',
                url: projectPath+"reportHandler/insert",//发送请求
                data:{"etTipoff":my_report_formStr},
                dataType : "json",
                success: function(data) {
                    window.parent.layer.closeAll('loading');
                    if(data.data.flag){
                        layer.msg(data.data.msg, {icon: 1,time:3000});
//                    logEntry("2","案件信息管理 案件进行新增");
                        setTimeout(function(){
                            var index=parent.layer.getFrameIndex(window.name);
                            parent.layer.close(index);
                        },1000)
                    }else{
                        layer.msg(data.data.msg, {icon: 2,time:3000,anim: 6});
                        layer.alert(data.data.msg,{
                            icon: 2,
                            skin: 'layer-ext-moon'
                        });
                    }
                }
            });
        }
        else{//修改
            $.ajax({
                type: 'POST',
                url: projectPath+"reportHandler/update",//发送请求
                data:{"etTipoff":my_report_formStr},
                dataType : "json",
                success: function(data) {
                    window.parent.layer.closeAll('loading');
                    if(data.data.flag){
                        layer.msg(data.data.msg, {icon: 1,time:3000});
//                    logEntry("2","案件信息管理 案件进行新增");
                        setTimeout(function(){
                            var index=parent.layer.getFrameIndex(window.name);
                            parent.layer.close(index);
                        },1000)

                    }else{
                        layer.msg(data.data.msg, {icon: 2,time:3000,anim: 6});
                        layer.alert(data.data.msg,{
                            icon: 2,
                            skin: 'layer-ext-moon'
                        });
                    }
                }
            });
        }


    }
</script>

</body>
</html>

